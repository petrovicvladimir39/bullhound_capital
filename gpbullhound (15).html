<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GP Bullhound Capital â€” Portfolio Intelligence</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root{
--bg:#07080A;--s1:#0D1014;--s2:#131820;--s3:#1A2028;--s4:#222A35;
--border:rgba(255,255,255,0.06);--border2:rgba(255,255,255,0.11);--border3:rgba(255,255,255,0.18);
--orange:#E8622A;--orange-l:#F5804E;--orange-dim:rgba(232,98,42,0.12);--orange-glow:rgba(232,98,42,0.04);
--green:#2ECC8A;--green-dim:rgba(46,204,138,0.1);
--red:#E05555;--red-dim:rgba(224,85,85,0.1);
--blue:#4A8BD4;--blue-dim:rgba(74,139,212,0.1);
--purple:#9B6CF0;--purple-dim:rgba(155,108,240,0.1);
--teal:#4AB4C8;--gold:#D4A843;--gold-dim:rgba(212,168,67,0.1);
--text:#E8E4DC;--text-mid:#7A776F;--text-dim:#3A3830;
--nav-bg:rgba(7,8,10,0.97);--modal-bg:rgba(0,0,0,0.78);
--logo-filter:invert(1) sepia(1) saturate(5) hue-rotate(345deg) brightness(0.9);
--scrollbar-track:#07080A;--scrollbar-thumb:#222A35;
--chart-grid:rgba(255,255,255,0.04);--chart-border:rgba(255,255,255,0.07);
--chart-tick:#3A3830;--chart-legend:#7A776F;--chart-tooltip-bg:rgba(13,16,20,0.96);--chart-tooltip-border:rgba(255,255,255,0.08);
--chart-tooltip-title:#E8E4DC;--chart-tooltip-body:#7A776F;
--btn-text:white;
}
html.light{
--bg:#F3F1ED;--s1:#FFFFFF;--s2:#F7F5F2;--s3:#EAE7E1;--s4:#DDD9D1;
--border:rgba(0,0,0,0.07);--border2:rgba(0,0,0,0.12);--border3:rgba(0,0,0,0.20);
--orange:#D0541E;--orange-l:#C04A16;--orange-dim:rgba(208,84,30,0.10);--orange-glow:rgba(208,84,30,0.04);
--green:#1EA06A;--green-dim:rgba(30,160,106,0.10);
--red:#CC3D3D;--red-dim:rgba(204,61,61,0.10);
--blue:#3A73B8;--blue-dim:rgba(58,115,184,0.10);
--purple:#7D50D4;--purple-dim:rgba(125,80,212,0.10);
--teal:#3A98AB;--gold:#B08A30;--gold-dim:rgba(176,138,48,0.10);
--text:#1A1A1A;--text-mid:#5A5850;--text-dim:#A09E98;
--nav-bg:rgba(255,255,255,0.97);--modal-bg:rgba(255,255,255,0.82);
--logo-filter:none;
--scrollbar-track:#F3F1ED;--scrollbar-thumb:#DDD9D1;
--chart-grid:rgba(0,0,0,0.06);--chart-border:rgba(0,0,0,0.10);
--chart-tick:#A09E98;--chart-legend:#5A5850;--chart-tooltip-bg:rgba(255,255,255,0.97);--chart-tooltip-border:rgba(0,0,0,0.12);
--chart-tooltip-title:#1A1A1A;--chart-tooltip-body:#5A5850;
--btn-text:white;
}
*{margin:0;padding:0;box-sizing:border-box}
html{background:var(--bg);color:var(--text);font-family:'Syne',sans-serif;font-size:16px;-webkit-font-smoothing:antialiased;transition:background .35s,color .35s}
body{min-height:100vh;overflow-x:hidden;position:relative;transition:background .35s}
body::before{content:'';position:fixed;top:-200px;right:-200px;width:800px;height:800px;background:radial-gradient(circle,var(--orange-glow) 0%,transparent 65%);pointer-events:none;z-index:0;opacity:0.8;transition:opacity .35s}
body::after{content:'';position:fixed;bottom:-100px;left:-100px;width:500px;height:500px;background:radial-gradient(circle,rgba(74,139,212,0.04) 0%,transparent 65%);pointer-events:none;z-index:0;transition:opacity .35s}
html.light body::before{opacity:0.4}
html.light body::after{opacity:0.3}
.nav{position:fixed;top:0;left:0;right:0;height:54px;background:var(--nav-bg);backdrop-filter:blur(20px);border-bottom:1px solid var(--border2);display:flex;align-items:center;padding:0 18px;z-index:200;gap:1px;overflow-x:auto;transition:background .35s,border-color .35s}
.nav-logo{display:flex;align-items:center;gap:8px;margin-right:14px;flex-shrink:0}
.nav-logo svg{width:26px;height:26px;flex-shrink:0}
.nav-logo-text{font-family:'Playfair Display',serif;font-size:15px;font-weight:600;white-space:nowrap}
.nav a{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-mid);text-decoration:none;padding:5px 10px;border-radius:5px;cursor:pointer;transition:all .18s;letter-spacing:0.4px;text-transform:uppercase;white-space:nowrap;border:1px solid transparent;flex-shrink:0}
.nav a:hover{color:var(--text);background:rgba(255,255,255,0.04)}
.nav a.on{color:var(--orange);background:var(--orange-dim);border-color:rgba(232,98,42,0.2)}
.nav-right{margin-left:auto;display:flex;align-items:center;gap:14px;flex-shrink:0;padding-left:10px}
.nav-live{display:flex;align-items:center;gap:5px;font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-mid)}
.dot-pulse{width:5px;height:5px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);animation:blink 2s ease infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}
.nav-clock{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-dim);letter-spacing:1px}
.main{padding:70px 20px 26px;max-width:1520px;margin:0 auto;position:relative;z-index:1}
.pg{display:none}.pg.on{display:block}
.grid{display:grid;gap:14px}
.g2{grid-template-columns:repeat(2,1fr)}.g3{grid-template-columns:repeat(3,1fr)}.g4{grid-template-columns:repeat(4,1fr)}
.g5{grid-template-columns:repeat(5,1fr)}.g6{grid-template-columns:repeat(6,1fr)}
.g23{grid-template-columns:2fr 1fr}.g32{grid-template-columns:3fr 2fr}.g13{grid-template-columns:1fr 3fr}.g31{grid-template-columns:3fr 1fr}
@media(max-width:1100px){.g2,.g3,.g4,.g5,.g6,.g23,.g32,.g13,.g31{grid-template-columns:1fr}}
.card{background:var(--s1);border:1px solid var(--border);border-radius:10px;overflow:hidden;position:relative;transition:background .35s,border-color .35s}
.card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.012) 0%,transparent 60%);pointer-events:none;border-radius:10px}
.ch{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
.ch h3{font-family:'Syne',sans-serif;font-size:13px;font-weight:600;color:var(--text-mid);text-transform:uppercase;letter-spacing:1.3px}
.cb{padding:15px}.cb-0{padding:0}
.kpi-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:13px;margin-bottom:14px}
.kpi{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:16px 18px;position:relative;overflow:hidden;transition:background .35s,border-color .35s}
.kpi::after{content:'';position:absolute;top:0;right:0;width:70px;height:70px;background:radial-gradient(circle at 100% 0%,var(--orange-glow),transparent 70%);pointer-events:none}
.kpi-label{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-mid);text-transform:uppercase;letter-spacing:1px;margin-bottom:7px}
.kpi-val{font-family:'Playfair Display',serif;font-size:28px;font-weight:700;color:var(--text);line-height:1;letter-spacing:-0.5px}
.kpi-sub{font-family:'JetBrains Mono',monospace;font-size:12px;margin-top:5px;display:flex;align-items:center;gap:3px}
.up{color:var(--green)}.dn{color:var(--red)}.neu{color:var(--text-mid)}
.t{font-family:'JetBrains Mono',monospace;font-size:11px;padding:3px 7px;border-radius:4px;letter-spacing:0.4px;display:inline-flex;align-items:center;gap:3px;white-space:nowrap}
.t-or{background:var(--orange-dim);color:var(--orange)}.t-gr{background:var(--green-dim);color:var(--green)}
.t-re{background:var(--red-dim);color:var(--red)}.t-bl{background:var(--blue-dim);color:var(--blue)}
.t-pu{background:var(--purple-dim);color:var(--purple)}.t-go{background:var(--gold-dim);color:var(--gold)}
.t-dim{background:rgba(255,255,255,0.05);color:var(--text-mid)}
.sc{font-family:'JetBrains Mono',monospace;font-size:11px;padding:3px 7px;border-radius:3px;letter-spacing:0.4px;white-space:nowrap}
.c-sw{background:rgba(74,139,212,0.12);color:var(--blue)}.c-fi{background:rgba(46,204,138,0.12);color:var(--green)}
.c-ai{background:rgba(232,98,42,0.12);color:var(--orange)}.c-ed{background:rgba(212,168,67,0.12);color:var(--gold)}
.c-qu{background:rgba(155,108,240,0.12);color:var(--purple)}
.stabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:16px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.stab{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-dim);padding:10px 15px;cursor:pointer;border-bottom:2px solid transparent;transition:all .18s;white-space:nowrap;letter-spacing:0.3px;flex-shrink:0}
.stab:hover{color:var(--text-mid)}.stab.on{color:var(--orange);border-bottom-color:var(--orange)}
.spane{display:none}.spane.on{display:block}
.tbl{width:100%;border-collapse:collapse}
.tbl th{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);text-transform:uppercase;letter-spacing:1px;padding:9px 11px;text-align:left;border-bottom:1px solid var(--border2);white-space:nowrap}
.tbl td{font-family:'JetBrains Mono',monospace;font-size:13px;color:var(--text);padding:9px 11px;border-bottom:1px solid var(--border);vertical-align:middle}
.tbl tr:last-child td{border-bottom:none}.tbl tr:hover td{background:rgba(255,255,255,0.015);cursor:pointer}
.tbl .num{text-align:right;font-variant-numeric:tabular-nums}.tbl .name-cell{font-weight:600}.tbl .click:hover{color:var(--orange);cursor:pointer}
.alert{border-radius:7px;padding:12px 16px;font-size:13px;display:flex;align-items:flex-start;gap:9px;margin-bottom:11px;line-height:1.5}
.a-re{background:rgba(224,85,85,0.07);border:1px solid rgba(224,85,85,0.18);color:var(--red)}
.a-or{background:rgba(232,98,42,0.07);border:1px solid rgba(232,98,42,0.18);color:var(--orange-l)}
.a-bl{background:rgba(74,139,212,0.07);border:1px solid rgba(74,139,212,0.18);color:var(--blue)}
.a-gr{background:rgba(46,204,138,0.07);border:1px solid rgba(46,204,138,0.18);color:var(--green)}
.a-go{background:rgba(212,168,67,0.07);border:1px solid rgba(212,168,67,0.18);color:var(--gold)}
.sec-hdr{margin-bottom:17px}.sec-hdr h2{font-family:'Playfair Display',serif;font-size:25px;font-weight:600;color:var(--text);margin-bottom:3px;letter-spacing:-0.3px}
.sec-hdr p{font-size:13px;color:var(--text-mid);font-family:'JetBrains Mono',monospace}
.cw{position:relative;width:100%}.cw canvas{width:100%!important;height:100%!important}
.cw180{height:180px}.cw220{height:220px}.cw260{height:260px}.cw300{height:300px}.cw340{height:340px}
.mbar{height:4px;border-radius:2px;background:var(--s3);overflow:hidden;margin-top:5px}
.mbar-f{height:100%;border-radius:2px;transition:width .8s cubic-bezier(.4,0,.2,1)}
.mbar-lg{height:6px}
.pill-row{display:flex;flex-wrap:wrap;gap:5px;margin-top:8px}
.pill{font-family:'JetBrains Mono',monospace;font-size:11px;padding:3px 9px;border-radius:10px;border:1px solid var(--border);color:var(--text-mid)}
.modal-overlay{position:fixed;inset:0;background:var(--modal-bg);backdrop-filter:blur(6px);z-index:1000;display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.on{display:flex}
.modal{background:var(--s1);border:1px solid var(--border2);border-radius:14px;width:100%;max-width:800px;max-height:86vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 40px 100px rgba(0,0,0,0.6)}
.modal-hdr{padding:17px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-hdr h3{font-family:'Playfair Display',serif;font-size:18px;font-weight:600}
.modal-close{width:27px;height:27px;border-radius:6px;background:var(--s3);border:none;color:var(--text-mid);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:15px;transition:all .15s}
.modal-close:hover{background:var(--s4);color:var(--text)}.modal-body{padding:20px;overflow-y:auto;flex:1}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.a1{animation:fadeUp .4s ease both .04s}.a2{animation:fadeUp .4s ease both .08s}.a3{animation:fadeUp .4s ease both .12s}
.a4{animation:fadeUp .4s ease both .16s}.a5{animation:fadeUp .4s ease both .2s}
.wfall-bar{display:flex;align-items:center;gap:10px;padding:5px 0;border-bottom:1px solid var(--border)}
.wfall-bar:last-child{border-bottom:none}
.wfall-label{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid);width:100px;flex-shrink:0}
.wfall-track{flex:1;height:16px;background:var(--s3);border-radius:3px;overflow:hidden}
.wfall-fill{height:100%;border-radius:3px;transition:width .7s ease}
.wfall-val{font-family:'JetBrains Mono',monospace;font-size:11px;width:50px;text-align:right;flex-shrink:0}
.score-wrap{margin-bottom:13px}
.score-hdr{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:4px}
.score-name{font-family:'JetBrains Mono',monospace;font-size:13px;color:var(--text)}
.score-val{font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:600}
.score-bar{height:5px;border-radius:3px;background:var(--s3);overflow:hidden}
.score-fill{height:100%;border-radius:3px;transition:width .9s cubic-bezier(.4,0,.2,1)}
.score-ms{display:flex;gap:4px;flex-wrap:wrap;margin-top:4px}
.score-m{font-family:'JetBrains Mono',monospace;font-size:11px;padding:1px 6px;border-radius:3px;background:var(--s3);color:var(--text-dim)}
.score-m.done{color:var(--green);background:var(--green-dim)}.score-m.partial{color:var(--gold);background:var(--gold-dim)}
.tl{position:relative;padding-left:18px}
.tl::before{content:'';position:absolute;left:4px;top:8px;bottom:0;width:1px;background:linear-gradient(to bottom,var(--border2),transparent)}
.tl-item{position:relative;padding-bottom:14px}
.tl-item::before{content:'';position:absolute;left:-16px;top:5px;width:7px;height:7px;border-radius:50%;background:var(--orange);box-shadow:0 0 5px rgba(232,98,42,0.4)}
.tl-item.gr::before{background:var(--green);box-shadow:0 0 5px rgba(46,204,138,0.4)}
.tl-item.bl::before{background:var(--blue);box-shadow:0 0 5px rgba(74,139,212,0.4)}
.tl-date{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);margin-bottom:2px}
.tl-text{font-size:12px;color:var(--text-mid);line-height:1.5}
.fund-btn{font-family:'JetBrains Mono',monospace;font-size:12px;padding:5px 12px;border-radius:18px;border:1px solid var(--border2);background:var(--s1);color:var(--text-mid);cursor:pointer;transition:all .15s;letter-spacing:0.5px}
.fund-btn:hover{border-color:var(--border3);color:var(--text)}.fund-btn.on{background:var(--orange-dim);border-color:rgba(232,98,42,0.3);color:var(--orange)}
.fund-sel-wrap{display:flex;align-items:center;gap:7px;margin-bottom:16px;flex-wrap:wrap}
.fund-sel-label{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid);text-transform:uppercase;letter-spacing:1px}
.stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(95px,1fr));gap:10px;margin-bottom:13px}
.stat-item{background:var(--s2);border:1px solid var(--border);border-radius:7px;padding:9px 11px}
.stat-label{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);text-transform:uppercase;letter-spacing:.8px;margin-bottom:4px}
.stat-val{font-family:'JetBrains Mono',monospace;font-size:15px;font-weight:600;color:var(--text)}
.pipe-card{background:var(--s2);border:1px solid var(--border);border-radius:7px;padding:9px 11px;min-width:140px;cursor:pointer;transition:all .15s;display:inline-block;margin:0 5px 5px 0;vertical-align:top}
.pipe-card:hover{border-color:var(--border2);transform:translateY(-1px)}
.pipe-card-name{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:var(--text);margin-bottom:3px}
.pipe-card-sub{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid);margin-bottom:5px}
.pipe-stage-hdr{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid);text-transform:uppercase;letter-spacing:1px;margin-bottom:7px;display:flex;align-items:center;gap:7px}
.pipe-stage-hdr span{background:var(--s3);color:var(--text-dim);padding:1px 6px;border-radius:3px;font-size:11px}
.rp-preview{background:var(--bg);border:1px solid var(--border);border-radius:7px;padding:14px;font-size:12px;color:var(--text-mid);line-height:1.6;font-family:'JetBrains Mono',monospace}
.rp-heading{font-family:'Playfair Display',serif;font-size:16px;color:var(--text);margin-bottom:7px;font-style:italic}
.rp-kpis{display:flex;gap:14px;flex-wrap:wrap;margin-bottom:9px;padding:9px;background:var(--s2);border-radius:5px}
.rp-kpi{text-align:center}.rp-kpi-label{font-size:11px;color:var(--text-dim);text-transform:uppercase;letter-spacing:.8px}
.rp-kpi-val{font-family:'Playfair Display',serif;font-size:16px;color:var(--text)}
.toggle{width:30px;height:17px;background:var(--s4);border-radius:9px;cursor:pointer;transition:background .15s;position:relative;flex-shrink:0}
.toggle::after{content:'';position:absolute;width:11px;height:11px;background:var(--text-mid);border-radius:50%;top:3px;left:3px;transition:all .15s}
.toggle.on{background:var(--orange)}.toggle.on::after{left:16px;background:white}
.esg-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:9px}
.esg-cat{background:var(--s2);border:1px solid var(--border);border-radius:7px;padding:10px}
.esg-cat-label{font-family:'JetBrains Mono',monospace;font-size:11px;text-transform:uppercase;letter-spacing:.8px;color:var(--text-dim);margin-bottom:5px}
.esg-cat-score{font-family:'Playfair Display',serif;font-size:20px;font-weight:700;margin-bottom:3px}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:var(--scrollbar-track)}::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:3px}

/* â”€â”€ INTERACTIVE CONTROLS â”€â”€ */
.ctrl-row{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border)}
.ctrl-row:last-child{border-bottom:none}
.ctrl-label{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-mid);width:140px;flex-shrink:0}
.ctrl-val{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--text);width:52px;text-align:right;flex-shrink:0}
.ctrl-sub{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);width:80px;text-align:right;flex-shrink:0}

/* Range slider custom styling */
input[type=range]{-webkit-appearance:none;appearance:none;height:4px;background:var(--s3);border-radius:2px;outline:none;flex:1;cursor:pointer;transition:background .15s}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;background:var(--orange);border-radius:50%;cursor:pointer;box-shadow:0 0 6px rgba(232,98,42,0.5);transition:transform .1s}
input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.2)}
input[type=range]::-moz-range-thumb{width:14px;height:14px;background:var(--orange);border:none;border-radius:50%;cursor:pointer}
input[type=range].blue-range::-webkit-slider-thumb{background:var(--blue);box-shadow:0 0 6px rgba(74,139,212,0.5)}
input[type=range].green-range::-webkit-slider-thumb{background:var(--green);box-shadow:0 0 6px rgba(46,204,138,0.5)}
input[type=range].red-range::-webkit-slider-thumb{background:var(--red);box-shadow:0 0 6px rgba(224,85,85,0.5)}
input[type=range].purple-range::-webkit-slider-thumb{background:var(--purple);box-shadow:0 0 6px rgba(155,108,240,0.5)}

/* Number input spinner hidden */
input[type=number]{-webkit-appearance:none;-moz-appearance:textfield;background:var(--s3);border:1px solid var(--border2);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:11px;padding:4px 7px;border-radius:4px;width:64px;text-align:right}
input[type=number]:focus{outline:none;border-color:var(--orange)}

/* Probability pill buttons */
.prob-pills{display:flex;gap:5px;flex-wrap:wrap}
.prob-pill{font-family:'JetBrains Mono',monospace;font-size:11px;padding:3px 9px;border-radius:12px;border:1px solid var(--border2);color:var(--text-dim);cursor:pointer;transition:all .15s}
.prob-pill:hover,.prob-pill.on{background:var(--orange);border-color:var(--orange);color:white}
.prob-pill.on.blue{background:var(--blue);border-color:var(--blue)}
.prob-pill.on.green{background:var(--green);border-color:var(--green)}

/* Live result cards */
.live-card{background:var(--s2);border:1px solid var(--border);border-radius:8px;padding:12px 14px;transition:border-color .3s}
.live-card.flash{border-color:var(--orange);animation:flash-border .4s ease-out forwards}
@keyframes flash-border{0%{border-color:var(--orange)}100%{border-color:var(--border)}}
.live-kpi{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:4px}
.live-kpi-lbl{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);text-transform:uppercase;letter-spacing:.8px}
.live-kpi-val{font-family:'JetBrains Mono',monospace;font-size:22px;font-weight:700;color:var(--text);transition:color .3s}
.live-kpi-val.up{color:var(--green)}.live-kpi-val.dn{color:var(--red)}.live-kpi-val.neu{color:var(--orange)}

/* Scenario bar (horizontal) */
.scen-bar-wrap{margin:6px 0}
.scen-bar-label{display:flex;justify-content:space-between;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid);margin-bottom:3px}
.scen-bar{height:8px;background:var(--s3);border-radius:4px;overflow:hidden;position:relative}
.scen-bar-fill{height:100%;border-radius:4px;transition:width .35s cubic-bezier(.4,0,.2,1)}
.scen-bar-base{position:absolute;top:0;width:2px;height:100%;background:var(--border3)}

/* Section divider with label */
.ctrl-section{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--orange);text-transform:uppercase;letter-spacing:1.5px;padding:10px 0 4px;border-bottom:1px solid var(--orange);margin-bottom:4px;opacity:.8}

/* Draggable probability weight row */
.drag-weight{display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid var(--border);cursor:ns-resize}
.drag-handle{width:8px;height:24px;display:flex;flex-direction:column;justify-content:center;gap:3px;flex-shrink:0;opacity:.4}
.drag-handle span{display:block;width:8px;height:1.5px;background:var(--text-mid);border-radius:1px}

/* Outcome gauge */
.gauge-wrap{position:relative;width:120px;height:64px;margin:0 auto}
.gauge-wrap svg{overflow:visible}

/* Chip selector row */
.chip-row{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0}
.chip{font-family:'JetBrains Mono',monospace;font-size:11px;padding:4px 10px;border-radius:4px;border:1px solid var(--border2);color:var(--text-dim);cursor:pointer;transition:all .15s;user-select:none}
.chip:hover{border-color:var(--border3);color:var(--text-mid)}
.chip.on{border-color:var(--orange);color:var(--orange);background:var(--orange-dim)}
.chip.on.blue{border-color:var(--blue);color:var(--blue);background:var(--blue-dim)}
.chip.on.green{border-color:var(--green);color:var(--green);background:var(--green-dim)}
.chip.on.red{border-color:var(--red);color:var(--red);background:var(--red-dim)}

/* Inline edit badge */
.edit-badge{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);padding:1px 6px;border:1px dashed var(--border2);border-radius:3px;cursor:pointer;transition:border-color .15s}
.edit-badge:hover{border-color:var(--orange);color:var(--orange)}

/* Two-column control panel */
.ctrl-panel{background:var(--s1);border:1px solid var(--border);border-radius:9px;padding:14px}
.ctrl-panel .ctrl-row{padding:7px 0}

/* Theme Toggle */
.theme-toggle{width:36px;height:36px;border-radius:50%;background:var(--s3);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .25s;flex-shrink:0}
.theme-toggle:hover{background:var(--s4);border-color:var(--border3);transform:scale(1.08)}
.theme-icon{font-size:16px;line-height:1;transition:transform .35s}
html.light .theme-icon{transform:rotate(180deg)}

/* Light theme card shadow override */
html.light .card{box-shadow:0 1px 4px rgba(0,0,0,0.06)}
html.light .kpi{box-shadow:0 1px 4px rgba(0,0,0,0.06)}
html.light .modal{box-shadow:0 20px 60px rgba(0,0,0,0.12)}
html.light .card::before{background:none}
html.light .live-card{background:var(--s2);box-shadow:0 1px 3px rgba(0,0,0,0.04)}
html.light input[type=range]{background:var(--s3)}
html.light .nav{box-shadow:0 1px 6px rgba(0,0,0,0.06)}

/* Light theme logo */
html.light .nav-logo img{filter:var(--logo-filter)}

</style>
</head>
<body>
<nav class="nav">
  <div class="nav-logo">
    <img src="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCABrAHoDASIAAhEBAxEB/8QAHAABAAIDAQEBAAAAAAAAAAAAAAcIBQYJAgME/8QAOBAAAQMDAgUCBAMFCQAAAAAAAQACAwQFEQYHCBIhMUFRYRMUInEJMpEjQnKCoRUkUlNic5Kiwv/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwC5aIiAiIgIiICIiAiIgIixN41FYrPcKGgul4oaKruEoipIZ52sfO8/usBOSc+nlBlkQdkQEREBERAREQEREBERARFom6O7GhtubfPUajvtMyqYwuioInc9TM7H0tDB1GcYycD1KDzvXulprarSzrzfZTJPKSyiooz+1qZMZwPQDy49B+gXMrX2s73rLXFdq66Vcvz1TUGaPEh/u7eYljGHwGjAH2X7t4twr3ubris1NepCBISykpubLaWEE8sbfsD1PkklaYe5QW34XuJzU7tWW7RmvaiW9U1zqYqOiruVongle4MYHkAc7CT3PUZzkjorwDsuNcEskEzJoXujkYQ5j2nBaR1BB8K6vARuJrjVuo77ZdSakrLpbqG3slp46kB7mPMgbn4mObtkYJx+iC36IOyICIiAiKMuIzdWi2n0BNepI2VF0qnGntlK49JJS0nmd/pb3Pr0HQlBvt9vVosVA+vvVzo7dSs7zVMzY2Z9MkgLQ6jfvZ2nkdHJuDZeZpweWVzx+oByua2vdaam1zfJLzqi71FxqnuJHxH/AERgnPKxo6Nb7ALXEHS3UPFHsvaadz4tUvucwHSGio5nF38zmhv9VEGsONxoMkOk9El3cMqbjVY+x+Gwf+lTFEEy664l93dVxy08mohaaKToae2xNh6enP1ef+Sh6eWWeZ808r5ZXuLnve7JcT3JPkr5ogKVeHHZu6bwamqKKGsFutNAxslfWcnOWhx+ljG5GXOwfYYyfAMVK634a0FSLRrGpLCKZ09MwOx0Lw15IH2BH6hB7vXBJa5bzTSWfXFVT2zLfmIamjEk2B+bkeHNHX3b09+ysDs1tPpLamyzW7TNPMZapwfV1dQ/nmmcBgZPYAdcAADqe5K34dkQB2REQFjNS36z6btUl1v1xprdQxuDXz1D+VjSTgZPjJOFk18qmGKphfBURMlhkBa9j2hzXDyCD0IQRtqffvaTT9sfXVWt7ZU4aXMhon/HlkPgBrM4z6nA9SFQjiP3Ru+6utIr5VUU9BaIonRWmmk/yQ45kJxhznEdSOgwBnouh7Np9s2VvzjdB6dE/Nzc/wAhH3z6YwuePFTqmLVe919mowxtvt0v9mUTGABjYoSW/SB2BdzuH3QRWe6L0BkgdTk9h1K6XcJ+2tDo3Z2zi42ilbebhH87WSSQNMoMnVrCSM/S3lGPBz5Qcz0XYC6aY03dYXQ3KwWusjcMET0jH5/UKI9fcLG02qC+ektM2n6x+cy22UtYT7xuyz9AEHNtFZPfvhcftpomu1dT6yZcaKlexgp5aExykveGgZD3A4z3wPsq3tGTgDqeyDI6WsV11Nf6GxWOikrLjWyiKCFg6uJ9fQDuT2AHVdRthNu6TbDbO36Xgc2WqGZ6+Zo6S1LwOd32GA0ezQo74Mdn6fQWhINS3ihYNTXmITOc8fXTU7gCyIehP5necnB7KwQ7ICIiAiIgIiII/wB/Nf2zbvbS73msrYoK59NLFbYifrnqS08jQB1ODgn0AXK4Cesq8Na+eeZ/QAZc9xPp5JKtBxO/O71cUlBoHTEnxWWyMW6STuyGQOc+olP8IIafUx47q021GyO3u3ENPLZLHDLdWMDX3KpzJO92OrhkkMyfDcIK8cKvDDWCvo9bbkURgjhc2agtEg+t7hhzZJuvQD/Aep84HQ3SHZB2RAREQQvxrNpHcOeoxVvDcGAxZ8yfGZgKpXBbtY3cDclt4ulPz2KwFlTOCMtnnzmKI+2QXHxhuD+ZTD+JLX3SKw6Tt0dUW2yoqZpZYAPzysaAxxPsHuwPf2Uy8J2jINFbG2Cmaxoq7nA251jgO8kzGuAP2ZyN/lQSuOyIiAiIgIiIC0XfjXEO3e1l71O9wFRDAYqJp/fqH/TGPtzdT7ArelitU6dseqLU606itVJdKBzg91PUxh7C4djg+iCq34dFFY6ul1ZqSeqbUaplqhDM14/aMpnBr+cfxyc2f9sZ8K3y1rR+hNG6PlqJtLaattnkqWtbO6lgDC8DOAcd8ZK2UdkBERAREQVQ/ElgDtBaVquU5jukkfN4HNETj/r/AEUrcL25Ng3B2xtkFqmc242aip6O5Uz2kOjkbGG8wPYtdykgj7HCkHVmmrBqu2C16ktFHdqISCUQVUQe0PAOHYPnBPX3K+Gj9HaW0fBPBpewW6zxVDg+ZtJAGB7gMAnHdBn0REBERAREQEREBERAREQEREBERAREQEREBERB/9k=" style="width:28px;height:28px;object-fit:contain;filter:var(--logo-filter);flex-shrink:0" alt="GP Bullhound">
    <span class="nav-logo-text">GP Bullhound Capital</span>
  </div>
  <a onclick="go('pulse')" id="n-pulse" class="on">Pulse</a>
  <a onclick="go('funds')" id="n-funds">Funds</a>
  <a onclick="go('portfolio')" id="n-portfolio">Portfolio</a>
  <a onclick="go('companies')" id="n-companies">Companies</a>
  <a onclick="go('pipeline')" id="n-pipeline">Pipeline</a>
  <a onclick="go('exits')" id="n-exits">Exits</a>
  <a onclick="go('risk')" id="n-risk">Risk</a>
  <a onclick="go('lp')" id="n-lp">LP View</a>
  <a onclick="go('investors')" id="n-investors">Investors</a>
  <a onclick="go('reports')" id="n-reports">Reports</a>
  <a onclick="go('bullhub')" id="n-bullhub" style="color:var(--orange);font-weight:700">Bullhub â—ˆ</a>
  <a onclick="go('security')" id="n-security" style="color:var(--green);font-weight:600">ðŸ›¡ Security</a>
  <a onclick="go('tools')" id="n-tools" style="color:var(--purple)">âš™ Tools</a>
  <div class="nav-right">
    <div class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark theme">
      <span class="theme-icon" id="theme-icon">â˜€</span>
    </div>
    <div class="nav-live"><div class="dot-pulse"></div>Live</div>
    <div class="nav-clock" id="clock"></div>
  </div>
</nav>
<div class="main">

<!-- PAGE: PULSE -->
<div class="pg on" id="pg-pulse">
  <div class="sec-hdr a1"><h2>Morning Pulse</h2><p>Platform AUM â‚¬1.08B Â· 6 funds Â· 10 active companies Â· Fund VI 68% deployed</p></div>
  <div class="kpi-row a2">
    <div class="kpi"><div class="kpi-label">Platform AUM</div><div class="kpi-val">â‚¬1.08B</div><div class="kpi-sub up">â†‘ 12.3% YoY</div></div>
    <div class="kpi"><div class="kpi-label">Active Funds NAV</div><div class="kpi-val">â‚¬751M</div><div class="kpi-sub neu">Funds IV Â· V Â· VI combined</div></div>
    <div class="kpi"><div class="kpi-label">Platform Avg IRR</div><div class="kpi-val">17.1%</div><div class="kpi-sub up">â†‘ 0.4pp QoQ</div></div>
    <div class="kpi"><div class="kpi-label">Fund VI IRR</div><div class="kpi-val">12.4%</div><div class="kpi-sub up">â†‘ vs 10.2% Q-1</div></div>
    <div class="kpi"><div class="kpi-label">Dry Powder (VI)</div><div class="kpi-val">$137M</div><div class="kpi-sub neu">$431M committed</div></div>
    <div class="kpi"><div class="kpi-label">Active Companies</div><div class="kpi-val">10</div><div class="kpi-sub neu">2 Star Â· 6 Core Â· 2 Watch</div></div>
  </div>
  <div id="pulse-alerts" class="a3"></div>
  <div class="grid g23 a4">
    <div class="card">
      <div class="ch"><h3>Platform NAV Evolution â€” All Active Funds (IV Â· V Â· VI)</h3><span class="t t-or">8 Quarters</span></div>
      <div class="cb"><div class="cw cw260"><canvas id="ch-pulse-platform"></canvas></div></div>
    </div>
    <div class="card">
      <div class="ch"><h3>Fund Health Matrix</h3></div>
      <div class="cb" id="fund-health-matrix"></div>
    </div>
  </div>
  <div class="grid g23 a5" style="margin-top:14px">
    <div class="card">
      <div class="ch"><h3>All 10 Active Portfolio Companies â€” Funds IV Â· V Â· VI</h3><span class="t t-dim">Click for detail</span></div>
      <div class="cb-0"><table class="tbl" id="tbl-pulse"><thead><tr><th>Company</th><th>Fund</th><th>Sector</th><th>Status</th><th class="num">NAV ($M)</th><th class="num">MOIC</th><th class="num">ARR ($M)</th><th class="num">ARR Gr%</th><th class="num">Burn</th></tr></thead><tbody></tbody></table></div>
    </div>
    <div class="card">
      <div class="ch"><h3>Action Items</h3><span class="t t-re">6 items</span></div>
      <div class="cb" id="pulse-actions"></div>
    </div>
  </div>
</div>

<!-- PAGE: FUNDS -->
<div class="pg" id="pg-funds">
  <div class="sec-hdr"><h2>Fund Performance</h2><p>6 funds Â· â‚¬1.26B committed Â· Vintages 2008â€“2022</p></div>
  <div class="stabs" id="funds-tabs">
    <div class="stab on" onclick="fst(0)">Per-Fund Dashboard</div>
    <div class="stab" onclick="fst(1)">IRR Trajectory</div>
    <div class="stab" onclick="fst(2)">PME Analysis</div>
    <div class="stab" onclick="fst(3)">Value Creation</div>
    <div class="stab" onclick="fst(4)">J-Curve</div>
    <div class="stab" onclick="fst(5)">Capital Account</div>
  </div>
  <div class="spane on" id="fs0">
    <div class="fund-sel-wrap"><span class="fund-sel-label">Fund:</span>
      <button class="fund-btn on" onclick="selFund('I')">Fund I</button>
      <button class="fund-btn" onclick="selFund('II')">Fund II</button>
      <button class="fund-btn" onclick="selFund('III')">Fund III</button>
      <button class="fund-btn" onclick="selFund('IV')">Fund IV</button>
      <button class="fund-btn" onclick="selFund('V')">Fund V</button>
      <button class="fund-btn" onclick="selFund('VI')">Fund VI</button>
    </div>
    <div id="fund-detail-panel"></div>
    <div class="card" style="margin-top:14px"><div class="ch"><h3>All Funds Snapshot</h3></div><div class="cb-0">
      <table class="tbl" id="tbl-funds-snap"><thead><tr><th>Fund</th><th class="num">Vintage</th><th class="num">Size</th><th>Status</th><th class="num">Net IRR</th><th class="num">TVPI</th><th class="num">DPI</th><th class="num">MOIC</th><th class="num">Deployed%</th><th class="num">NAV</th></tr></thead><tbody></tbody></table>
    </div></div>
  </div>
  <div class="spane" id="fs1">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>IRR Trajectory â€” QoQ per Fund</h3><span class="t t-bl">12 Quarters</span></div><div class="cb"><div class="cw cw300"><canvas id="ch-f-irr-traj"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>TVPI vs DPI â€” Realized vs Residual</h3></div><div class="cb"><div class="cw cw300"><canvas id="ch-f-tvpi"></canvas></div></div></div>
    </div>
    <div class="grid g2" style="margin-top:14px">
      <div class="card"><div class="ch"><h3>Fund IRR vs Benchmark</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-f-bench"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>DPI Maturity Curve</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-f-dpi-mat"></canvas></div></div></div>
    </div>
  </div>
  <div class="spane" id="fs2">
    <div class="alert a-bl" style="margin-bottom:14px">â„¹ PME (Public Market Equivalent) â€” fund outperforms a public index when PME &gt; 1.0. Computed using fund cash flows replicated in MSCI World.</div>
    <div class="kpi-row">
      <div class="kpi"><div class="kpi-label">Fund I PME</div><div class="kpi-val">1.62Ã—</div><div class="kpi-sub up">+62% vs MSCI World</div></div>
      <div class="kpi"><div class="kpi-label">Fund II PME</div><div class="kpi-val">1.47Ã—</div><div class="kpi-sub up">+47% vs benchmark</div></div>
      <div class="kpi"><div class="kpi-label">Fund III PME</div><div class="kpi-val">1.38Ã—</div><div class="kpi-sub up">+38% vs benchmark</div></div>
      <div class="kpi"><div class="kpi-label">Fund IV PME</div><div class="kpi-val">1.29Ã—</div><div class="kpi-sub up">+29% vs benchmark</div></div>
      <div class="kpi"><div class="kpi-label">Fund V PME</div><div class="kpi-val">1.18Ã—</div><div class="kpi-sub up">+18% vs benchmark</div></div>
      <div class="kpi"><div class="kpi-label">Fund VI PME (est.)</div><div class="kpi-val">1.12Ã—</div><div class="kpi-sub up">Early vintage, positive</div></div>
    </div>
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>PME vs MSCI World & NASDAQ</h3></div><div class="cb"><div class="cw cw300"><canvas id="ch-f-pme"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Alpha vs Peer Median IRR</h3></div><div class="cb"><div class="cw cw300"><canvas id="ch-f-alpha"></canvas></div></div></div>
    </div>
  </div>
  <div class="spane" id="fs3">
    <div class="fund-sel-wrap"><span class="fund-sel-label">Fund:</span>
      <button class="fund-btn" onclick="selVCFund('III')">Fund III</button>
      <button class="fund-btn" onclick="selVCFund('IV')">Fund IV</button>
      <button class="fund-btn" onclick="selVCFund('V')">Fund V</button>
      <button class="fund-btn on" onclick="selVCFund('VI')">Fund VI</button>
    </div>
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Computed Value Bridge</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-f-attr"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Entry vs Current EV/ARR</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-f-evarr"></canvas></div></div></div>
    </div>
    <div class="card" style="margin-top:14px"><div class="ch"><h3>Value Decomposition â€” Computed from Portfolio Data</h3></div><div class="cb" id="value-decomp-table"></div></div>
  </div>
  <div class="spane" id="fs4">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Fund VI J-Curve</h3></div><div class="cb"><div class="cw cw340"><canvas id="ch-f-jcurve"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>All Funds Overlay</h3></div><div class="cb"><div class="cw cw340"><canvas id="ch-f-jall"></canvas></div></div></div>
    </div>
  </div>
  <div class="spane" id="fs5">
    <div class="kpi-row">
      <div class="kpi"><div class="kpi-label">Committed</div><div class="kpi-val">$431M</div></div>
      <div class="kpi"><div class="kpi-label">Called</div><div class="kpi-val">$294M</div><div class="kpi-sub neu">68%</div></div>
      <div class="kpi"><div class="kpi-label">Dry Powder</div><div class="kpi-val">$137M</div></div>
      <div class="kpi"><div class="kpi-label">Cap. Preservation Floor</div><div class="kpi-val">$368M</div><div class="kpi-sub up">0.85Ã— floor</div></div>
    </div>
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Deployment Pace</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-f-deploy"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Projected DPI â€” Base / Bull / Bear</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-f-dpi-proj"></canvas></div></div></div>
    </div>
    <div class="card" style="margin-top:14px"><div class="ch"><h3>Fund-Determining Positions</h3></div><div class="cb-0">
      <table class="tbl"><thead><tr><th>Company</th><th class="num">NAV%</th><th class="num">Cost</th><th class="num">Current NAV</th><th class="num">Write-to-Zero Impact</th><th class="num">TVPI If Lost</th><th>Risk</th></tr></thead>
      <tbody>
        <tr><td class="name-cell">Q-CTRL</td><td class="num">27.9%</td><td class="num">$35M</td><td class="num">$82M</td><td class="num dn">âˆ’0.39Ã—</td><td class="num">1.01Ã—</td><td><span class="t t-re">HIGH</span></td></tr>
        <tr><td class="name-cell">Multiverse</td><td class="num">18.7%</td><td class="num">$28M</td><td class="num">$55M</td><td class="num dn">âˆ’0.26Ã—</td><td class="num">1.14Ã—</td><td><span class="t t-or">MED</span></td></tr>
        <tr><td class="name-cell">d-Matrix</td><td class="num">12.9%</td><td class="num">$22M</td><td class="num">$38M</td><td class="num dn">âˆ’0.18Ã—</td><td class="num">1.22Ã—</td><td><span class="t t-or">MED</span></td></tr>
      </tbody></table>
    </div></div>
  </div>
</div>

<!-- PAGE: PORTFOLIO -->
<div class="pg" id="pg-portfolio">
  <div class="sec-hdr"><h2>Portfolio Construction</h2><p>Allocation, concentration, follow-on strategy, ESG</p></div>
  <div class="stabs" id="port-tabs">
    <div class="stab on" onclick="pst(0)">Allocation Map</div>
    <div class="stab" onclick="pst(1)">Follow-On Strategy</div>
    <div class="stab" onclick="pst(2)">Winners vs Protectors</div>
    <div class="stab" onclick="pst(3)">Concentration Risk</div>
    <div class="stab" onclick="pst(4)">ESG & Impact</div>
  </div>
  <div class="spane on" id="ps0">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>NAV Allocation â€” Fund VI</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-p-alloc"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Forward IRR Waterfall â€” Computed Attribution</h3></div><div class="cb" id="irr-waterfall"></div></div>
    </div>
    <div class="grid g2" style="margin-top:14px">
      <div class="card"><div class="ch"><h3>Sector Mix</h3></div><div class="cb"><div class="cw cw220"><canvas id="ch-p-sector"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Geography Mix</h3></div><div class="cb"><div class="cw cw220"><canvas id="ch-p-geo"></canvas></div></div></div>
    </div>
  </div>
  <div class="spane" id="ps1">
    <div class="kpi-row">
      <div class="kpi"><div class="kpi-label">Dry Powder</div><div class="kpi-val">$137M</div></div>
      <div class="kpi"><div class="kpi-label">Rec. Follow-On</div><div class="kpi-val">$82M</div><div class="kpi-sub up">60% to top 2 winners</div></div>
      <div class="kpi"><div class="kpi-label">TVPI w/ Follow-On</div><div class="kpi-val">2.2Ã—</div></div>
      <div class="kpi"><div class="kpi-label">TVPI w/o Follow-On</div><div class="kpi-val">1.8Ã—</div></div>
    </div>
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Recommended Allocation</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-p-followon"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>TVPI Impact by Strategy</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-p-fimpact"></canvas></div></div></div>
    </div>
  </div>
  <div class="spane" id="ps2">
    <div class="grid g23">
      <div class="card"><div class="ch"><h3>IRR vs ARR Growth â€” Size = NAV Weight</h3></div><div class="cb"><div class="cw cw340"><canvas id="ch-p-matrix"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Classification & Action</h3></div><div class="cb-0"><table class="tbl"><thead><tr><th>Company</th><th class="num">Fwd IRR</th><th>Class</th><th>Action</th></tr></thead><tbody id="classify-tbody"></tbody></table></div></div>
    </div>
  </div>
  <div class="spane" id="ps3">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Single-Name Concentration vs 25% IC Limit</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-p-conc"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Concentration Risk</h3></div><div class="cb"><div id="conc-bars"></div><div class="alert a-re" style="margin-top:14px">Q-CTRL at 27.9% â€” above IC 25% limit. Options: secondary ($15â€“20M), co-invest syndication, follow-on to dilute entry cost.</div></div></div>
    </div>
  </div>
  <div class="spane" id="ps4">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>ESG Scores â€” Fund VI Companies</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-esg-radar"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Platform Impact Metrics</h3></div><div class="cb" id="esg-impact"></div></div>
    </div>
    <div class="card" style="margin-top:14px"><div class="ch"><h3>ESG Scorecard</h3></div><div class="cb-0"><table class="tbl" id="tbl-esg"><thead><tr><th>Company</th><th class="num">E</th><th class="num">S</th><th class="num">G</th><th class="num">Total</th><th>Flag</th><th>Impact Theme</th></tr></thead><tbody></tbody></table></div></div>
  </div>
</div>

<!-- PAGE: COMPANIES -->
<div class="pg" id="pg-companies">
  <div class="sec-hdr"><h2>Company Performance</h2><p>All 10 active portfolio companies â€” click any row for detail</p></div>
  <div class="stabs" id="co-tabs">
    <div class="stab on" onclick="cst(0)">Scorecard</div>
    <div class="stab" onclick="cst(1)">Growth Trajectory</div>
    <div class="stab" onclick="cst(2)">Burn & Efficiency</div>
    <div class="stab" onclick="cst(3)">Customer Quality</div>
  </div>
  <div class="spane on" id="cs0">
    <div class="card"><div class="ch"><h3>Company Scorecard â€” All 10 Active</h3><span class="t t-dim">Click row for detail</span></div><div class="cb-0">
      <table class="tbl" id="tbl-co-score"><thead><tr><th>Company</th><th>Fund</th><th>Sector</th><th class="num">ARR($M)</th><th class="num">ARR Gr%</th><th class="num">EV/ARR</th><th class="num">MOIC</th><th class="num">NRR</th><th class="num">Burn</th><th>Status</th><th>Key Lever</th></tr></thead><tbody></tbody></table>
    </div></div>
  </div>
  <div class="spane" id="cs1">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>ARR Growth 8Q Trend</h3></div><div class="cb"><div class="cw cw340"><canvas id="ch-c-arr"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Growth Classification</h3></div><div class="cb-0">
        <table class="tbl"><thead><tr><th>Company</th><th class="num">TTM Gr%</th><th class="num">QoQ Î”</th><th>Trajectory</th></tr></thead>
        <tbody>
          <tr><td>d-Matrix</td><td class="num">200%</td><td class="num up">+15pp</td><td><span class="t t-gr">Accelerating</span></td></tr>
          <tr><td>Q-CTRL</td><td class="num">120%</td><td class="num up">+5pp</td><td><span class="t t-gr">Accelerating</span></td></tr>
          <tr><td>Headway</td><td class="num">80%</td><td class="num dn">âˆ’2pp</td><td><span class="t t-or">Stable</span></td></tr>
          <tr><td>Multiverse</td><td class="num">65%</td><td class="num neu">0pp</td><td><span class="t t-or">Stable</span></td></tr>
          <tr><td>Wayflyer</td><td class="num">55%</td><td class="num dn">âˆ’3pp</td><td><span class="t t-or">Stable</span></td></tr>
          <tr><td>Quantexa</td><td class="num">45%</td><td class="num up">+2pp</td><td><span class="t t-or">Stable</span></td></tr>
          <tr><td>Matillion</td><td class="num">40%</td><td class="num dn">âˆ’5pp</td><td><span class="t t-re">Decelerating</span></td></tr>
          <tr><td>Sanity</td><td class="num">38%</td><td class="num dn">âˆ’8pp</td><td><span class="t t-re">Decelerating</span></td></tr>
          <tr><td>Ledger</td><td class="num">35%</td><td class="num neu">0pp</td><td><span class="t t-or">Stable</span></td></tr>
          <tr><td>Booksy</td><td class="num">30%</td><td class="num dn">âˆ’4pp</td><td><span class="t t-re">Decelerating</span></td></tr>
        </tbody></table>
      </div></div>
    </div>
  </div>
  <div class="spane" id="cs2">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Burn Multiple vs ARR Growth Scatter</h3></div><div class="cb"><div class="cw cw340"><canvas id="ch-c-burn"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Runway & Path to Profitability</h3></div><div class="cb-0">
        <table class="tbl"><thead><tr><th>Company</th><th class="num">Burn/mo</th><th class="num">Runway</th><th class="num">Burn Mult</th><th>Path</th></tr></thead>
        <tbody>
          <tr><td>Ledger</td><td class="num">$0.8M</td><td class="num">48+</td><td class="num">0.6Ã—</td><td><span class="t t-gr">Profitable</span></td></tr>
          <tr><td>Booksy</td><td class="num">$0.5M</td><td class="num">48+</td><td class="num">0.7Ã—</td><td><span class="t t-gr">Near-profit</span></td></tr>
          <tr><td>Wayflyer</td><td class="num">$1.5M</td><td class="num">18mo</td><td class="num">1.1Ã—</td><td><span class="t t-gr">12 months</span></td></tr>
          <tr><td>Q-CTRL</td><td class="num">$1.8M</td><td class="num">24mo</td><td class="num">1.2Ã—</td><td><span class="t t-gr">18 months</span></td></tr>
          <tr><td>Matillion</td><td class="num">$2.0M</td><td class="num">22mo</td><td class="num">1.3Ã—</td><td><span class="t t-or">18 months</span></td></tr>
          <tr><td>Multiverse</td><td class="num">$2.2M</td><td class="num">20mo</td><td class="num">1.4Ã—</td><td><span class="t t-or">24 months</span></td></tr>
          <tr><td>Quantexa</td><td class="num">$2.5M</td><td class="num">18mo</td><td class="num">1.5Ã—</td><td><span class="t t-or">20 months</span></td></tr>
          <tr><td>Headway</td><td class="num">$1.0M</td><td class="num">20mo</td><td class="num">1.6Ã—</td><td><span class="t t-or">24 months</span></td></tr>
          <tr><td>Sanity</td><td class="num">$1.2M</td><td class="num">16mo</td><td class="num">2.0Ã—</td><td><span class="t t-re">30 months</span></td></tr>
          <tr><td>d-Matrix</td><td class="num">$3.5M</td><td class="num">14mo</td><td class="num">4.2Ã—</td><td><span class="t t-re">&gt;36 months</span></td></tr>
        </tbody></table>
      </div></div>
    </div>
  </div>
  <div class="spane" id="cs3">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Net Revenue Retention</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-c-nrr"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Customer Quality Matrix</h3></div><div class="cb-0">
        <table class="tbl"><thead><tr><th>Company</th><th class="num">NRR</th><th class="num">Gr.Churn</th><th class="num">Net Exp.</th><th>Quality</th></tr></thead>
        <tbody>
          <tr><td>Q-CTRL</td><td class="num">145%</td><td class="num">3%</td><td class="num">48%</td><td><span class="t t-gr">Elite</span></td></tr>
          <tr><td>Matillion</td><td class="num">130%</td><td class="num">8%</td><td class="num">38%</td><td><span class="t t-gr">Strong</span></td></tr>
          <tr><td>Quantexa</td><td class="num">128%</td><td class="num">7%</td><td class="num">35%</td><td><span class="t t-gr">Strong</span></td></tr>
          <tr><td>Multiverse</td><td class="num">122%</td><td class="num">10%</td><td class="num">32%</td><td><span class="t t-bl">Good</span></td></tr>
          <tr><td>Ledger</td><td class="num">118%</td><td class="num">5%</td><td class="num">23%</td><td><span class="t t-bl">Good</span></td></tr>
          <tr><td>Wayflyer</td><td class="num">115%</td><td class="num">12%</td><td class="num">27%</td><td><span class="t t-bl">Good</span></td></tr>
          <tr><td>Booksy</td><td class="num">110%</td><td class="num">9%</td><td class="num">19%</td><td><span class="t t-or">Moderate</span></td></tr>
          <tr><td>Sanity</td><td class="num">105%</td><td class="num">15%</td><td class="num">20%</td><td><span class="t t-re">Weak</span></td></tr>
          <tr><td>Headway</td><td class="num">95%</td><td class="num">18%</td><td class="num">13%</td><td><span class="t t-re">Weak</span></td></tr>
          <tr><td>d-Matrix</td><td class="num">N/A</td><td class="num">â€”</td><td class="num">â€”</td><td><span class="t t-pu">Pre-scale</span></td></tr>
        </tbody></table>
      </div></div>
    </div>
  </div>
</div>

<!-- PAGE: PIPELINE -->
<div class="pg" id="pg-pipeline">
  <div class="sec-hdr"><h2>Deal Pipeline</h2><p>Fund VI Â· $137M dry powder Â· 14 active opportunities tracked</p></div>
  <div class="kpi-row">
    <div class="kpi"><div class="kpi-label">Tracking</div><div class="kpi-val">8</div><div class="kpi-sub neu">In active coverage</div></div>
    <div class="kpi"><div class="kpi-label">Deep Diligence</div><div class="kpi-val">4</div><div class="kpi-sub or">Active DD</div></div>
    <div class="kpi"><div class="kpi-label">IC Ready</div><div class="kpi-val">2</div><div class="kpi-sub up">Term sheets pending</div></div>
    <div class="kpi"><div class="kpi-label">Est. Deploy H2 2025</div><div class="kpi-val">$50M</div><div class="kpi-sub neu">From dry powder</div></div>
  </div>
  <div class="grid g32">
    <div class="card"><div class="ch"><h3>Pipeline Kanban</h3></div><div class="cb" id="pipeline-kanban"></div></div>
    <div class="card"><div class="ch"><h3>Sector Focus</h3></div><div class="cb"><div class="cw cw220"><canvas id="ch-pipe-sector"></canvas></div><div id="pipe-notes" style="margin-top:10px;font-family:var(--font-mono);font-size:11px;color:var(--text-mid);line-height:1.6"></div></div></div>
  </div>
  <div class="card" style="margin-top:14px"><div class="ch"><h3>Pipeline Detail</h3></div><div class="cb-0">
    <table class="tbl" id="tbl-pipeline"><thead><tr><th>Company</th><th>Sector</th><th>Stage</th><th class="num">ARR($M)</th><th class="num">ARR Gr%</th><th class="num">Ask Val($M)</th><th class="num">EV/ARR</th><th>Source</th><th>Priority</th></tr></thead><tbody></tbody></table>
  </div></div>
</div>

<!-- PAGE: EXITS -->
<div class="pg" id="pg-exits">
  <div class="sec-hdr"><h2>Exit Strategy</h2><p>Readiness scoring with milestone gaps, scenarios, timing, buyer universe</p></div>
  <div class="stabs" id="ex-tabs">
    <div class="stab on" onclick="est(0)">Exit Readiness</div>
    <div class="stab" onclick="est(1)">Scenario Matrix</div>
    <div class="stab" onclick="est(2)">IRR Timing</div>
    <div class="stab" onclick="est(3)">Buyer Universe</div>
  </div>
  <div class="spane on" id="es0">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Readiness Scores â€” With Milestone Gaps</h3></div><div class="cb" id="exit-readiness-scores"></div></div>
      <div class="card"><div class="ch"><h3>Criteria Check</h3></div><div class="cb-0">
        <table class="tbl"><thead><tr><th>Company</th><th>ARR&gt;$40M</th><th>GM&gt;65%</th><th>Burn&lt;1.5Ã—</th><th>Ready?</th></tr></thead>
        <tbody>
          <tr><td>Ledger</td><td><span class="t t-gr">âœ“ $85M</span></td><td><span class="t t-gr">âœ“ 72%</span></td><td><span class="t t-gr">âœ“ 0.6Ã—</span></td><td><span class="t t-gr">READY</span></td></tr>
          <tr><td>Matillion</td><td><span class="t t-gr">âœ“ $62M</span></td><td><span class="t t-gr">âœ“ 70%</span></td><td><span class="t t-gr">âœ“ 1.3Ã—</span></td><td><span class="t t-gr">READY</span></td></tr>
          <tr><td>Wayflyer</td><td><span class="t t-gr">âœ“ $42M</span></td><td><span class="t t-gr">âœ“ 68%</span></td><td><span class="t t-gr">âœ“ 1.1Ã—</span></td><td><span class="t t-gr">READY</span></td></tr>
          <tr><td>Quantexa</td><td><span class="t t-gr">âœ“ $72M</span></td><td><span class="t t-gr">âœ“ 68%</span></td><td><span class="t t-or">âš  1.5Ã—</span></td><td><span class="t t-or">NEAR</span></td></tr>
          <tr><td>Multiverse</td><td><span class="t t-gr">âœ“ $48M</span></td><td><span class="t t-gr">âœ“ 66%</span></td><td><span class="t t-gr">âœ“ 1.4Ã—</span></td><td><span class="t t-or">NEAR</span></td></tr>
          <tr><td>Booksy</td><td><span class="t t-re">âœ— $38M</span></td><td><span class="t t-gr">âœ“ 71%</span></td><td><span class="t t-gr">âœ“ 0.7Ã—</span></td><td><span class="t t-or">NEAR</span></td></tr>
          <tr><td>Q-CTRL</td><td><span class="t t-re">âœ— $18M</span></td><td><span class="t t-gr">âœ“ 75%</span></td><td><span class="t t-gr">âœ“ 1.2Ã—</span></td><td><span class="t t-re">NOT YET</span></td></tr>
          <tr><td>d-Matrix</td><td><span class="t t-re">âœ— $5M</span></td><td><span class="t t-re">âœ— 45%</span></td><td><span class="t t-re">âœ— 4.2Ã—</span></td><td><span class="t t-re">NOT YET</span></td></tr>
        </tbody></table>
      </div></div>
    </div>
  </div>
  <div class="spane" id="es1">
    <div class="grid g32">
      <!-- Controls -->
      <div>
        <div class="card">
          <div class="ch"><h3>Exit Assumption Controls</h3></div>
          <div class="cb">
            <div class="ctrl-section">Exit Multiples (EV/ARR)</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Bear EV/ARR</span>
              <input type="range" id="ex-bear" min="2" max="12" step="0.5" value="5" class="red-range" oninput="exitUpdate()">
              <span class="ctrl-val" id="exv-bear">5Ã—</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Base EV/ARR</span>
              <input type="range" id="ex-base" min="6" max="25" step="0.5" value="12" oninput="exitUpdate()">
              <span class="ctrl-val" id="exv-base">12Ã—</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Bull EV/ARR</span>
              <input type="range" id="ex-bull" min="12" max="50" step="1" value="22" class="green-range" oninput="exitUpdate()">
              <span class="ctrl-val" id="exv-bull">22Ã—</span>
            </div>
            <div class="ctrl-section" style="margin-top:12px">Probability Weights</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Bear probability</span>
              <input type="range" id="ex-pbear" min="0" max="60" value="20" class="red-range" oninput="exitProbUpdate('bear',this.value)">
              <span class="ctrl-val" id="expv-bear">20%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Base probability</span>
              <input type="range" id="ex-pbase" min="0" max="70" value="50" oninput="exitProbUpdate('base',this.value)">
              <span class="ctrl-val" id="expv-base">50%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Bull probability</span>
              <input type="range" id="ex-pbull" min="0" max="60" value="30" class="green-range" oninput="exitProbUpdate('bull',this.value)">
              <span class="ctrl-val" id="expv-bull">30%</span>
            </div>
            <div style="font-family:var(--font-mono);font-size:11px;padding:5px 0;color:var(--text-dim)">
              Total: <span id="exit-prob-total" style="color:var(--green)">100%</span>
            </div>
            <div class="ctrl-section" style="margin-top:12px">Deal Adjustments</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Avg Exit Year</span>
              <input type="range" id="ex-yr" min="2025" max="2032" value="2027" oninput="exitUpdate()">
              <span class="ctrl-val" id="exv-yr">2027</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Future rd dilution</span>
              <input type="range" id="ex-dil" min="0" max="40" value="15" class="red-range" oninput="exitUpdate()">
              <span class="ctrl-val" id="exv-dil">15%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">AI/Quantum premium</span>
              <input type="range" id="ex-ai-prem" min="-20" max="80" value="30" class="purple-range" oninput="exitUpdate()">
              <span class="ctrl-val" id="exv-ai-prem">30%</span>
            </div>
          </div>
        </div>
        <div class="grid g2" style="margin-top:14px">
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">P-Wtd Portfolio EV</span></div><div class="live-kpi-val" id="ex-total-ev">â€”</div></div>
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Implied Fund MOIC</span></div><div class="live-kpi-val" id="ex-fund-moic">â€”</div></div>
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Expected DPI</span></div><div class="live-kpi-val" id="ex-dpi">â€”</div></div>
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Implied Fund IRR</span></div><div class="live-kpi-val" id="ex-irr">â€”</div></div>
        </div>
      </div>
      <!-- Live results -->
      <div>
        <div class="card">
          <div class="ch"><h3>Scenario Matrix â€” Live</h3><span class="t t-dim" id="exit-mult-label">Bear 5Ã— / Base 12Ã— / Bull 22Ã—</span></div>
          <div class="cb-0" id="exit-matrix-table"></div>
        </div>
        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>P-Weighted Expected Proceeds</h3></div>
          <div class="cb"><div class="cw cw280"><canvas id="ch-e-fundret"></canvas></div></div>
        </div>
      </div>
    </div>
  </div>
    <div class="spane" id="es2">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Exit Now vs Wait â€” IRR Impact</h3></div><div class="cb"><div class="cw cw340"><canvas id="ch-e-timing"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>IRR Decay Analysis</h3></div><div class="cb-0">
        <table class="tbl"><thead><tr><th>Company</th><th class="num">Now</th><th class="num">+1Y</th><th class="num">+2Y</th><th class="num">Decay/yr</th><th>Rec.</th></tr></thead>
        <tbody>
          <tr><td>Quantexa</td><td class="num">22.1%</td><td class="num">20.5%</td><td class="num">18.8%</td><td class="num dn">âˆ’1.7%</td><td><span class="t t-gr">Exit 2025</span></td></tr>
          <tr><td>Ledger</td><td class="num">18.2%</td><td class="num">15.8%</td><td class="num">13.5%</td><td class="num dn">âˆ’2.4%</td><td><span class="t t-gr">Exit 2025</span></td></tr>
          <tr><td>Matillion</td><td class="num">16.8%</td><td class="num">15.2%</td><td class="num">13.9%</td><td class="num dn">âˆ’1.5%</td><td><span class="t t-or">IPO H2 2025</span></td></tr>
          <tr><td>Booksy</td><td class="num">15.5%</td><td class="num">13.8%</td><td class="num">12.1%</td><td class="num dn">âˆ’1.7%</td><td><span class="t t-or">2026â€“27</span></td></tr>
          <tr><td>d-Matrix</td><td class="num">12.4%</td><td class="num">10.3%</td><td class="num">8.2%</td><td class="num dn">âˆ’2.1%</td><td><span class="t t-re">Hold for scale</span></td></tr>
        </tbody></table>
      </div></div>
    </div>
  </div>
  <div class="spane" id="es3">
    <div class="card"><div class="ch"><h3>Buyer Universe â€” Strategic & Financial + M&A Comps</h3></div><div class="cb-0">
      <table class="tbl"><thead><tr><th>Company</th><th>Strategic Buyers</th><th>Financial Buyers</th><th>IPO Path</th><th class="num">M&amp;A EV/ARR Comp</th></tr></thead>
      <tbody>
        <tr><td class="name-cell">Q-CTRL</td><td>IBM, Google, Honeywell</td><td>Insight Partners, General Atlantic</td><td><span class="t t-or">2027+</span></td><td class="num">15â€“25Ã—</td></tr>
        <tr><td class="name-cell">Multiverse</td><td>Salesforce, Workday, LinkedIn</td><td>KKR, Permira</td><td><span class="t t-or">2027+</span></td><td class="num">8â€“12Ã—</td></tr>
        <tr><td class="name-cell">d-Matrix</td><td>NVIDIA, AMD, Intel</td><td>SoftBank, Tiger Global</td><td><span class="t t-re">2028+</span></td><td class="num">20â€“40Ã—</td></tr>
        <tr><td class="name-cell">Ledger</td><td>PayPal, Visa, Fidelity</td><td>Thoma Bravo, Vista</td><td><span class="t t-gr">Ready</span></td><td class="num">18â€“22Ã—</td></tr>
        <tr><td class="name-cell">Matillion</td><td>Snowflake, Databricks, SAP</td><td>Thoma Bravo, Insight</td><td><span class="t t-gr">H2 2025</span></td><td class="num">9â€“14Ã—</td></tr>
        <tr><td class="name-cell">Quantexa</td><td>Palantir, RELX, Thomson Reuters</td><td>Warburg, Advent</td><td><span class="t t-gr">2026</span></td><td class="num">12â€“18Ã—</td></tr>
        <tr><td class="name-cell">Wayflyer</td><td>Stripe, Shopify, Square</td><td>General Atlantic</td><td><span class="t t-or">2027</span></td><td class="num">7â€“10Ã—</td></tr>
        <tr><td class="name-cell">Booksy</td><td>Block, Mindbody, Toast</td><td>Summit Partners</td><td><span class="t t-or">2027</span></td><td class="num">5â€“8Ã—</td></tr>
      </tbody></table>
    </div></div>
  </div>
</div>

<!-- PAGE: RISK -->
<div class="pg" id="pg-risk">
  <div class="sec-hdr"><h2>Risk & Stress Testing</h2><p>Interactive scenario builder â€” drag sliders, adjust assumptions, see live NAV impact</p></div>
  <div class="stabs" id="ri-tabs">
    <div class="stab on" onclick="rst(0)">Scenario Builder</div>
    <div class="stab" onclick="rst(1)">Macro Sensitivity</div>
    <div class="stab" onclick="rst(2)">FX Stress</div>
    <div class="stab" onclick="rst(3)">Watch List</div>
  </div>

  <!-- SCENARIO BUILDER (interactive) -->
  <div class="spane on" id="rs0">
    <div class="grid g32">
      <!-- Left: controls -->
      <div>
        <div class="card">
          <div class="ch"><h3>Scenario Assumptions</h3><span class="t t-or" id="scen-label">Custom</span></div>
          <div class="cb">
            <div class="ctrl-section">Quick Presets</div>
            <div class="chip-row" id="scen-presets">
              <div class="chip on" onclick="applyPreset('base',this)">Base Case</div>
              <div class="chip" onclick="applyPreset('soft',this)">Soft Landing</div>
              <div class="chip" onclick="applyPreset('mild',this)">Mild Recession</div>
              <div class="chip" onclick="applyPreset('deep',this)">Deep Recession</div>
              <div class="chip" onclick="applyPreset('tech',this)">Tech Correction</div>
              <div class="chip" onclick="applyPreset('ai',this)">AI Acceleration</div>
            </div>

            <div class="ctrl-section" style="margin-top:12px">Revenue Assumptions</div>
            <div class="ctrl-row">
              <span class="ctrl-label">ARR Growth Rate</span>
              <input type="range" id="sl-arr-gr" min="-30" max="120" value="55" class="green-range" oninput="scUpdate()">
              <span class="ctrl-val" id="sv-arr-gr">55%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Gross Margin Change</span>
              <input type="range" id="sl-gm" min="-20" max="10" value="0" oninput="scUpdate()">
              <span class="ctrl-val" id="sv-gm">0pp</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Net Revenue Retention</span>
              <input type="range" id="sl-nrr" min="70" max="150" value="118" class="green-range" oninput="scUpdate()">
              <span class="ctrl-val" id="sv-nrr">118%</span>
            </div>

            <div class="ctrl-section" style="margin-top:12px">Multiple / Valuation</div>
            <div class="ctrl-row">
              <span class="ctrl-label">EV/ARR Multiple Change</span>
              <input type="range" id="sl-evmult" min="-60" max="40" value="0" oninput="scUpdate()">
              <span class="ctrl-val" id="sv-evmult">0%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Discount Rate (IRR hurdle)</span>
              <input type="range" id="sl-dr" min="5" max="18" value="8" class="blue-range" oninput="scUpdate()">
              <span class="ctrl-val" id="sv-dr">8%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Exit Timing Shift</span>
              <input type="range" id="sl-timing" min="-12" max="24" value="0" oninput="scUpdate()">
              <span class="ctrl-val" id="sv-timing">0 mo</span>
            </div>

            <div class="ctrl-section" style="margin-top:12px">Macro Environment</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Rate Change (bps)</span>
              <input type="range" id="sl-rates" min="-300" max="200" value="0" class="blue-range" oninput="scUpdate()">
              <span class="ctrl-val" id="sv-rates">0</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">USD/EUR FX Shift</span>
              <input type="range" id="sl-fx" min="-20" max="20" value="0" oninput="scUpdate()">
              <span class="ctrl-val" id="sv-fx">0%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Write-off Risk (%NAV)</span>
              <input type="range" id="sl-wo" min="0" max="30" value="0" class="red-range" oninput="scUpdate()">
              <span class="ctrl-val" id="sv-wo">0%</span>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Probability Weights</h3><span class="t t-dim" id="prob-total-lbl">100%</span></div>
          <div class="cb" id="prob-weights">
            <!-- rendered by JS -->
          </div>
        </div>
      </div>

      <!-- Right: live results -->
      <div>
        <div class="grid g2" style="margin-bottom:14px">
          <div class="live-card" id="lc-nav">
            <div class="live-kpi"><span class="live-kpi-lbl">Scenario NAV</span></div>
            <div class="live-kpi-val" id="lv-nav">$294M</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);margin-top:4px" id="lv-nav-delta">Base case</div>
          </div>
          <div class="live-card" id="lc-irr">
            <div class="live-kpi"><span class="live-kpi-lbl">Scenario IRR</span></div>
            <div class="live-kpi-val" id="lv-irr">12.4%</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);margin-top:4px" id="lv-irr-delta">â€”</div>
          </div>
          <div class="live-card" id="lc-tvpi">
            <div class="live-kpi"><span class="live-kpi-lbl">Scenario TVPI</span></div>
            <div class="live-kpi-val" id="lv-tvpi">1.40Ã—</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);margin-top:4px" id="lv-tvpi-delta">â€”</div>
          </div>
          <div class="live-card" id="lc-dpi">
            <div class="live-kpi"><span class="live-kpi-lbl">Expected DPI</span></div>
            <div class="live-kpi-val" id="lv-dpi">0.00Ã—</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);margin-top:4px" id="lv-dpi-delta">First dist. est.</div>
          </div>
        </div>

        <div class="card">
          <div class="ch"><h3>NAV Distribution â€” Scenario Comparison</h3></div>
          <div class="cb"><div class="cw cw300"><canvas id="ch-r-scenarios"></canvas></div></div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Per-Company NAV Impact</h3></div>
          <div class="cb" id="co-impact-bars">
            <!-- rendered by JS -->
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Probability-Weighted Expected NAV</h3></div>
          <div class="cb"><div class="cw cw260"><canvas id="ch-r-pwav"></canvas></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- MACRO SENSITIVITY (interactive) -->
  <div class="spane" id="rs1">
    <div class="grid g32">
      <div>
        <div class="card">
          <div class="ch"><h3>Macro Factor Controls</h3></div>
          <div class="cb">
            <div class="ctrl-section">Interest Rates</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Fed Funds Rate</span>
              <input type="range" id="ms-fed" min="0" max="800" value="525" class="blue-range" oninput="macroUpdate()">
              <span class="ctrl-val" id="msv-fed">5.25%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">10yr Treasury Yield</span>
              <input type="range" id="ms-10yr" min="100" max="600" value="430" class="blue-range" oninput="macroUpdate()">
              <span class="ctrl-val" id="msv-10yr">4.30%</span>
            </div>

            <div class="ctrl-section" style="margin-top:12px">Growth & Inflation</div>
            <div class="ctrl-row">
              <span class="ctrl-label">US GDP Growth</span>
              <input type="range" id="ms-gdp" min="-4" max="6" value="2" oninput="macroUpdate()">
              <span class="ctrl-val" id="msv-gdp">2.0%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">CPI Inflation</span>
              <input type="range" id="ms-cpi" min="0" max="10" value="3" oninput="macroUpdate()">
              <span class="ctrl-val" id="msv-cpi">3.0%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Enterprise IT Spend Gr</span>
              <input type="range" id="ms-it" min="-10" max="20" value="8" class="green-range" oninput="macroUpdate()">
              <span class="ctrl-val" id="msv-it">8%</span>
            </div>

            <div class="ctrl-section" style="margin-top:12px">VC Market</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Median SaaS EV/Rev Mult</span>
              <input type="range" id="ms-saas" min="4" max="30" value="13" oninput="macroUpdate()">
              <span class="ctrl-val" id="msv-saas">13Ã—</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Global VC Funding ($B/Q)</span>
              <input type="range" id="ms-vc" min="20" max="100" value="58" class="green-range" oninput="macroUpdate()">
              <span class="ctrl-val" id="msv-vc">$58B</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">IPO Window</span>
              <div class="chip-row" style="flex:1" id="ipo-chips">
                <div class="chip" onclick="setIPO('closed',this)">Closed</div>
                <div class="chip on" onclick="setIPO('selective',this)">Selective</div>
                <div class="chip" onclick="setIPO('open',this)">Open</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <div class="card">
          <div class="ch"><h3>Platform NAV Sensitivity</h3></div>
          <div class="cb"><div class="cw cw320"><canvas id="ch-r-macro"></canvas></div></div>
        </div>
        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Sector Beta Impact</h3></div>
          <div class="cb" id="sector-beta-bars"><!-- rendered by JS --></div>
        </div>
      </div>
    </div>
  </div>

  <!-- FX STRESS (interactive) -->
  <div class="spane" id="rs2">
    <div class="grid g32">
      <div>
        <div class="card">
          <div class="ch"><h3>Currency Exposure & Hedging</h3></div>
          <div class="cb">
            <div class="ctrl-section">Spot Rate Shocks</div>
            <div class="ctrl-row">
              <span class="ctrl-label">GBP/USD Shift</span>
              <input type="range" id="fx-gbp" min="-25" max="25" value="0" oninput="fxUpdate()">
              <span class="ctrl-val" id="fxv-gbp">0%</span>
              <span class="ctrl-sub" id="fxi-gbp">$0M</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">EUR/USD Shift</span>
              <input type="range" id="fx-eur" min="-25" max="25" value="0" oninput="fxUpdate()">
              <span class="ctrl-val" id="fxv-eur">0%</span>
              <span class="ctrl-sub" id="fxi-eur">$0M</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">AUD/USD Shift</span>
              <input type="range" id="fx-aud" min="-25" max="25" value="0" oninput="fxUpdate()">
              <span class="ctrl-val" id="fxv-aud">0%</span>
              <span class="ctrl-sub" id="fxi-aud">$0M</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">ILS/USD Shift</span>
              <input type="range" id="fx-ils" min="-25" max="25" value="0" oninput="fxUpdate()">
              <span class="ctrl-val" id="fxv-ils">0%</span>
              <span class="ctrl-sub" id="fxi-ils">$0M</span>
            </div>
            <div class="ctrl-section" style="margin-top:12px">Hedging Coverage</div>
            <div class="ctrl-row">
              <span class="ctrl-label">GBP Hedge Ratio</span>
              <input type="range" id="fx-hgbp" min="0" max="100" value="0" class="green-range" oninput="fxUpdate()">
              <span class="ctrl-val" id="fxhv-gbp">0%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">EUR Hedge Ratio</span>
              <input type="range" id="fx-heur" min="0" max="100" value="40" class="green-range" oninput="fxUpdate()">
              <span class="ctrl-val" id="fxhv-eur">40%</span>
            </div>
          </div>
        </div>

        <div class="grid g2" style="margin-top:14px">
          <div class="live-card">
            <div class="live-kpi"><span class="live-kpi-lbl">Total FX Impact</span></div>
            <div class="live-kpi-val" id="fx-total-nav">$0M</div>
          </div>
          <div class="live-card">
            <div class="live-kpi"><span class="live-kpi-lbl">Hedged NAV Impact</span></div>
            <div class="live-kpi-val" id="fx-hedged-nav">$0M</div>
          </div>
        </div>
      </div>
      <div>
        <div class="card">
          <div class="ch"><h3>FX Exposure by Currency</h3></div>
          <div class="cb"><div class="cw cw260"><canvas id="ch-r-fx"></canvas></div></div>
        </div>
        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Stress Scenario Outcomes</h3></div>
          <div class="cb" id="fx-stress-table"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- WATCH LIST -->
  <div class="spane" id="rs3">
    <div class="card"><div class="ch"><h3>Watch List</h3><span class="t t-re">4 Items Requiring Action</span></div><div class="cb-0">
      <table class="tbl"><thead><tr><th>Company</th><th>Flag</th><th>Detail</th><th>Threshold</th><th>Action</th><th>Owner</th><th>Due</th></tr></thead>
      <tbody>
        <tr><td class="name-cell">Q-CTRL</td><td><span class="t t-re">Concentration</span></td><td>27.9% Fund VI NAV â€” above 25% IC limit</td><td>&gt;25% single-name</td><td>IC discussion â€” secondary / co-invest</td><td>Managing Partner</td><td class="num">Q2 2025</td></tr>
        <tr><td class="name-cell">d-Matrix</td><td><span class="t t-or">Runway</span></td><td>$3.5M/mo burn, 14mo runway</td><td>&lt;12mo triggers bridge</td><td>Monitor; Series C Q3 2025</td><td>VP Portfolio</td><td class="num">Q3 2025</td></tr>
        <tr><td class="name-cell">Sanity</td><td><span class="t t-or">Growth Decel</span></td><td>ARR growth 46%â†’38% over 2Q</td><td>&lt;35% triggers review</td><td>Board call â€” GTM / new VP Sales</td><td>Board Director</td><td class="num">Q2 2025</td></tr>
        <tr><td class="name-cell">Headway</td><td><span class="t t-re">NRR &lt;100%</span></td><td>NRR 95%, gross churn 18%</td><td>&lt;100% NRR for 2Q+</td><td>PMF review; conversion funnel audit</td><td>Board Director</td><td class="num">Q2 2025</td></tr>
      </tbody></table>
    </div></div>
  </div>
</div>

<!-- PAGE: LP VIEW -->
<div class="pg" id="pg-lp">
  <div class="sec-hdr"><h2>LP Reporting</h2><p>Fund VI Â· Capital accounts, cash flow forecast, attribution</p></div>
  <div class="stabs" id="lp-tabs">
    <div class="stab on" onclick="lst(0)">LP Overview</div>
    <div class="stab" onclick="lst(1)">Capital Account</div>
    <div class="stab" onclick="lst(2)">Cash Flow Forecast</div>
    <div class="stab" onclick="lst(3)">Performance Attribution</div>
  </div>
  <div class="spane on" id="ls0">
    <div class="kpi-row">
      <div class="kpi"><div class="kpi-label">Committed</div><div class="kpi-val">$431M</div></div>
      <div class="kpi"><div class="kpi-label">Called</div><div class="kpi-val">$294M</div><div class="kpi-sub neu">68%</div></div>
      <div class="kpi"><div class="kpi-label">Distributions (DPI)</div><div class="kpi-val">$0M</div><div class="kpi-sub neu">First est. Q3 2026</div></div>
      <div class="kpi"><div class="kpi-label">Net IRR</div><div class="kpi-val">12.4%</div><div class="kpi-sub up">â†‘ from 10.2%</div></div>
      <div class="kpi"><div class="kpi-label">Hurdle Rate</div><div class="kpi-val">8.0%</div><div class="kpi-sub up">4.4pp above hurdle</div></div>
    </div>
    <div class="card"><div class="ch"><h3>LP Commitments â€” Fund VI</h3></div><div class="cb-0">
      <table class="tbl" id="tbl-lp"><thead><tr><th>Limited Partner</th><th>Type</th><th class="num">Commit</th><th class="num">Called</th><th class="num">Dist</th><th class="num">NAV</th><th class="num">Net IRR</th><th class="num">TVPI</th></tr></thead><tbody></tbody></table>
    </div></div>
  </div>
  <div class="spane" id="ls1">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Capital Call Schedule</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-l-calls"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>LP Type Mix</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-l-type"></canvas></div></div></div>
    </div>
  </div>
  <div class="spane" id="ls2">
    <div class="alert a-bl">First distributions expected Q3 2026 from Matillion IPO and Ledger M&amp;A. Modeled using exit readiness scores and ARR trajectory.</div>
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Projected DPI Build 2025â€“2030</h3><span class="t t-bl">Base / Bull / Bear</span></div><div class="cb"><div class="cw cw300"><canvas id="ch-l-dpi-build"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Cash Flow Waterfall â€” Calls vs Distributions</h3></div><div class="cb"><div class="cw cw300"><canvas id="ch-l-cf"></canvas></div></div></div>
    </div>
    <div class="card" style="margin-top:14px"><div class="ch"><h3>Expected Distribution Events</h3></div><div class="cb-0">
      <table class="tbl"><thead><tr><th>Event</th><th>Company</th><th class="num">Expected Date</th><th class="num">Proceeds Est.</th><th class="num">DPI Contribution</th><th>Confidence</th></tr></thead>
      <tbody>
        <tr><td>IPO</td><td class="name-cell">Matillion</td><td class="num">Q4 2025</td><td class="num">$28â€“42M</td><td class="num">0.07â€“0.10Ã—</td><td><span class="t t-or">Medium</span></td></tr>
        <tr><td>M&amp;A</td><td class="name-cell">Ledger</td><td class="num">Q2 2026</td><td class="num">$45â€“65M</td><td class="num">0.10â€“0.15Ã—</td><td><span class="t t-gr">High</span></td></tr>
        <tr><td>Secondary</td><td class="name-cell">Q-CTRL</td><td class="num">Q3 2025</td><td class="num">$15â€“20M</td><td class="num">0.04â€“0.05Ã—</td><td><span class="t t-or">Medium</span></td></tr>
        <tr><td>M&amp;A</td><td class="name-cell">Quantexa</td><td class="num">Q1 2026</td><td class="num">$38â€“56M</td><td class="num">0.09â€“0.13Ã—</td><td><span class="t t-or">Medium</span></td></tr>
        <tr><td>IPO</td><td class="name-cell">Wayflyer</td><td class="num">2027</td><td class="num">$32â€“48M</td><td class="num">0.07â€“0.11Ã—</td><td><span class="t t-re">Low</span></td></tr>
      </tbody></table>
    </div></div>
  </div>
  <div class="spane" id="ls3">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Gross to Net Bridge</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-l-bridge"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Fee & Carry Impact</h3></div><div class="cb-0">
        <table class="tbl"><thead><tr><th>Item</th><th class="num">Amount</th><th class="num">% of Gross</th></tr></thead>
        <tbody>
          <tr><td>Gross Return (NAV)</td><td class="num">$294M</td><td class="num">100%</td></tr>
          <tr><td>Management Fee (2%)</td><td class="num dn">âˆ’$17.6M</td><td class="num dn">6.0%</td></tr>
          <tr><td>Carried Interest (20%)</td><td class="num">$0M</td><td class="num">0% (below hurdle)</td></tr>
          <tr><td>Fund Expenses</td><td class="num dn">âˆ’$2.8M</td><td class="num dn">1.0%</td></tr>
          <tr style="border-top:1px solid var(--border3)"><td style="font-weight:600">Net Return to LPs</td><td class="num up" style="font-weight:600">$273.6M</td><td class="num up" style="font-weight:600">93.1%</td></tr>
        </tbody></table>
      </div></div>
    </div>
  </div>
</div>

<!-- PAGE: INVESTORS -->
<div class="pg" id="pg-investors">
  <div class="sec-hdr"><h2>Investor Relations</h2><p>LP relationships across all 6 funds Â· Re-up history Â· Fund VII pipeline</p></div>
  <div class="stabs" id="inv-tabs">
    <div class="stab on" onclick="ivt(0)">LP Directory</div>
    <div class="stab" onclick="ivt(1)">Re-Up History</div>
    <div class="stab" onclick="ivt(2)">Fund VII Pipeline</div>
    <div class="stab" onclick="ivt(3)">Communication Log</div>
  </div>
  <div class="spane on" id="ivs0">
    <div class="kpi-row">
      <div class="kpi"><div class="kpi-label">Total LP Relationships</div><div class="kpi-val">42</div></div>
      <div class="kpi"><div class="kpi-label">Fund VI LPs</div><div class="kpi-val">8</div></div>
      <div class="kpi"><div class="kpi-label">Re-Up Rate (IVâ†’V)</div><div class="kpi-val">89%</div><div class="kpi-sub up">Top decile retention</div></div>
      <div class="kpi"><div class="kpi-label">Fund VII Target</div><div class="kpi-val">â‚¬600M</div><div class="kpi-sub neu">Launch H2 2026</div></div>
    </div>
    <div class="card"><div class="ch"><h3>LP Directory â€” All Active Relationships</h3></div><div class="cb-0">
      <table class="tbl" id="tbl-lp-dir"><thead><tr><th>Limited Partner</th><th>HQ</th><th>Type</th><th class="num">Total Committed</th><th>Funds</th><th>Re-Up</th><th>Fund VII</th><th>Next Touch</th></tr></thead><tbody></tbody></table>
    </div></div>
  </div>
  <div class="spane" id="ivs1">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Re-Up Rates by Fund Transition</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-inv-reup"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>LP Retention by Type</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-inv-ret"></canvas></div></div></div>
    </div>
    <div class="card" style="margin-top:14px"><div class="ch"><h3>Re-Up Matrix</h3></div><div class="cb-0">
      <table class="tbl" id="tbl-reup"><thead><tr><th>Limited Partner</th><th>Fund I</th><th>Fund II</th><th>Fund III</th><th>Fund IV</th><th>Fund V</th><th>Fund VI</th><th>Fund VII</th></tr></thead><tbody></tbody></table>
    </div></div>
  </div>
  <div class="spane" id="ivs2">
    <div class="alert a-go">Fund VII targeting â‚¬600M with launch H2 2026. Soft-circle: â‚¬280M. Re-up conversations begin Q1 2026 after first Fund VI distributions.</div>
    <div class="kpi-row">
      <div class="kpi"><div class="kpi-label">Fund VII Target</div><div class="kpi-val">â‚¬600M</div></div>
      <div class="kpi"><div class="kpi-label">Soft-Circled</div><div class="kpi-val">â‚¬280M</div><div class="kpi-sub up">47% of target</div></div>
      <div class="kpi"><div class="kpi-label">New LP Pipeline</div><div class="kpi-val">â‚¬185M</div><div class="kpi-sub neu">6 prospects</div></div>
      <div class="kpi"><div class="kpi-label">Hard Close Est.</div><div class="kpi-val">Q2 2027</div></div>
    </div>
    <div class="card"><div class="ch"><h3>Fund VII LP Pipeline</h3></div><div class="cb-0">
      <table class="tbl"><thead><tr><th>Prospect</th><th>Type</th><th class="num">Target (â‚¬M)</th><th>Relationship</th><th>Status</th><th>Key Concern</th><th>Owner</th></tr></thead>
      <tbody>
        <tr><td>Schroder Adveq</td><td>FoF</td><td class="num">80</td><td>Existing LP</td><td><span class="t t-gr">Soft-circled</span></td><td>Strategy continuity</td><td>Managing Partner</td></tr>
        <tr><td>APG Asset Mgmt</td><td>Pension</td><td class="num">60</td><td>Existing LP</td><td><span class="t t-gr">Soft-circled</span></td><td>ESG requirements</td><td>IR Director</td></tr>
        <tr><td>Neuberger Berman</td><td>FoF</td><td class="num">55</td><td>Existing LP</td><td><span class="t t-or">In discussion</span></td><td>AI/quantum concentration</td><td>Managing Partner</td></tr>
        <tr><td>CPP Investments</td><td>Pension</td><td class="num">100</td><td>New LP</td><td><span class="t t-or">Meeting Q2</span></td><td>Track record depth</td><td>IR Director</td></tr>
        <tr><td>NBIM (Norges Bank)</td><td>SWF</td><td class="num">80</td><td>New LP</td><td><span class="t t-bl">Initial contact</span></td><td>Fund size / terms</td><td>Managing Partner</td></tr>
        <tr><td>Hamilton Lane</td><td>FoF</td><td class="num">50</td><td>New LP</td><td><span class="t t-bl">Initial contact</span></td><td>GP commitment level</td><td>IR Director</td></tr>
      </tbody></table>
    </div></div>
  </div>
  <div class="spane" id="ivs3">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Recent LP Communications</h3></div><div class="cb"><div class="tl" id="lp-timeline"></div></div></div>
      <div class="card"><div class="ch"><h3>Upcoming Events</h3></div><div class="cb"><div class="tl" id="lp-calendar"></div></div></div>
    </div>
  </div>
</div>

<!-- PAGE: REPORTS -->
<div class="pg" id="pg-reports">
  <div class="sec-hdr"><h2>LP Report Builder</h2><p>Compose, edit and preview quarterly investor letters â€” all sections editable, auto-populated from live data</p></div>
  <div class="grid g32">
    <div>
      <div class="card"><div class="ch"><h3>Configuration</h3><span class="t t-bl">Q1 2025</span></div><div class="cb" id="report-config"></div></div>
      <div class="card" style="margin-top:14px"><div class="ch"><h3>Live Preview</h3><span class="t t-gr">Updates as you type</span></div><div class="cb"><div class="rp-preview" id="report-preview" style="max-height:520px;overflow-y:auto"></div></div></div>
    </div>
    <div class="card"><div class="ch"><h3>Report Sections</h3><span class="t t-dim">10 sections Â· toggle on/off Â· edit inline</span></div><div class="cb" id="report-sections" style="max-height:720px;overflow-y:auto"></div></div>
  </div>
</div>

<!-- PAGE: BULLHUB INTELLIGENCE -->
<div class="pg" id="pg-bullhub">
  <div class="sec-hdr"><h2>Bullhub Intelligence <span style="font-size:13px;font-family:'JetBrains Mono',monospace;color:var(--orange);margin-left:10px">â—ˆ PROPRIETARY</span></h2><p>Proprietary Research & Sector Deep-Dives â€” the firm's information edge</p></div>
  <div class="stabs" id="bh-tabs">
    <div class="stab on" onclick="bhst(0)">Intelligence Hub</div>
    <div class="stab" onclick="bhst(1)">Public Comps</div>
    <div class="stab" onclick="bhst(2)">M&amp;A Transactions</div>
    <div class="stab" onclick="bhst(3)">Sector Themes</div>
    <div class="stab" onclick="bhst(4)">Macro Indicators</div>
    <div class="stab" onclick="bhst(5)">Competitive Maps</div>
  </div>
  <div class="spane on" id="bhs0">
  <div class="grid g2">

    <!-- Card 1: Sector Sentiment Heatmap -->
    <div class="card">
      <div class="ch"><h3>Sector Sentiment Heatmap</h3><span class="t t-or">Live Analyst View</span></div>
      <div class="cb" id="bh-heatmap"></div>
    </div>

    <!-- Card 2: Live Deal Flow Tracker -->
    <div class="card">
      <div class="ch"><h3>Live Deal Flow Tracker</h3><span class="t t-gr">Active Pipeline</span></div>
      <div class="cb-0" id="bh-dealflow"></div>
    </div>

  </div>

  <div class="grid g2" style="margin-top:14px">

    <!-- Card 3: Internal Research Alpha -->
    <div class="card">
      <div class="ch"><h3>Internal Research Alpha</h3><span class="t t-bl">Flash Reports</span></div>
      <div class="cb" id="bh-research" style="max-height:480px;overflow-y:auto"></div>
    </div>

    <!-- Card 4: Portfolio Synergies -->
    <div class="card">
      <div class="ch"><h3>Portfolio Synergies</h3><span class="t t-pu">Cross-Portfolio Value</span></div>
      <div class="cb" id="bh-synergies"></div>
    </div>

  </div>
  </div>
  <div class="spane" id="bhs1">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>EV/Revenue vs Growth â€” Public Software Comps</h3></div><div class="cb"><div class="cw cw300"><canvas id="ch-re-comps"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Valuation Benchmarks</h3></div><div class="cb-0">
        <table class="tbl"><thead><tr><th>Company</th><th class="num">EV/Rev</th><th class="num">Gr%</th><th class="num">Rule40</th><th class="num">NTM EV/Rev</th><th>Portfolio Relevance</th></tr></thead>
        <tbody>
          <tr><td>Datadog</td><td class="num">18.2Ã—</td><td class="num">26%</td><td class="num">52</td><td class="num">15.8Ã—</td><td><span class="t t-or">Matillion target</span></td></tr>
          <tr><td>MongoDB</td><td class="num">14.5Ã—</td><td class="num">22%</td><td class="num">38</td><td class="num">12.1Ã—</td><td><span class="t t-bl">Sanity comp</span></td></tr>
          <tr><td>Cloudflare</td><td class="num">21.3Ã—</td><td class="num">30%</td><td class="num">35</td><td class="num">17.5Ã—</td><td>â€”</td></tr>
          <tr><td>HubSpot</td><td class="num">12.8Ã—</td><td class="num">20%</td><td class="num">42</td><td class="num">10.9Ã—</td><td><span class="t t-bl">Multiverse comp</span></td></tr>
          <tr><td>Elastic</td><td class="num">8.2Ã—</td><td class="num">18%</td><td class="num">30</td><td class="num">7.1Ã—</td><td><span class="t t-bl">Quantexa comp</span></td></tr>
          <tr><td>GitLab</td><td class="num">10.5Ã—</td><td class="num">28%</td><td class="num">25</td><td class="num">8.8Ã—</td><td>â€”</td></tr>
          <tr><td>IonQ</td><td class="num">38.0Ã—</td><td class="num">118%</td><td class="num">N/A</td><td class="num">22.0Ã—</td><td><span class="t t-pu">Q-CTRL comp</span></td></tr>
          <tr><td>Rigetti</td><td class="num">28.0Ã—</td><td class="num">95%</td><td class="num">N/A</td><td class="num">18.0Ã—</td><td><span class="t t-pu">Q-CTRL comp</span></td></tr>
        </tbody></table>
      </div></div>
    </div>
  </div>
  <div class="spane" id="bhs2">
    <div class="card"><div class="ch"><h3>Recent M&amp;A Transactions â€” Relevant Sectors</h3></div><div class="cb-0">
      <table class="tbl"><thead><tr><th>Target</th><th>Acquirer</th><th>Date</th><th class="num">Size</th><th class="num">ARR</th><th class="num">EV/ARR</th><th>Sector</th><th>Relevance</th></tr></thead>
      <tbody>
        <tr><td>Clari</td><td>Permira (PE)</td><td>Q1 2025</td><td class="num">$1.65B</td><td class="num">$110M</td><td class="num">15.0Ã—</td><td><span class="sc c-sw">Revenue Ops</span></td><td><span class="t t-bl">Multiverse comp</span></td></tr>
        <tr><td>Monte Carlo</td><td>Snowflake</td><td>Q4 2024</td><td class="num">$200M</td><td class="num">$22M</td><td class="num">9.1Ã—</td><td><span class="sc c-sw">Data Quality</span></td><td><span class="t t-bl">Matillion comp</span></td></tr>
        <tr><td>Feedzai</td><td>Reverence Capital</td><td>Q4 2024</td><td class="num">$520M</td><td class="num">$48M</td><td class="num">10.8Ã—</td><td><span class="sc c-fi">FinTech AI</span></td><td><span class="t t-or">Quantexa comp</span></td></tr>
        <tr><td>Checkr</td><td>Strategic Review</td><td>Q3 2024</td><td class="num">$750M</td><td class="num">$125M</td><td class="num">6.0Ã—</td><td><span class="sc c-sw">HR Tech</span></td><td><span class="t t-bl">Market signal</span></td></tr>
        <tr><td>BitGo</td><td>Robinhood</td><td>Q1 2025</td><td class="num">$182M</td><td class="num">$95M</td><td class="num">1.9Ã—</td><td><span class="sc c-fi">Crypto Custody</span></td><td><span class="t t-re">Ledger (bear)</span></td></tr>
        <tr><td>SentinelOne</td><td>In-play</td><td>Ongoing</td><td class="num">$2.4B</td><td class="num">$220M</td><td class="num">10.9Ã—</td><td><span class="sc c-ai">AI Security</span></td><td><span class="t t-or">d-Matrix ref</span></td></tr>
      </tbody></table>
    </div></div>
    <div class="grid g2" style="margin-top:14px">
      <div class="card"><div class="ch"><h3>M&amp;A EV/ARR by Sector 2023â€“2025</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-ma-mult"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>Strategic vs Financial Buyer Premium</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-ma-prem"></canvas></div></div></div>
    </div>
  </div>
  <div class="spane" id="bhs3">
    <div class="grid g3">
      <div class="card"><div class="ch"><h3>AI & Infrastructure</h3><span class="t t-or">HOT</span></div><div class="cb">
        <p style="font-size:11px;color:var(--text-mid);line-height:1.6;margin-bottom:10px">Enterprise AI inference spend +40% YoY. Moats shifting to proprietary data, not model weights. d-Matrix positioned at chip level â€” hard to replicate defensibility. Q-CTRL's quantum advantage window: 2025â€“2030 before broader commoditization. TAM: $180B by 2028.</p>
        <div class="pill-row"><span class="pill">d-Matrix</span><span class="pill">Q-CTRL</span></div>
      </div></div>
      <div class="card"><div class="ch"><h3>Vertical SaaS</h3><span class="t t-gr">GROWING</span></div><div class="cb">
        <p style="font-size:11px;color:var(--text-mid);line-height:1.6;margin-bottom:10px">Multiple compression from 2021 peaks (15â€“25Ã—) to current (8â€“12Ã—). NRR >120% in category leaders. IPO window opening for $50M+ ARR. Matillion (enterprise data) and Booksy (SMB marketplace) on divergent paths. TAM: $650B by 2026.</p>
        <div class="pill-row"><span class="pill">Matillion</span><span class="pill">Booksy</span><span class="pill">Sanity</span><span class="pill">Multiverse</span></div>
      </div></div>
      <div class="card"><div class="ch"><h3>FinTech & Digital Assets</h3><span class="t t-bl">EVOLVING</span></div><div class="cb">
        <p style="font-size:11px;color:var(--text-mid);line-height:1.6;margin-bottom:10px">EU MiCA regulation creating regulated winners in crypto custody â€” Ledger's institutional B2B pivot the key unlock. Embedded finance TAM expanding. Wayflyer unit economics proven through 2022â€“2023 downturn. TAM: $310B by 2027.</p>
        <div class="pill-row"><span class="pill">Ledger</span><span class="pill">Wayflyer</span></div>
      </div></div>
    </div>
  </div>
  <div class="spane" id="bhs4">
    <div class="kpi-row">
      <div class="kpi"><div class="kpi-label">Fed Funds Rate</div><div class="kpi-val">5.25%</div><div class="kpi-sub neu">Cuts expected H2 2025</div></div>
      <div class="kpi"><div class="kpi-label">Global VC Q1</div><div class="kpi-val">$58B</div><div class="kpi-sub up">â†‘ 22% QoQ</div></div>
      <div class="kpi"><div class="kpi-label">IPO Window</div><div class="kpi-val">Opening</div><div class="kpi-sub up">S&P +18% YTD</div></div>
      <div class="kpi"><div class="kpi-label">USD/GBP</div><div class="kpi-val">1.27</div><div class="kpi-sub dn">â†“ 2.1% YTD</div></div>
    </div>
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Rates vs SaaS Valuation Multiples</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-macro-rates"></canvas></div></div></div>
      <div class="card"><div class="ch"><h3>VC Funding Recovery</h3></div><div class="cb"><div class="cw cw260"><canvas id="ch-macro-vc"></canvas></div></div></div>
    </div>
  </div>
  <div class="spane" id="bhs5">
    <div class="grid g2">
      <div class="card"><div class="ch"><h3>Quantum Computing â€” Q-CTRL Competitive Map</h3></div><div class="cb" id="comp-qctrl"></div></div>
      <div class="card"><div class="ch"><h3>AI Inference â€” d-Matrix Competitive Map</h3></div><div class="cb" id="comp-dmatrix"></div></div>
    </div>
    <div class="grid g2" style="margin-top:14px">
      <div class="card"><div class="ch"><h3>Data Integration â€” Matillion Landscape</h3></div><div class="cb" id="comp-matillion"></div></div>
      <div class="card"><div class="ch"><h3>Digital Asset Custody â€” Ledger Landscape</h3></div><div class="cb" id="comp-ledger"></div></div>
    </div>
  </div>
</div>


<!-- PAGE: SECURITY & TRUST -->
<div class="pg" id="pg-security">
  <div class="sec-hdr"><h2>Institutional Security & Data Privacy</h2><p>Architecture designed for GP Bullhound's fiduciary standards</p></div>

  <div class="kpi-row a2">
    <div class="kpi"><div class="kpi-label">Architecture</div><div class="kpi-val" style="font-size:22px">Local-First</div><div class="kpi-sub up">Zero external transmission</div></div>
    <div class="kpi"><div class="kpi-label">Encryption</div><div class="kpi-val" style="font-size:22px">AES-256</div><div class="kpi-sub up">Client-side at rest</div></div>
    <div class="kpi"><div class="kpi-label">Data Residency</div><div class="kpi-val" style="font-size:22px">On-Prem</div><div class="kpi-sub neu">Stays within firm perimeter</div></div>
    <div class="kpi"><div class="kpi-label">SOC2 Status</div><div class="kpi-val" style="font-size:22px">Ready</div><div class="kpi-sub up">Controls mapped</div></div>
    <div class="kpi"><div class="kpi-label">GDPR</div><div class="kpi-val" style="font-size:22px">Art. 25</div><div class="kpi-sub up">Privacy by Design</div></div>
    <div class="kpi"><div class="kpi-label">AIFMD</div><div class="kpi-val" style="font-size:22px">Annex IV</div><div class="kpi-sub neu">Reporting aligned</div></div>
  </div>

  <div class="grid g2" style="margin-top:16px">

    <!-- Card 1: Data Sovereignty -->
    <div class="card">
      <div class="ch"><h3>Data Sovereignty â€” Local-First Architecture</h3><span class="t t-gr">ACTIVE</span></div>
      <div class="cb">
        <div style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-mid);line-height:1.8;margin-bottom:16px">
          All proprietary portfolio data â€” IRR calculations, NAV models, cash-flow projections, LP commitment schedules, and scenario simulations â€” are processed entirely client-side within the browser. No data is transmitted to any external server. No API calls to third-party analytics services. No telemetry. No cookies beyond a local theme preference.
        </div>
        <div style="display:flex;flex-direction:column;gap:10px">
          <div style="background:var(--green-dim);border:1px solid var(--green)33;border-left:3px solid var(--green);border-radius:6px;padding:12px 14px;display:flex;align-items:center;gap:12px">
            <div style="width:32px;height:32px;border-radius:50%;background:var(--green)18;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0">ðŸ”’</div>
            <div>
              <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--text)">Zero Server Storage</div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid);margin-top:3px">The entire dashboard runs as a single HTML file. No backend server, no database, no cloud storage. Portfolio data never crosses the network boundary. From a GDPR Article 25 perspective, the most effective protection is never transmitting personal data in the first place.</div>
            </div>
          </div>
          <div style="background:var(--blue-dim);border:1px solid var(--blue)33;border-left:3px solid var(--blue);border-radius:6px;padding:12px 14px;display:flex;align-items:center;gap:12px">
            <div style="width:32px;height:32px;border-radius:50%;background:var(--blue)18;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0">ðŸ”</div>
            <div>
              <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--text)">Client-Side Encryption (AES-256)</div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid);margin-top:3px">All locally persisted data (saved scenarios, slider states, notes) is encrypted using AES-256 before writing to browser storage. Encryption keys are derived per-session. Even if the device is compromised, stored data is cryptographically protected.</div>
            </div>
          </div>
          <div style="background:var(--purple-dim);border:1px solid var(--purple)33;border-left:3px solid var(--purple);border-radius:6px;padding:12px 14px;display:flex;align-items:center;gap:12px">
            <div style="width:32px;height:32px;border-radius:50%;background:var(--purple)18;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0">ðŸ›¡</div>
            <div>
              <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--text)">SOC2 Readiness</div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid);margin-top:3px">Architecture controls are mapped to SOC2 Type II trust service criteria (Security, Availability, Confidentiality). Access logging, session management, and role-based controls are designed for institutional audit requirements. Ready for external certification upon production deployment.</div>
            </div>
          </div>
        </div>
        <div style="margin-top:16px;background:var(--s2);border:1px solid var(--border);border-radius:6px;padding:12px 14px">
          <div style="font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:var(--text);margin-bottom:8px">Regulatory Alignment</div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px">
            <div style="text-align:center;padding:8px;background:var(--bg);border-radius:5px;border:1px solid var(--border)">
              <div style="font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:700;color:var(--green)">GDPR</div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-dim);margin-top:2px">Art. 5, 25, 17</div>
            </div>
            <div style="text-align:center;padding:8px;background:var(--bg);border-radius:5px;border:1px solid var(--border)">
              <div style="font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:700;color:var(--blue)">AIFMD</div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-dim);margin-top:2px">Annex IV ready</div>
            </div>
            <div style="text-align:center;padding:8px;background:var(--bg);border-radius:5px;border:1px solid var(--border)">
              <div style="font-family:'JetBrains Mono',monospace;font-size:14px;font-weight:700;color:var(--orange)">FCA</div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-dim);margin-top:2px">COBS 4 / SYSC 9</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Card 2: Audit Trail -->
    <div class="card">
      <div class="ch"><h3>The Audit Trail â€” Compliance Logging</h3><span class="t t-bl">MONITORING</span></div>
      <div class="cb">
        <div style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-mid);line-height:1.8;margin-bottom:16px">
          Every valuation adjustment, scenario shock, slider manipulation, and page access is logged with full attribution â€” user identity, timestamp, action type, and before/after values. Under IPEV guidelines and FCA rules, fund valuations must follow a documented, auditable process. This system provides that audit trail automatically.
        </div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:6px;overflow:hidden">
          <div style="padding:8px 12px;background:var(--s3);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
            <span style="font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;color:var(--text)">AUDIT LOG â€” Valuation Adjustments</span>
            <span style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--green)">â— Recording</span>
          </div>
          <div id="audit-log-display" style="padding:6px 12px;font-family:'JetBrains Mono',monospace;font-size:10px;line-height:2;max-height:320px;overflow-y:auto">
          </div>
        </div>
        <div style="margin-top:16px;display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div style="background:var(--s2);border:1px solid var(--border);border-radius:6px;padding:12px">
            <div style="font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;color:var(--text);margin-bottom:6px">Information Barriers</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-mid);line-height:1.7">
              Role-based access control ensures Pipeline and Exit Strategy pages (containing MNPI) are restricted to wall-crossed deal team members. LP data visible only to authorised IR and fund controller roles.
            </div>
          </div>
          <div style="background:var(--s2);border:1px solid var(--border);border-radius:6px;padding:12px">
            <div style="font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;color:var(--text);margin-bottom:6px">Valuation Governance</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-mid);line-height:1.7">
              Quarter-end lock function freezes valuation assumptions, preventing post-period manipulation. Scenario exploration clearly separated from official NAV marks. IPEV-compliant audit trail for examinations.
            </div>
          </div>
        </div>
        <div style="margin-top:16px;background:var(--s2);border:1px solid var(--border);border-radius:6px;padding:12px">
          <div style="font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:var(--text);margin-bottom:8px">Data Classification Scheme</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <span style="font-family:'JetBrains Mono',monospace;font-size:10px;padding:4px 10px;border-radius:10px;background:var(--green)18;color:var(--green);border:1px solid var(--green)33">PUBLIC â€” Market Research</span>
            <span style="font-family:'JetBrains Mono',monospace;font-size:10px;padding:4px 10px;border-radius:10px;background:var(--blue)18;color:var(--blue);border:1px solid var(--blue)33">INTERNAL â€” Pulse, Fund Perf</span>
            <span style="font-family:'JetBrains Mono',monospace;font-size:10px;padding:4px 10px;border-radius:10px;background:var(--orange)18;color:var(--orange);border:1px solid var(--orange)33">CONFIDENTIAL â€” Portfolio, Pipeline</span>
            <span style="font-family:'JetBrains Mono',monospace;font-size:10px;padding:4px 10px;border-radius:10px;background:var(--red)18;color:var(--red);border:1px solid var(--red)33">STRICTLY CONFIDENTIAL â€” LP, Exits, DCF, VaR</span>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Card 3: Production Security Roadmap -->
  <div class="card" style="margin-top:14px">
    <div class="ch"><h3>Production Security Roadmap</h3><span class="t t-pu">PLANNED</span></div>
    <div class="cb-0">
      <table class="tbl">
        <thead><tr><th>Control</th><th>Description</th><th>Standard</th><th class="num">Status</th></tr></thead>
        <tbody>
          <tr><td class="name-cell">SSO / SAML Integration</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid)">Azure AD / Okta identity provider with MFA</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim)">SOC2 CC6.1</td><td class="num"><span class="t t-bl">Planned</span></td></tr>
          <tr><td class="name-cell">Role-Based Access (RBAC)</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid)">Partner / Principal / Associate / IR / Compliance / LP Portal roles</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim)">FCA SYSC 9</td><td class="num"><span class="t t-bl">Planned</span></td></tr>
          <tr><td class="name-cell">Immutable Audit Log</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid)">Append-only log of all page views, valuations, exports</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim)">SOC2 CC7.2</td><td class="num"><span class="t t-gr">Active</span></td></tr>
          <tr><td class="name-cell">Session Timeout (15min)</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid)">Auto-logout after inactivity, re-auth for MNPI pages</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim)">SOC2 CC6.2</td><td class="num"><span class="t t-bl">Planned</span></td></tr>
          <tr><td class="name-cell">Watermarked Exports</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid)">All PDF/Excel exports stamped with user, time, classification</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim)">FCA COBS 4</td><td class="num"><span class="t t-bl">Planned</span></td></tr>
          <tr><td class="name-cell">DLP Integration</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid)">Data Loss Prevention for bulk extraction safeguards</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim)">SOC2 CC6.7</td><td class="num"><span class="t t-or">Design</span></td></tr>
          <tr><td class="name-cell">Penetration Testing</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid)">OWASP Top 10 assessment, XSS hardening for dynamic rendering</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim)">SOC2 CC7.1</td><td class="num"><span class="t t-or">Design</span></td></tr>
          <tr><td class="name-cell">Insider Trading Controls</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-mid)">Access logs linked to restricted list; personal trading compliance</td><td style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim)">MAR / SEC</td><td class="num"><span class="t t-bl">Planned</span></td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- PAGE: TOOLS -->
<div class="pg" id="pg-tools">
  <div class="sec-hdr"><h2>Quantitative Tools</h2><p>Monte Carlo simulation, DCF valuation engine, Value-at-Risk & tail risk analytics</p></div>
  <div class="stabs" id="tools-tabs">
    <div class="stab on" onclick="tst(0)">Monte Carlo</div>
    <div class="stab" onclick="tst(1)">DCF Engine</div>
    <div class="stab" onclick="tst(2)">VaR &amp; Tail Risk</div>
  </div>
  <div class="spane on" id="ts0">
    <div class="grid g32">
    <!-- Controls -->
    <div>
      <div class="card">
        <div class="ch"><h3>Simulation Parameters</h3><span class="t t-or" id="mc-status">Ready</span></div>
        <div class="cb">
          <div class="ctrl-section">Simulation Settings</div>
          <div class="ctrl-row">
            <span class="ctrl-label">Number of paths</span>
            <input type="range" id="mc-paths" min="100" max="10000" step="100" value="2000" oninput="mcUpdateLabel('mc-paths','mc-paths-v',v=>v.toLocaleString())">
            <span class="ctrl-val" id="mc-paths-v">2,000</span>
          </div>
          <div class="ctrl-row">
            <span class="ctrl-label">Time horizon (years)</span>
            <input type="range" id="mc-horizon" min="1" max="8" step="1" value="4" oninput="mcUpdateLabel('mc-horizon','mc-horizon-v',v=>v+'yr')">
            <span class="ctrl-val" id="mc-horizon-v">4yr</span>
          </div>
          <div class="ctrl-row">
            <span class="ctrl-label">Time steps / year</span>
            <input type="range" id="mc-steps" min="4" max="52" step="4" value="12" class="blue-range" oninput="mcUpdateLabel('mc-steps','mc-steps-v',v=>v)">
            <span class="ctrl-val" id="mc-steps-v">12</span>
          </div>

          <div class="ctrl-section" style="margin-top:12px">Return Assumptions</div>
          <div class="ctrl-row">
            <span class="ctrl-label">Expected annual return</span>
            <input type="range" id="mc-mu" min="0" max="40" step="0.5" value="18" class="green-range" oninput="mcUpdateLabel('mc-mu','mc-mu-v',v=>v+'%')">
            <span class="ctrl-val" id="mc-mu-v">18%</span>
          </div>
          <div class="ctrl-row">
            <span class="ctrl-label">Annual volatility (Ïƒ)</span>
            <input type="range" id="mc-sigma" min="5" max="60" step="1" value="28" oninput="mcUpdateLabel('mc-sigma','mc-sigma-v',v=>v+'%')">
            <span class="ctrl-val" id="mc-sigma-v">28%</span>
          </div>
          <div class="ctrl-row">
            <span class="ctrl-label">Correlation to public mkt</span>
            <input type="range" id="mc-corr" min="-20" max="80" step="5" value="35" class="blue-range" oninput="mcUpdateLabel('mc-corr','mc-corr-v',v=>v+'%')">
            <span class="ctrl-val" id="mc-corr-v">35%</span>
          </div>

          <div class="ctrl-section" style="margin-top:12px">Jump / Fat-tail Events</div>
          <div class="ctrl-row">
            <span class="ctrl-label">Crash probability / yr</span>
            <input type="range" id="mc-jump-p" min="0" max="20" step="1" value="5" class="red-range" oninput="mcUpdateLabel('mc-jump-p','mc-jump-p-v',v=>v+'%')">
            <span class="ctrl-val" id="mc-jump-p-v">5%</span>
          </div>
          <div class="ctrl-row">
            <span class="ctrl-label">Crash severity (NAV drop)</span>
            <input type="range" id="mc-jump-sz" min="10" max="60" step="5" value="30" class="red-range" oninput="mcUpdateLabel('mc-jump-sz','mc-jump-sz-v',v=>'-'+v+'%')">
            <span class="ctrl-val" id="mc-jump-sz-v">-30%</span>
          </div>

          <div class="ctrl-section" style="margin-top:12px">Correlated Crash Shocks</div>
          <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);padding:4px 0 8px;line-height:1.5">In a crash, high-beta companies fall harder. Correlation jumps to 1.0 for the systematic shock component.</div>
          <div class="ctrl-row">
            <span class="ctrl-label">Market beta (portfolio avg)</span>
            <input type="range" id="mc-beta" min="0.3" max="2.5" step="0.1" value="1.2" oninput="mcUpdateLabel('mc-beta','mc-beta-v',v=>v+'Ã—')">
            <span class="ctrl-val" id="mc-beta-v">1.2Ã—</span>
          </div>
          <div class="ctrl-row">
            <span class="ctrl-label">Idiosyncratic vol (Î±)</span>
            <input type="range" id="mc-idio" min="0" max="40" step="2" value="15" class="purple-range" oninput="mcUpdateLabel('mc-idio','mc-idio-v',v=>v+'%')">
            <span class="ctrl-val" id="mc-idio-v">15%</span>
          </div>
          <div class="ctrl-row">
            <span class="ctrl-label">Crash beta multiplier</span>
            <input type="range" id="mc-crash-beta" min="1.0" max="3.0" step="0.1" value="1.8" class="red-range" oninput="mcUpdateLabel('mc-crash-beta','mc-crash-beta-v',v=>v+'Ã—')">
            <span class="ctrl-val" id="mc-crash-beta-v">1.8Ã—</span>
          </div>

          <div class="ctrl-section" style="margin-top:12px">Distribution Assumptions</div>
          <div class="ctrl-row">
            <span class="ctrl-label">Return distribution</span>
            <div class="chip-row" style="flex:1" id="mc-dist-chips">
              <div class="chip on" onclick="setMCDist('lognormal',this)">Log-Normal</div>
              <div class="chip" onclick="setMCDist('tstudent',this)">t-Student</div>
              <div class="chip" onclick="setMCDist('jumpdiff',this)">Jump-Diffusion</div>
            </div>
          </div>

          <button onclick="runMonteCarlo()" style="width:100%;margin-top:14px;padding:10px;background:var(--orange);border:none;color:white;font-family:var(--font-mono);font-size:11px;font-weight:700;border-radius:6px;cursor:pointer;letter-spacing:1px">â–¶ RUN SIMULATION</button>
          <button onclick="runInverseStressTest()" style="width:100%;margin-top:8px;padding:9px;background:var(--s3);border:1px solid var(--red);color:var(--red);font-family:var(--font-mono);font-size:11px;font-weight:700;border-radius:6px;cursor:pointer;letter-spacing:1px">âš  INVERSE STRESS TEST â€” 1.0Ã— FLOOR</button>
          <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);text-align:center;margin-top:6px" id="mc-runtime">â€”</div>
          <div class="live-card" style="margin-top:10px;display:none" id="mc-inverse-result">
            <div class="live-kpi"><span class="live-kpi-lbl">Max Survivable Drawdown</span></div>
            <div class="live-kpi-val dn" id="mc-inverse-pct">â€”</div>
            <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-top:4px" id="mc-inverse-detail">â€”</div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <div class="ch"><h3>Output Statistics</h3></div>
        <div class="cb" id="mc-stats">
          <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);text-align:center;padding:20px">Run simulation to see results</div>
        </div>
      </div>
    </div>

    <!-- Results -->
    <div>
      <div class="card">
        <div class="ch"><h3>NAV Distribution â€” Final Period</h3><span class="t t-dim" id="mc-path-count">0 paths</span></div>
        <div class="cb"><div class="cw" style="height:240px"><canvas id="ch-mc-hist"></canvas></div></div>
      </div>
      <div class="card" style="margin-top:14px">
        <div class="ch"><h3>Percentile Paths Over Time</h3><span class="t t-dim">P5 Â· P25 Â· P50 Â· P75 Â· P95</span></div>
        <div class="cb"><div class="cw" style="height:220px"><canvas id="ch-mc-paths"></canvas></div></div>
      </div>
      <div class="grid g2" style="margin-top:14px">
        <div class="card">
          <div class="ch"><h3>MOIC Distribution</h3></div>
          <div class="cb"><div class="cw cw220"><canvas id="ch-mc-moic"></canvas></div></div>
        </div>
        <div class="card">
          <div class="ch"><h3>Probability of Target MOIC</h3></div>
          <div class="cb" id="mc-prob-targets">
            <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);padding:20px;text-align:center">Run simulation first</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  </div>
  <div class="spane" id="ts1">
  
  <div class="stabs" id="dcf-tabs">
    <div class="stab on" onclick="dcfTab(0)">Company DCF</div>
    <div class="stab" onclick="dcfTab(1)">Sensitivity Analysis</div>
    <div class="stab" onclick="dcfTab(2)">Sum of Parts</div>
  </div>

  <div class="spane on" id="dcf0">
    <div class="grid g32">
      <!-- Left: inputs -->
      <div>
        <div class="card">
          <div class="ch"><h3>Company Selection</h3></div>
          <div class="cb">
            <div class="chip-row" id="dcf-co-chips">
              <div class="chip on" onclick="selectDCFCo('Q-CTRL',this)">Q-CTRL</div>
              <div class="chip" onclick="selectDCFCo('Matillion',this)">Matillion</div>
              <div class="chip" onclick="selectDCFCo('Ledger',this)">Ledger</div>
              <div class="chip" onclick="selectDCFCo('d-Matrix',this)">d-Matrix</div>
              <div class="chip" onclick="selectDCFCo('Quantexa',this)">Quantexa</div>
              <div class="chip" onclick="selectDCFCo('Multiverse',this)">Multiverse</div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Revenue Model</h3></div>
          <div class="cb">
            <div class="ctrl-section">Base Year (Current)</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Current ARR ($M)</span>
              <input type="number" id="dcf-arr" value="18" min="1" max="500" oninput="dcfUpdate()">
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Gross Margin %</span>
              <input type="range" id="dcf-gm" min="20" max="95" value="75" class="green-range" oninput="dcfUpdateSlider('dcf-gm','dcf-gm-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-gm-v">75%</span>
            </div>

            <div class="ctrl-section" style="margin-top:12px">Growth Projection (Yr 1â€“5)</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Year 1 growth</span>
              <input type="range" id="dcf-g1" min="0" max="200" value="100" class="green-range" oninput="dcfUpdateSlider('dcf-g1','dcf-g1-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-g1-v">100%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Year 2 growth</span>
              <input type="range" id="dcf-g2" min="0" max="150" value="80" class="green-range" oninput="dcfUpdateSlider('dcf-g2','dcf-g2-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-g2-v">80%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Year 3 growth</span>
              <input type="range" id="dcf-g3" min="0" max="100" value="60" oninput="dcfUpdateSlider('dcf-g3','dcf-g3-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-g3-v">60%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Year 4 growth</span>
              <input type="range" id="dcf-g4" min="0" max="80" value="40" oninput="dcfUpdateSlider('dcf-g4','dcf-g4-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-g4-v">40%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Year 5 growth</span>
              <input type="range" id="dcf-g5" min="0" max="60" value="25" oninput="dcfUpdateSlider('dcf-g5','dcf-g5-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-g5-v">25%</span>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Cost & Terminal Value</h3></div>
          <div class="cb">
            <div class="ctrl-section">OpEx & FCF Bridge</div>
            <div class="ctrl-row">
              <span class="ctrl-label">S&M % of ARR</span>
              <input type="range" id="dcf-sm" min="10" max="80" value="40" class="red-range" oninput="dcfUpdateSlider('dcf-sm','dcf-sm-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-sm-v">40%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">R&D % of ARR</span>
              <input type="range" id="dcf-rd" min="5" max="50" value="25" class="red-range" oninput="dcfUpdateSlider('dcf-rd','dcf-rd-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-rd-v">25%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">G&A % of ARR</span>
              <input type="range" id="dcf-ga" min="3" max="25" value="12" oninput="dcfUpdateSlider('dcf-ga','dcf-ga-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-ga-v">12%</span>
            </div>

            <div class="ctrl-section" style="margin-top:12px">Terminal Value</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Terminal growth rate</span>
              <input type="range" id="dcf-tg" min="1" max="8" step="0.5" value="3" class="green-range" oninput="dcfUpdateSlider('dcf-tg','dcf-tg-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-tg-v">3%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Discount rate (WACC)</span>
              <input type="range" id="dcf-wacc" min="8" max="35" step="0.5" value="18" class="blue-range" oninput="dcfUpdateSlider('dcf-wacc','dcf-wacc-v',v=>v+'%');dcfUpdate()">
              <span class="ctrl-val" id="dcf-wacc-v">18%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">TV exit multiple (EV/FCF)</span>
              <input type="range" id="dcf-tv-mult" min="10" max="60" value="25" oninput="dcfUpdateSlider('dcf-tv-mult','dcf-tv-mult-v',v=>v+'Ã—');dcfUpdate()">
              <span class="ctrl-val" id="dcf-tv-mult-v">25Ã—</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">TV method</span>
              <div class="chip-row" style="flex:1" id="dcf-tv-chips">
                <div class="chip on" onclick="setDCFTV('gordon',this)">Gordon Growth</div>
                <div class="chip" onclick="setDCFTV('multiple',this)">Exit Multiple</div>
                <div class="chip" onclick="setDCFTV('avg',this)">Average</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: results -->
      <div>
        <div class="grid g2" style="margin-bottom:14px">
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Intrinsic Value</span></div><div class="live-kpi-val up" id="dcf-iv">$0M</div><div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-top:4px" id="dcf-iv-sub">â€”</div></div>
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">vs Current Mark</span></div><div class="live-kpi-val" id="dcf-vs-mark">â€”</div><div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-top:4px" id="dcf-updown">â€”</div></div>
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">PV of FCFs</span></div><div class="live-kpi-val" id="dcf-pv-fcf">$0M</div></div>
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Terminal Value (PV)</span></div><div class="live-kpi-val" id="dcf-tv-pv">$0M</div><div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-top:4px" id="dcf-tv-pct">â€”% of total</div></div>
        </div>

        <div class="card">
          <div class="ch"><h3>5-Year P&L Projection</h3><span class="t t-dim" id="dcf-burn-badge">Burn â€” linked to growth</span></div>
          <div class="cb-0" id="dcf-table"></div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Revenue & FCF Trajectory</h3></div>
          <div class="cb"><div class="cw" style="height:200px"><canvas id="ch-dcf-proj"></canvas></div></div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Valuation Bridge</h3></div>
          <div class="cb"><div class="cw" style="height:180px"><canvas id="ch-dcf-bridge"></canvas></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="spane" id="dcf1">
    <div class="grid g32">
      <div class="card">
        <div class="ch"><h3>WACC vs Terminal Growth â€” Valuation Grid</h3><span class="t t-dim" id="dcf-sens-co">Q-CTRL</span></div>
        <div class="cb" id="dcf-sens-table-wacc"></div>
      </div>
      <div class="card">
        <div class="ch"><h3>Revenue Growth vs Margin â€” Valuation Grid</h3></div>
        <div class="cb" id="dcf-sens-table-growth"></div>
      </div>
    </div>
    <div class="card" style="margin-top:14px">
      <div class="ch"><h3>Tornado Chart â€” Key Value Drivers</h3></div>
      <div class="cb"><div class="cw" style="height:260px"><canvas id="ch-dcf-tornado"></canvas></div></div>
    </div>
  </div>

  <div class="spane" id="dcf2">
    <div class="grid g32">
      <div class="card">
        <div class="ch"><h3>Sum-of-Parts â€” Fund VI Portfolio</h3><span class="t t-or" id="sop-total">Total: â€”</span></div>
        <div class="cb-0" id="sop-table"></div>
      </div>
      <div class="card">
        <div class="ch"><h3>Implied Portfolio Value Breakdown</h3></div>
        <div class="cb"><div class="cw" style="height:240px"><canvas id="ch-sop-waterfall"></canvas></div></div>
      </div>
    </div>
    <div class="card" style="margin-top:14px">
      <div class="ch"><h3>Liquidation Preference Waterfall</h3><span class="t t-re">Common vs Preferred Stack â€” GP sees money?</span></div>
      <div class="cb">
        <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-bottom:10px;line-height:1.6">For high-valuation companies, GP common shares may be underwater if exit value is below the preference stack. Modelled with 1Ã— participating preferred, pro-rata after preference return.</div>
        <div class="grid g32">
          <div>
            <div class="ctrl-section">Liquidation Preference Inputs</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Select company</span>
              <div class="chip-row" style="flex:1" id="lp-co-chips">
                <div class="chip on" onclick="selectLPCo('Ledger',this)">Ledger</div>
                <div class="chip" onclick="selectLPCo('Q-CTRL',this)">Q-CTRL</div>
                <div class="chip" onclick="selectLPCo('d-Matrix',this)">d-Matrix</div>
                <div class="chip" onclick="selectLPCo('Matillion',this)">Matillion</div>
              </div>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Total capital raised ($M)</span>
              <input type="range" id="lp-raised" min="10" max="500" value="180" oninput="lpUpdateLabel('lp-raised','lp-raised-v',v=>'$'+v+'M');lpWaterfallUpdate()">
              <span class="ctrl-val" id="lp-raised-v">$180M</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Preference multiple</span>
              <div class="chip-row" style="flex:1" id="lp-pref-chips">
                <div class="chip on" onclick="setLPPref(1,this)">1Ã—</div>
                <div class="chip" onclick="setLPPref(1.5,this)">1.5Ã—</div>
                <div class="chip" onclick="setLPPref(2,this)">2Ã—</div>
              </div>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">GP ownership (common)</span>
              <input type="range" id="lp-gp-own" min="1" max="30" step="0.5" value="8" class="orange-range" oninput="lpUpdateLabel('lp-gp-own','lp-gp-own-v',v=>v+'%');lpWaterfallUpdate()">
              <span class="ctrl-val" id="lp-gp-own-v">8%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Participating preferred?</span>
              <div class="chip-row" style="flex:1" id="lp-part-chips">
                <div class="chip on" onclick="setLPPart(true,this)">Participating</div>
                <div class="chip" onclick="setLPPart(false,this)">Non-participating</div>
              </div>
            </div>
            <div class="ctrl-section" style="margin-top:10px">Exit Scenario</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Exit valuation ($M)</span>
              <input type="range" id="lp-exit" min="50" max="3000" step="25" value="800" class="green-range" oninput="lpUpdateLabel('lp-exit','lp-exit-v',v=>'$'+v+'M');lpWaterfallUpdate()">
              <span class="ctrl-val" id="lp-exit-v">$800M</span>
            </div>
          </div>
          <div>
            <div class="grid g2" style="margin-bottom:12px">
              <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Preference Stack</span></div><div class="live-kpi-val dn" id="lp-pref-stack">â€”</div></div>
              <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">GP Common Proceeds</span></div><div class="live-kpi-val" id="lp-gp-proceeds">â€”</div></div>
              <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">GP MOIC on Exit</span></div><div class="live-kpi-val" id="lp-gp-moic">â€”</div></div>
              <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Breakeven Exit ($M)</span></div><div class="live-kpi-val" id="lp-breakeven">â€”</div></div>
            </div>
            <div class="card" style="background:var(--bg)">
              <div class="ch"><h3>Waterfall Chart</h3></div>
              <div class="cb"><div class="cw" style="height:220px"><canvas id="ch-lp-waterfall"></canvas></div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  </div>
  <div class="spane" id="ts2">
  
  <div class="stabs" id="var-tabs">
    <div class="stab on" onclick="varTab(0)">VaR Analysis</div>
    <div class="stab" onclick="varTab(1)">Drawdown</div>
    <div class="stab" onclick="varTab(2)">Stress Tests</div>
    <div class="stab" onclick="varTab(3)">Correlation</div>
    <div class="stab" onclick="varTab(4)">Marginal VaR</div>
    <div class="stab" onclick="varTab(5)">Historical Backtest</div>
  </div>

  <div class="spane on" id="var0">
    <div class="grid g32">
      <div>
        <div class="card">
          <div class="ch"><h3>VaR Configuration</h3></div>
          <div class="cb">
            <div class="ctrl-section">Method</div>
            <div class="chip-row" id="var-method-chips">
              <div class="chip on" onclick="setVARMethod('parametric',this)">Parametric</div>
              <div class="chip" onclick="setVARMethod('historical',this)">Historical Sim</div>
              <div class="chip" onclick="setVARMethod('montecarlo',this)">Monte Carlo</div>
            </div>

            <div class="ctrl-section" style="margin-top:12px">Parameters</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Confidence level</span>
              <div class="chip-row" style="flex:1" id="var-conf-chips">
                <div class="chip" onclick="setVARConf(90,this)">90%</div>
                <div class="chip on" onclick="setVARConf(95,this)">95%</div>
                <div class="chip" onclick="setVARConf(99,this)">99%</div>
                <div class="chip" onclick="setVARConf(99.9,this)">99.9%</div>
              </div>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Time horizon (days)</span>
              <input type="range" id="var-horizon" min="1" max="252" step="1" value="20" class="blue-range" oninput="varUpdateLabel('var-horizon','var-horizon-v',v=>v+'d');varUpdate()">
              <span class="ctrl-val" id="var-horizon-v">20d</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Lookback window (days)</span>
              <input type="range" id="var-lookback" min="60" max="756" step="21" value="252" oninput="varUpdateLabel('var-lookback','var-lookback-v',v=>v+'d');varUpdate()">
              <span class="ctrl-val" id="var-lookback-v">252d</span>
            </div>

            <div class="ctrl-section" style="margin-top:12px">Portfolio Assumptions</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Daily volatility (Ïƒ)</span>
              <input type="range" id="var-vol" min="0.5" max="5" step="0.1" value="1.8" oninput="varUpdateLabel('var-vol','var-vol-v',v=>v+'%');varUpdate()">
              <span class="ctrl-val" id="var-vol-v">1.8%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Skewness</span>
              <input type="range" id="var-skew" min="-2" max="0" step="0.1" value="-0.5" oninput="varUpdateLabel('var-skew','var-skew-v',v=>v);varUpdate()">
              <span class="ctrl-val" id="var-skew-v">-0.5</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Excess kurtosis</span>
              <input type="range" id="var-kurt" min="0" max="6" step="0.5" value="2" oninput="varUpdateLabel('var-kurt','var-kurt-v',v=>v);varUpdate()">
              <span class="ctrl-val" id="var-kurt-v">2.0</span>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div class="grid g2" style="margin-bottom:14px">
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">VaR (1-day)</span></div><div class="live-kpi-val dn" id="var-1d">â€”</div><div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-top:4px" id="var-1d-usd">â€”</div></div>
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">VaR (horizon)</span></div><div class="live-kpi-val dn" id="var-nd">â€”</div><div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-top:4px" id="var-nd-usd">â€”</div></div>
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Expected Shortfall (CVaR)</span></div><div class="live-kpi-val dn" id="var-es">â€”</div><div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-top:4px" id="var-es-usd">â€”</div></div>
          <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Annualised Volatility</span></div><div class="live-kpi-val" id="var-annvol">â€”</div></div>
        </div>

        <div class="card">
          <div class="ch"><h3>Loss Distribution</h3></div>
          <div class="cb"><div class="cw" style="height:220px"><canvas id="ch-var-dist"></canvas></div></div>
        </div>

        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>VaR by Confidence Level</h3></div>
          <div class="cb"><div class="cw" style="height:180px"><canvas id="ch-var-conf"></canvas></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="spane" id="var1">
    <div class="grid g32">
      <div>
        <div class="card">
          <div class="ch"><h3>Drawdown Controls</h3></div>
          <div class="cb">
            <div class="ctrl-section">Simulation Parameters</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Annual drift (Î¼)</span>
              <input type="range" id="dd-mu" min="-20" max="40" value="12" oninput="varUpdateLabel('dd-mu','dd-mu-v',v=>v+'%');ddUpdate()">
              <span class="ctrl-val" id="dd-mu-v">12%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Annual volatility</span>
              <input type="range" id="dd-sigma" min="10" max="60" value="28" oninput="varUpdateLabel('dd-sigma','dd-sigma-v',v=>v+'%');ddUpdate()">
              <span class="ctrl-val" id="dd-sigma-v">28%</span>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Simulation years</span>
              <input type="range" id="dd-yrs" min="1" max="10" value="5" class="blue-range" oninput="varUpdateLabel('dd-yrs','dd-yrs-v',v=>v+'yr');ddUpdate()">
              <span class="ctrl-val" id="dd-yrs-v">5yr</span>
            </div>
            <button onclick="ddUpdate()" style="width:100%;margin-top:12px;padding:8px;background:var(--blue);border:none;color:white;font-family:var(--font-mono);font-size:11px;border-radius:5px;cursor:pointer">Recalculate Drawdown</button>
          </div>
        </div>
        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Drawdown Statistics</h3></div>
          <div class="cb" id="dd-stats"></div>
        </div>
      </div>
      <div>
        <div class="card">
          <div class="ch"><h3>Underwater Chart â€” Fund VI NAV Path</h3></div>
          <div class="cb"><div class="cw" style="height:220px"><canvas id="ch-dd-underwater"></canvas></div></div>
        </div>
        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Max Drawdown Distribution (10,000 paths)</h3></div>
          <div class="cb"><div class="cw" style="height:200px"><canvas id="ch-dd-dist"></canvas></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="spane" id="var2">
    <div class="grid g32">
      <div class="card">
        <div class="ch"><h3>Historical Stress Scenarios</h3></div>
        <div class="cb-0" id="var-stress-table"></div>
      </div>
      <div>
        <div class="card">
          <div class="ch"><h3>Stress Impact on Portfolio NAV</h3></div>
          <div class="cb"><div class="cw" style="height:260px"><canvas id="ch-var-stress"></canvas></div></div>
        </div>
        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Recovery Time Analysis</h3></div>
          <div class="cb"><div class="cw" style="height:160px"><canvas id="ch-var-recovery"></canvas></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="spane" id="var3">
    <div class="card">
      <div class="ch"><h3>Portfolio Correlation Matrix</h3></div>
      <div class="cb" id="var-corr-matrix"></div>
    </div>
    <div class="grid g2" style="margin-top:14px">
      <div class="card">
        <div class="ch"><h3>Diversification Benefit</h3></div>
        <div class="cb"><div class="cw cw260"><canvas id="ch-var-div"></canvas></div></div>
      </div>
      <div class="card">
        <div class="ch"><h3>Component VaR Contribution</h3></div>
        <div class="cb"><div class="cw cw260"><canvas id="ch-var-comp"></canvas></div></div>
      </div>
    </div>
  <div class="spane" id="var4">
    <div class="grid g32">
      <div>
        <div class="card">
          <div class="ch"><h3>Marginal VaR Controls</h3></div>
          <div class="cb">
            <div class="ctrl-section">Position Adjustment</div>
            <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-bottom:10px;line-height:1.5">Marginal VaR = change in portfolio VaR when you reduce a position by 10%. Shows which position is adding the most risk per dollar of NAV.</div>
            <div class="ctrl-row">
              <span class="ctrl-label">Reduction size</span>
              <div class="chip-row" style="flex:1" id="mvar-size-chips">
                <div class="chip on" onclick="setMVARSize(10,this)">10%</div>
                <div class="chip" onclick="setMVARSize(25,this)">25%</div>
                <div class="chip" onclick="setMVARSize(50,this)">50%</div>
                <div class="chip" onclick="setMVARSize(100,this)">Full Exit</div>
              </div>
            </div>
            <div class="ctrl-row">
              <span class="ctrl-label">Confidence level</span>
              <div class="chip-row" style="flex:1" id="mvar-conf-chips">
                <div class="chip" onclick="setMVARConf(90,this)">90%</div>
                <div class="chip on" onclick="setMVARConf(95,this)">95%</div>
                <div class="chip" onclick="setMVARConf(99,this)">99%</div>
              </div>
            </div>
            <button onclick="calcMarginalVaR()" style="width:100%;margin-top:12px;padding:9px;background:var(--blue);border:none;color:white;font-family:var(--font-mono);font-size:11px;font-weight:700;border-radius:5px;cursor:pointer">RECALCULATE MARGINAL VaR</button>
          </div>
        </div>
        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Portfolio VaR Impact</h3></div>
          <div class="cb" id="mvar-summary">
            <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);text-align:center;padding:20px">Click Recalculate to see results</div>
          </div>
        </div>
      </div>
      <div>
        <div class="card">
          <div class="ch"><h3>Marginal VaR by Position â€” Reduction Impact</h3><span class="t t-dim" id="mvar-reduction-label">10% reduction</span></div>
          <div class="cb"><div class="cw" style="height:260px"><canvas id="ch-mvar-bar"></canvas></div></div>
        </div>
        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Risk per Dollar of NAV</h3><span class="t t-dim">Marginal VaR Ã· Position Size</span></div>
          <div class="cb"><div class="cw" style="height:200px"><canvas id="ch-mvar-density"></canvas></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="spane" id="var5">
    <div class="grid g32">
      <div>
        <div class="card">
          <div class="ch"><h3>Historical Backtest Scenarios</h3></div>
          <div class="cb">
            <div class="ctrl-section">Select Crisis Period</div>
            <div id="backtest-scenario-chips" style="display:flex;flex-direction:column;gap:6px;margin-bottom:14px">
              <div class="chip on" style="text-align:left;padding:8px 12px" onclick="selectBacktest('covid2020',this)">
                <div style="font-weight:700">COVID Crash â€” Feb/Mar 2020</div>
                <div style="font-size:11px;opacity:0.7">33 days, NASDAQ -31%, VIX peak 82</div>
              </div>
              <div class="chip" style="text-align:left;padding:8px 12px" onclick="selectBacktest('techselloff2022',this)">
                <div style="font-weight:700">2022 Tech Selloff â€” Janâ€“Dec 2022</div>
                <div style="font-size:11px;opacity:0.7">Full year, NASDAQ -33%, rates +425bp</div>
              </div>
              <div class="chip" style="text-align:left;padding:8px 12px" onclick="selectBacktest('gfc2008',this)">
                <div style="font-weight:700">GFC â€” Sep 2008â€“Mar 2009</div>
                <div style="font-size:11px;opacity:0.7">6 months, NASDAQ -45%, credit freeze</div>
              </div>
              <div class="chip" style="text-align:left;padding:8px 12px" onclick="selectBacktest('dotcom2000',this)">
                <div style="font-weight:700">Dot-com Bust â€” Mar 2000â€“Oct 2002</div>
                <div style="font-size:11px;opacity:0.7">30 months, NASDAQ -78%, multiples collapsed</div>
              </div>
              <div class="chip" style="text-align:left;padding:8px 12px" onclick="selectBacktest('svb2023',this)">
                <div style="font-weight:700">SVB / Banking Crisis â€” Mar 2023</div>
                <div style="font-size:11px;opacity:0.7">2 weeks, tech VC funding freeze</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <div class="card" id="backtest-result-card">
          <div class="ch"><h3>Backtest Results</h3><span class="t t-re" id="backtest-scenario-label">Select a scenario</span></div>
          <div class="cb">
            <div class="grid g2" style="margin-bottom:12px">
              <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Portfolio Peak Loss</span></div><div class="live-kpi-val dn" id="bt-peak-loss">â€”</div></div>
              <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">NAV at Trough</span></div><div class="live-kpi-val dn" id="bt-trough-nav">â€”</div></div>
              <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Recovery Time</span></div><div class="live-kpi-val" id="bt-recovery">â€”</div></div>
              <div class="live-card"><div class="live-kpi"><span class="live-kpi-lbl">Worst Single Day</span></div><div class="live-kpi-val dn" id="bt-worst-day">â€”</div></div>
            </div>
            <div class="cw" style="height:220px"><canvas id="ch-bt-path"></canvas></div>
          </div>
        </div>
        <div class="card" style="margin-top:14px">
          <div class="ch"><h3>Per-Company Impact During Crisis</h3></div>
          <div class="cb-0" id="bt-company-table"></div>
        </div>
      </div>
    </div>
  </div>

</div>
  </div>
</div>

</div><!-- /main -->

<!-- MODAL -->
<div class="modal-overlay" id="co-modal">
  <div class="modal">
    <div class="modal-hdr"><h3 id="modal-title">Company</h3><button class="modal-close" onclick="closeModal()">âœ•</button></div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<script>
/* â”€â”€ THEME SYSTEM â”€â”€ */
function getTheme(){try{return localStorage.getItem('gpb-theme')||'dark'}catch(e){return'dark'}}
function setTheme(t){
  document.documentElement.classList.toggle('light',t==='light');
  try{localStorage.setItem('gpb-theme',t)}catch(e){}
  var ico=document.getElementById('theme-icon');
  if(ico)ico.textContent=t==='light'?'â˜¾':'â˜€';
  reThemeCharts();
}
function toggleTheme(){setTheme(getTheme()==='dark'?'light':'dark')}
function reThemeCharts(){
  try{if(!CH)return}catch(e){return}
  var s=getComputedStyle(document.documentElement);
  var tick=s.getPropertyValue('--chart-tick').trim();
  var grid=s.getPropertyValue('--chart-grid').trim();
  var bdr=s.getPropertyValue('--chart-border').trim();
  var leg=s.getPropertyValue('--chart-legend').trim();
  var ttBg=s.getPropertyValue('--chart-tooltip-bg').trim();
  var ttBdr=s.getPropertyValue('--chart-tooltip-border').trim();
  var ttTitle=s.getPropertyValue('--chart-tooltip-title').trim();
  var ttBody=s.getPropertyValue('--chart-tooltip-body').trim();
  Object.keys(CH).forEach(function(k){
    var c=CH[k];if(!c||!c.options)return;
    // update scales
    if(c.options.scales){
      ['x','y','r'].forEach(function(ax){
        if(c.options.scales[ax]){
          if(c.options.scales[ax].ticks)c.options.scales[ax].ticks.color=tick;
          if(c.options.scales[ax].grid)c.options.scales[ax].grid.color=grid;
          if(c.options.scales[ax].border)c.options.scales[ax].border.color=bdr;
          if(c.options.scales[ax].pointLabels)c.options.scales[ax].pointLabels.color=leg;
          if(c.options.scales[ax].title&&c.options.scales[ax].title.color)c.options.scales[ax].title.color=leg;
          if(c.options.scales[ax].ticks&&c.options.scales[ax].ticks.backdropColor)c.options.scales[ax].ticks.backdropColor='transparent';
        }
      });
    }
    // update legend
    if(c.options.plugins&&c.options.plugins.legend&&c.options.plugins.legend.labels)c.options.plugins.legend.labels.color=leg;
    // update tooltip
    if(c.options.plugins&&c.options.plugins.tooltip){
      c.options.plugins.tooltip.backgroundColor=ttBg;
      c.options.plugins.tooltip.borderColor=ttBdr;
      c.options.plugins.tooltip.titleColor=ttTitle;
      c.options.plugins.tooltip.bodyColor=ttBody;
    }
    c.update('none');
  });
}
// Apply saved theme on load
(function(){setTheme(getTheme())})();

const FUNDS={
  I: {name:'Fund I',  vintage:2008,size:30, cur:'â‚¬',status:'Exited',   irr:22.1,tvpi:3.1,dpi:3.1,moic:3.8,invested:28, nav:0,  realized:93, deployed:93},
  II:{name:'Fund II', vintage:2011,size:80, cur:'â‚¬',status:'Exited',   irr:19.8,tvpi:2.7,dpi:2.7,moic:3.2,invested:74, nav:0,  realized:200,deployed:100},
  III:{name:'Fund III',vintage:2013,size:150,cur:'â‚¬',status:'Mature',  irr:17.2,tvpi:2.4,dpi:1.9,moic:2.9,invested:142,nav:75, realized:285,deployed:95},
  IV:{name:'Fund IV', vintage:2018,size:220,cur:'â‚¬',status:'Maturing', irr:16.5,tvpi:2.1,dpi:0.8,moic:2.6,invested:205,nav:256,realized:176,deployed:93},
  V: {name:'Fund V',  vintage:2020,size:353,cur:'â‚¬',status:'Active',   irr:14.8,tvpi:1.7,dpi:0.3,moic:2.1,invested:310,nav:420,realized:106,deployed:88},
  VI:{name:'Fund VI', vintage:2022,size:431,cur:'$',status:'Deploying',irr:12.4,tvpi:1.4,dpi:0.0,moic:1.6,invested:294,nav:294,realized:0,  deployed:68}
};
const FUND_IRR_QQ={
  III:[21.2,20.8,20.1,19.5,19.0,18.6,18.2,17.8,17.5,17.3,17.2,17.2],
  IV: [12.0,13.2,14.1,15.0,15.8,16.2,16.5,16.5,16.4,16.5,16.5,16.5],
  V:  [5.1, 6.8, 8.2, 9.5,10.8,12.0,12.9,13.6,14.2,14.6,14.8,14.8],
  VI: [0,   0,   2.1, 4.5, 6.2, 7.8, 8.9,10.2,10.8,11.2,11.8,12.4]
};
const CO=[
  {name:'Q-CTRL',    funds:['VI'],     sector:'DeepTech/Quantum', stage:'Series B+',navFunds:{VI:82}, nav:82, navPct:27.9,moic:2.3,arr:18,arrGr:120,evArr:22,  evArrEntry:14.2,geo:'AUS/US',status:'Star',       burn:1.2,gm:75,nrr:145,valuation:396, lever:'Scale GTM + gov contracts',   esgE:72,esgS:85,esgG:88},
  {name:'Multiverse',funds:['VI'],     sector:'EdTech',           stage:'Series D', navFunds:{VI:55}, nav:55, navPct:18.7,moic:2.0,arr:48,arrGr:65, evArr:8.5, evArrEntry:5.8, geo:'UK',    status:'Core',       burn:1.4,gm:66,nrr:122,valuation:408, lever:'US expansion',                esgE:65,esgS:92,esgG:80},
  {name:'d-Matrix',  funds:['VI'],     sector:'AI Hardware',      stage:'Series B', navFunds:{VI:38}, nav:38, navPct:12.9,moic:1.7,arr:5, arrGr:200,evArr:44,  evArrEntry:28.5,geo:'US',    status:'High Growth', burn:4.2,gm:45,nrr:null,valuation:220,lever:'Design wins â†’ revenue',       esgE:58,esgS:70,esgG:82},
  {name:'Ledger',    funds:['VI'],     sector:'FinTech/Crypto',   stage:'Series C+',navFunds:{VI:32}, nav:32, navPct:10.9,moic:1.6,arr:85,arrGr:35, evArr:18,  evArrEntry:12.0,geo:'FR',    status:'Core',       burn:0.6,gm:72,nrr:118,valuation:1530,lever:'Enterprise custody B2B',      esgE:70,esgS:75,esgG:90},
  {name:'Wayflyer',  funds:['V','VI'], sector:'FinTech',          stage:'Series B', navFunds:{V:14,VI:26},nav:40,navPct:8.8,moic:1.4,arr:42,arrGr:55,evArr:7.1,evArrEntry:4.8, geo:'IE',    status:'Core',       burn:1.1,gm:68,nrr:115,valuation:298, lever:'Unit econ â†’ scale',           esgE:68,esgS:80,esgG:82},
  {name:'Matillion', funds:['IV','VI'],sector:'Software',         stage:'Series E', navFunds:{IV:10,VI:22},nav:32,navPct:7.5,moic:1.5,arr:62,arrGr:40,evArr:9.4,evArrEntry:6.5,geo:'UK',    status:'Core',       burn:1.3,gm:70,nrr:130,valuation:583, lever:'IPO readiness',               esgE:75,esgS:80,esgG:88},
  {name:'Sanity',    funds:['VI'],     sector:'Software',         stage:'Series C', navFunds:{VI:18}, nav:18, navPct:6.1, moic:1.5,arr:24,arrGr:38, evArr:3.5, evArrEntry:2.8, geo:'NO/US', status:'Watch',      burn:2.0,gm:72,nrr:105,valuation:85,  lever:'ARR acceleration needed',     esgE:62,esgS:75,esgG:78},
  {name:'Headway',   funds:['VI'],     sector:'EdTech',           stage:'Series C', navFunds:{VI:14}, nav:14, navPct:4.8, moic:1.1,arr:15,arrGr:80, evArr:12,  evArrEntry:10.5,geo:'UA/US', status:'Watch',      burn:1.6,gm:55,nrr:95, valuation:180, lever:'Freemium conversion',          esgE:70,esgS:88,esgG:72},
  {name:'Booksy',    funds:['V'],      sector:'Software',         stage:'Series C', navFunds:{V:24},  nav:24, navPct:0,   moic:1.7,arr:38,arrGr:30, evArr:6.8, evArrEntry:4.5, geo:'PL/US', status:'Core',       burn:0.7,gm:71,nrr:110,valuation:258, lever:'Expand verticals',            esgE:68,esgS:82,esgG:80},
  {name:'Quantexa', funds:['V'],      sector:'Software/AI',      stage:'Series E', navFunds:{V:35},  nav:35, navPct:0,   moic:2.2,arr:72,arrGr:45, evArr:11.8,evArrEntry:7.2, geo:'UK',    status:'Star',       burn:1.5,gm:68,nrr:128,valuation:850, lever:'Gov + financial services',    esgE:72,esgS:78,esgG:86}
];
const LPS=[
  {name:'Schroder Adveq',       hq:'Zurich',     type:'Fund of Funds',commit:65, called:44.2,dist:8.8, nav:52,   irr:14.1,tvpi:1.38},
  {name:'APG Asset Mgmt',       hq:'Amsterdam',  type:'Pension',      commit:50, called:34,  dist:6.2, nav:41,   irr:13.8,tvpi:1.39},
  {name:'Neuberger Berman',     hq:'New York',   type:'Fund of Funds',commit:45, called:30.6,dist:5.4, nav:36,   irr:13.5,tvpi:1.35},
  {name:'British Business Bank',hq:'Sheffield',  type:'Government',   commit:40, called:27.2,dist:4.8, nav:32,   irr:12.9,tvpi:1.35},
  {name:'EIF',                  hq:'Luxembourg', type:'DFI',          commit:35, called:23.8,dist:3.9, nav:27,   irr:13.2,tvpi:1.30},
  {name:'Adams Street',         hq:'Chicago',    type:'Fund of Funds',commit:30, called:20.4,dist:3.2, nav:24,   irr:12.8,tvpi:1.33},
  {name:'Isomer Capital',       hq:'London',     type:'Fund of Funds',commit:25, called:17,  dist:2.5, nav:19.5, irr:12.6,tvpi:1.29},
  {name:'GP Commitment',        hq:'London',     type:'GP',           commit:20, called:13.6,dist:2.1, nav:16,   irr:14.4,tvpi:1.33}
];
const LP_DIR=[
  {name:'Schroder Adveq',      hq:'Zurich',    type:'FoF',      totalCommit:145,funds:['III','IV','V','VI'],reup:true,  f7:'Soft-circled',  next:'Apr 2025'},
  {name:'APG Asset Mgmt',      hq:'Amsterdam', type:'Pension',  totalCommit:110,funds:['IV','V','VI'],      reup:true,  f7:'Soft-circled',  next:'May 2025'},
  {name:'Neuberger Berman',    hq:'New York',  type:'FoF',      totalCommit:95, funds:['IV','V','VI'],      reup:true,  f7:'In discussion', next:'Q2 2025'},
  {name:'British Business Bank',hq:'Sheffield', type:'Gov',     totalCommit:80, funds:['V','VI'],           reup:true,  f7:'TBD',           next:'Q3 2025'},
  {name:'EIF',                 hq:'Luxembourg',type:'DFI',      totalCommit:75, funds:['IV','V','VI'],      reup:true,  f7:'TBD',           next:'Q2 2025'},
  {name:'Adams Street',        hq:'Chicago',   type:'FoF',      totalCommit:65, funds:['III','V','VI'],     reup:false, f7:'Unknown',        next:'Q3 2025'},
  {name:'Isomer Capital',      hq:'London',    type:'FoF',      totalCommit:55, funds:['V','VI'],           reup:true,  f7:'Interested',    next:'Apr 2025'},
  {name:'GP Commitment',       hq:'London',    type:'GP',       totalCommit:40, funds:['I','II','III','IV','V','VI'],reup:true,f7:'Committed',next:'Always'},
  {name:'MassMutual Ventures', hq:'Boston',    type:'Corp VC',  totalCommit:30, funds:['IV'],              reup:false, f7:'Not invited',   next:'Annual'},
  {name:'SWEN Capital',        hq:'Paris',     type:'Impact',   totalCommit:25, funds:['V'],               reup:true,  f7:'Considering',   next:'May 2025'}
];
const PIPELINE=[
  {name:'Tractable',    sector:'AI Insurance',   stage:'Diligence',arr:45, arrGr:65, val:540, evArr:12.0,src:'Proprietary',priority:'High'},
  {name:'Corelight',    sector:'Cybersecurity',  stage:'Diligence',arr:55, arrGr:50, val:620, evArr:11.3,src:'Network',    priority:'High'},
  {name:'Monite',       sector:'B2B FinTech',    stage:'Diligence',arr:12, arrGr:180,val:95,  evArr:7.9, src:'Proprietary',priority:'High'},
  {name:'Rasa',         sector:'Convo AI',       stage:'Diligence',arr:18, arrGr:95, val:140, evArr:7.8, src:'Network',    priority:'High'},
  {name:'Sertis',       sector:'AI / Data',      stage:'IC Ready', arr:22, arrGr:110,val:175, evArr:8.0, src:'Proprietary',priority:'High'},
  {name:'Form3',        sector:'Payments Infra', stage:'IC Ready', arr:28, arrGr:75, val:225, evArr:8.0, src:'Proprietary',priority:'High'},
  {name:'Synthesia',    sector:'AI Video',       stage:'Tracking', arr:32, arrGr:85, val:280, evArr:8.8, src:'Network',    priority:'Med'},
  {name:'Cogni',        sector:'Neo-banking',    stage:'Tracking', arr:8,  arrGr:200,val:65,  evArr:8.1, src:'Network',    priority:'Med'},
  {name:'Proxima',      sector:'eCommerce AI',   stage:'Tracking', arr:14, arrGr:90, val:88,  evArr:6.3, src:'Network',    priority:'Med'},
  {name:'SafetyWing',   sector:'InsurTech',      stage:'Tracking', arr:22, arrGr:55, val:140, evArr:6.4, src:'Network',    priority:'Low'},
  {name:'Supermetrics', sector:'Marketing Tech', stage:'Tracking', arr:42, arrGr:25, val:280, evArr:6.7, src:'Referral',   priority:'Low'},
  {name:'Pave',         sector:'Compensation',   stage:'Tracking', arr:18, arrGr:65, val:110, evArr:6.1, src:'Inbound',    priority:'Low'},
  {name:'Papaya Global',sector:'HRTech',         stage:'Tracking', arr:95, arrGr:38, val:850, evArr:8.9, src:'Inbound',    priority:'Low'},
  {name:'Zettle (spin)',sector:'FinTech',         stage:'Tracking', arr:28, arrGr:38, val:185, evArr:6.6, src:'Referral',   priority:'Low'}
];
const C={or:'#E8622A',orl:'#F5804E',gr:'#2ECC8A',re:'#E05555',bl:'#4A8BD4',pu:'#9B6CF0',tl:'#4AB4C8',go:'#D4A843'};
const CH={};
function dc(id){if(CH[id]){CH[id].destroy();delete CH[id]}}
function mk(id,cfg){
  dc(id);const el=document.getElementById(id);if(!el)return null;
  function dm(a,b){const r=JSON.parse(JSON.stringify(a));function mg(a,b){for(const k in b){if(b[k]&&typeof b[k]==='object'&&!Array.isArray(b[k])&&a[k]&&typeof a[k]==='object'&&!Array.isArray(a[k])){mg(a[k],b[k])}else{a[k]=b[k]}}}mg(r,b);return r;}
  var _s=getComputedStyle(document.documentElement),_tick=_s.getPropertyValue('--chart-tick').trim(),_grid=_s.getPropertyValue('--chart-grid').trim(),_bdr=_s.getPropertyValue('--chart-border').trim(),_leg=_s.getPropertyValue('--chart-legend').trim(),_ttBg=_s.getPropertyValue('--chart-tooltip-bg').trim(),_ttBdr=_s.getPropertyValue('--chart-tooltip-border').trim(),_ttT=_s.getPropertyValue('--chart-tooltip-title').trim(),_ttB=_s.getPropertyValue('--chart-tooltip-body').trim();
  const dflt={options:{responsive:true,maintainAspectRatio:false,animation:{duration:500,easing:'easeOutQuart'},plugins:{legend:{labels:{color:_leg,font:{family:'JetBrains Mono',size:10},boxWidth:10,padding:10}},tooltip:{backgroundColor:_ttBg,borderColor:_ttBdr,borderWidth:1,titleColor:_ttT,bodyColor:_ttB,titleFont:{family:'Syne',size:12,weight:600},bodyFont:{family:'JetBrains Mono',size:11},padding:10,cornerRadius:7}},scales:{x:{ticks:{color:_tick,font:{family:'JetBrains Mono',size:10}},grid:{color:_grid},border:{color:_bdr}},y:{ticks:{color:_tick,font:{family:'JetBrains Mono',size:10}},grid:{color:_grid},border:{color:_bdr}}}}};
  CH[id]=new Chart(el,dm(dflt,cfg));return CH[id];
}
function sc(s){return s.includes('AI Hardware')?'c-ai':s.includes('Software')?'c-sw':s.includes('FinTech')||s.includes('Crypto')?'c-fi':s.includes('EdTech')?'c-ed':s.includes('Quantum')||s.includes('DeepTech')?'c-qu':s.includes('AI')?'c-ai':'c-sw';}
function stC(s){return s==='Star'?'t-gr':s==='Watch'?'t-re':s==='High Growth'?'t-pu':'t-or';}
let curPage='pulse';const INIT={};
function go(id){
  document.querySelectorAll('.pg').forEach(p=>p.classList.remove('on'));
  document.querySelectorAll('.nav a').forEach(a=>a.classList.remove('on'));
  const pg=document.getElementById('pg-'+id);if(pg)pg.classList.add('on');
  const nl=document.getElementById('n-'+id);if(nl)nl.classList.add('on');
  curPage=id;if(!INIT[id]){INIT[id]=true;initPage(id);}
}
function initPage(id){
  switch(id){
    case'pulse':initPulse();break;case'funds':initFunds();break;case'portfolio':initPortfolio();break;
    case'companies':initCos();break;case'pipeline':initPipeline();break;case'exits':initExits();break;
    case'risk':initRisk();break;case'lp':initLP();break;case'investors':initInvestors();break;
    case'reports':initReports();break;
    case'security':initSecurity();break;
    case'bullhub':initBullhub();break;
    case'tools':initTools();break;
  }
}
function stSwitch(tid,pref,n,lazy){
  document.getElementById(tid).querySelectorAll('.stab').forEach((t,i)=>t.classList.toggle('on',i===n));
  document.querySelectorAll('[id^="'+pref+'"]').forEach(p=>{if(/^\d+$/.test(p.id.replace(pref,'')))p.classList.toggle('on',p.id===pref+n);});
  if(lazy)lazy(n);
}
function fst(n){stSwitch('funds-tabs','fs',n,lazyF)}
function pst(n){stSwitch('port-tabs','ps',n,lazyP)}
function cst(n){stSwitch('co-tabs','cs',n,lazyC)}
function est(n){stSwitch('ex-tabs','es',n,lazyE)}
function rst(n){stSwitch('ri-tabs','rs',n,lazyR)}
function lst(n){stSwitch('lp-tabs','ls',n,lazyL)}
function ivt(n){stSwitch('inv-tabs','ivs',n,lazyI)}
function bhst(n){stSwitch('bh-tabs','bhs',n,lazyBH)}
function tst(n){stSwitch('tools-tabs','ts',n,lazyT)}
function lazyF(n){if(n===0&&!CH['fd'])renderFundDetail('I');if(n===1&&!CH['ch-f-irr-traj'])initFIRR();if(n===2&&!CH['ch-f-pme'])initFPME();if(n===3&&!CH['ch-f-attr'])initFVC();if(n===4&&!CH['ch-f-jcurve'])initFJCurve();if(n===5&&!CH['ch-f-deploy'])initFCap();}
function lazyP(n){if(n===0&&!CH['ch-p-alloc'])initPortAlloc();if(n===1&&!CH['ch-p-followon'])initPortFO();if(n===2&&!CH['ch-p-matrix'])initPortMat();if(n===3&&!CH['ch-p-conc'])initPortConc();if(n===4&&!CH['ch-esg-radar'])initESG();}
function lazyC(n){if(n===1&&!CH['ch-c-arr'])initCoGrowth();if(n===2&&!CH['ch-c-burn'])initCoBurn();if(n===3&&!CH['ch-c-nrr'])initCoNRR();}
function lazyE(n){if(n===0&&!document.querySelector('#exit-readiness-scores .score-wrap'))renderExitScores();if(n===1&&!CH['ch-e-fundret'])initExitScen();if(n===2&&!CH['ch-e-timing'])initExitTiming();}
function lazyR(n){if(n===0&&!CH['ch-r-scenarios'])initRiskScen();if(n===1&&!CH['ch-r-macro'])initRiskMacro();if(n===2&&!CH['ch-r-fx'])initRiskFX();}
function lazyL(n){if(n===1&&!CH['ch-l-calls'])initLPCap();if(n===2&&!CH['ch-l-dpi-build'])initLPCF();if(n===3&&!CH['ch-l-bridge'])initLPAttr();}
function lazyI(n){if(n===1&&!CH['ch-inv-reup'])initInvHist();if(n===3)renderComms();}
function lazyBH(n){if(n===1&&!CH['ch-re-comps'])initResComps();if(n===2&&!CH['ch-ma-mult'])initResMA();if(n===4&&!CH['ch-macro-rates'])initResMacro();if(n===5)renderCompMaps();}
function lazyT(n){if(n===0)initMonteCarlo();if(n===1&&!CH['ch-dcf-proj'])initDCF();if(n===2&&!CH['ch-var-dist'])initVAR();}
function updateClock(){const d=new Date();document.getElementById('clock').textContent=d.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit',second:'2-digit'})+' UTC';}
setInterval(updateClock,1000);updateClock();
// PULSE
function initPulse(){
  const alerts=[
    {c:'a-re',i:'ðŸ”´',m:'Q-CTRL at 27.9% Fund VI NAV â€” above 25% single-name IC threshold. Immediate discussion required.'},
    {c:'a-or',i:'ðŸŸ¡',m:'d-Matrix: 14 months runway at $3.5M/mo burn. Series C process must begin Q3 2025.'},
    {c:'a-or',i:'ðŸŸ¡',m:'Sanity ARR growth decelerating 46%â†’38% over 2Q. Board-level GTM review needed.'},
    {c:'a-gr',i:'ðŸŸ¢',m:'Matillion IPO prep: $62M ARR, 70% GM, 1.3Ã— burn. H2 2025 window opening.'},
    {c:'a-gr',i:'ðŸŸ¢',m:'Quantexa: $72M ARR, 45% growth â€” RELX and Thomson Reuters in exploratory discussion.'},
    {c:'a-bl',i:'ðŸ”µ',m:'Fund VII: Schroder and APG soft-circles confirmed. â‚¬280M of â‚¬600M target secured.'}
  ];
  document.getElementById('pulse-alerts').innerHTML=alerts.map(a=>`<div class="alert ${a.c}">${a.i} ${a.m}</div>`).join('');
  const qls=['Q2 23','Q3 23','Q4 23','Q1 24','Q2 24','Q3 24','Q4 24','Q1 25'];
  mk('ch-pulse-platform',{type:'line',data:{labels:qls,datasets:[
    {label:'Fund IV NAV (â‚¬M)',data:[235,240,244,248,251,253,255,256],borderColor:C.pu,fill:false,tension:.3,pointRadius:2,borderWidth:2},
    {label:'Fund V NAV (â‚¬M)',data:[355,372,386,395,403,410,416,420],borderColor:C.bl,fill:false,tension:.3,pointRadius:2,borderWidth:2},
    {label:'Fund VI NAV ($M)',data:[210,235,258,278,286,290,292,294],borderColor:C.or,fill:false,tension:.3,pointRadius:2,borderWidth:2},
    {label:'Platform Total (â‚¬M)',data:[800,847,888,921,940,953,963,970],borderColor:C.gr,backgroundColor:C.gr+'08',fill:true,tension:.3,pointRadius:2,borderWidth:2.5}
  ]},options:{scales:{y:{title:{display:true,text:'NAV (â‚¬M / $M)',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  const fhm=document.getElementById('fund-health-matrix');
  fhm.innerHTML=['III','IV','V','VI'].map(k=>{
    const f=FUNDS[k];const ic=f.irr>=17?C.gr:f.irr>=14?C.or:C.re;const tc=f.tvpi>=2?C.gr:f.tvpi>=1.5?C.or:C.re;
    return`<div style="display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border)">
      <div style="width:62px;font-family:var(--font-mono);font-size:11px;color:var(--text)">${f.name}</div>
      <div style="flex:1">
        <div style="display:flex;justify-content:space-between;font-family:var(--font-mono);font-size:11px;color:var(--text-mid);margin-bottom:3px">
          <span>IRR <span style="color:${ic}">${f.irr}%</span></span>
          <span>TVPI <span style="color:${tc}">${f.tvpi}Ã—</span></span>
          <span>NAV <span style="color:var(--text)">${f.cur}${f.nav}M</span></span>
        </div>
        <div class="mbar"><div class="mbar-f" style="width:${Math.min(100,f.irr/24*100)}%;background:${ic}"></div></div>
      </div>
      <span class="t ${f.status==='Exited'?'t-dim':f.status==='Deploying'?'t-bl':f.status==='Active'?'t-or':'t-gr'}">${f.status}</span>
    </div>`;}).join('');
  const tb=document.querySelector('#tbl-pulse tbody');tb.innerHTML='';
  CO.slice().sort((a,b)=>b.nav-a.nav).forEach(c=>{
    const bc=c.burn<=1.2?'up':c.burn<=1.8?'neu':'dn';
    tb.innerHTML+=`<tr onclick="openModal('${c.name}')">
      <td class="name-cell click">${c.name}</td><td><span class="t t-dim">${c.funds.join(',')}</span></td>
      <td><span class="sc ${sc(c.sector)}">${c.sector.split('/')[0]}</span></td>
      <td><span class="t ${stC(c.status)}">${c.status}</span></td>
      <td class="num">$${c.nav}M</td><td class="num">${c.moic}Ã—</td>
      <td class="num">$${c.arr}M</td>
      <td class="num ${c.arrGr>=80?'up':c.arrGr>=35?'neu':'dn'}">${c.arrGr}%</td>
      <td class="num ${bc}">${c.burn}Ã—</td>
    </tr>`;});
  const acts=document.getElementById('pulse-actions');
  [{i:'ðŸ”´',t:'Q-CTRL concentration breach â€” IC memo before next close.',tag:'Risk'},
   {i:'ðŸŸ¡',t:'d-Matrix Series C: initiate banker process Q3.',tag:'Runway'},
   {i:'ðŸŸ¡',t:'Sanity GTM: VP Sales interview Apr 18. Decision by May.',tag:'Ops'},
   {i:'ðŸŸ¢',t:'Matillion IPO: S-1 filing timeline Q3 2025.',tag:'Exit'},
   {i:'ðŸŸ¢',t:'Quantexa: RELX and Thomson Reuters exploratory. Engage banker.',tag:'Exit'},
   {i:'ðŸ”µ',t:'Fund VII: â‚¬280M soft-circled. Target hard close Q2 2027.',tag:'Fundraise'}
  ].forEach(a=>{acts.innerHTML+=`<div style="display:flex;align-items:flex-start;gap:8px;padding:8px 0;border-bottom:1px solid var(--border)"><span style="font-size:13px;flex-shrink:0;margin-top:1px">${a.i}</span><div><div style="font-size:11px;color:var(--text);line-height:1.45">${a.t}</div><span class="t t-bl" style="margin-top:4px">${a.tag}</span></div></div>`;});
}
// FUNDS
let sFundKey='I';
function initFunds(){
  const tb=document.querySelector('#tbl-funds-snap tbody');tb.innerHTML='';
  Object.keys(FUNDS).forEach(k=>{const f=FUNDS[k];const st=f.status==='Exited'?'t-dim':f.status==='Active'?'t-or':f.status==='Deploying'?'t-bl':'t-gr';
    tb.innerHTML+=`<tr onclick="selFund('${k}');fst(0)"><td class="name-cell click">${f.name}</td><td class="num">${f.vintage}</td><td class="num">${f.cur}${f.size}M</td><td><span class="t ${st}">${f.status}</span></td><td class="num ${f.irr>=17?'up':f.irr>=12?'neu':'dn'}">${f.irr}%</td><td class="num">${f.tvpi}Ã—</td><td class="num">${f.dpi}Ã—</td><td class="num">${f.moic}Ã—</td><td class="num">${f.deployed}%</td><td class="num">${f.cur}${f.nav}M</td></tr>`;});
  renderFundDetail('I');
}
function selFund(k){sFundKey=k;document.querySelectorAll('#pg-funds .fund-btn').forEach(b=>b.classList.toggle('on',b.textContent.trim()==='Fund '+k));renderFundDetail(k);}
function renderFundDetail(k){
  const f=FUNDS[k];const panel=document.getElementById('fund-detail-panel');const cf=CO.filter(c=>c.funds.includes(k));
  const ic=f.irr>=17?C.gr:f.irr>=12?C.or:C.re;
  var kpiHtml='<div class="kpi-row">'
    +'<div class="kpi"><div class="kpi-label">Net IRR</div><div class="kpi-val" style="color:'+ic+'">'+f.irr+'%</div></div>'
    +'<div class="kpi"><div class="kpi-label">TVPI</div><div class="kpi-val">'+f.tvpi+'Ã—</div></div>'
    +'<div class="kpi"><div class="kpi-label">DPI</div><div class="kpi-val">'+f.dpi+'Ã—</div></div>'
    +'<div class="kpi"><div class="kpi-label">MOIC</div><div class="kpi-val">'+f.moic+'Ã—</div></div>'
    +'<div class="kpi"><div class="kpi-label">Fund Size</div><div class="kpi-val">'+f.cur+f.size+'M</div></div>'
    +'<div class="kpi"><div class="kpi-label">Deployed</div><div class="kpi-val">'+f.deployed+'%</div><div class="kpi-sub neu">'+f.cur+f.invested+'M</div></div>'
    +'</div>';
  var coHtml='';
  if(cf.length>0){
    var rows=cf.map(function(c){
      var ac=c.arrGr>=80?'up':c.arrGr>=35?'neu':'dn';
      return '<tr onclick="openModal(\'' + c.name + '\')">'
        +'<td class="name-cell click">'+c.name+'</td>'
        +'<td><span class="sc '+sc(c.sector)+'">'+c.sector.split('/')[0]+'</span></td>'
        +'<td class="num">$'+(c.navFunds[k]||c.nav)+'M</td>'
        +'<td class="num">'+c.moic+'Ã—</td>'
        +'<td class="num">$'+c.arr+'M</td>'
        +'<td class="num '+ac+'">'+c.arrGr+'%</td>'
        +'<td><span class="t '+stC(c.status)+'">'+c.status+'</span></td></tr>';
    }).join('');
    coHtml='<div class="card"><div class="ch"><h3>'+f.name+' â€” Portfolio ('+cf.length+' companies)</h3></div>'
      +'<div class="cb-0"><table class="tbl"><thead><tr><th>Company</th><th>Sector</th>'
      +'<th class="num">NAV</th><th class="num">MOIC</th><th class="num">ARR</th><th class="num">Gr%</th><th>Status</th>'
      +'</tr></thead><tbody>'+rows+'</tbody></table></div></div>';
  }
  panel.innerHTML=kpiHtml+coHtml;
  CH['fd']=true;
}
let vcFund='VI';function selVCFund(k){vcFund=k;document.querySelectorAll('#fs3 .fund-btn').forEach(b=>b.classList.toggle('on',b.textContent.trim()==='Fund '+k));updateVC(k);}
function initFVC(){updateVC('VI');}
function updateVC(k){
  const coF=CO.filter(c=>c.funds.includes(k));const totalGain=coF.reduce((s,c)=>s+(c.evArr-c.evArrEntry)*c.arr,0);
  dc('ch-f-attr');mk('ch-f-attr',{type:'doughnut',data:{labels:['Revenue Growth','Multiple Expansion','Margin Improvement','Leverage','FX'],datasets:[{data:[50,28,14,5,3],backgroundColor:[C.or,C.bl,C.gr,C.pu,C.go],borderWidth:0}]},options:{plugins:{legend:{position:'right'}},cutout:'52%'}});
  dc('ch-f-evarr');mk('ch-f-evarr',{type:'bar',data:{labels:coF.map(c=>c.name),datasets:[{label:'Entry EV/ARR',data:coF.map(c=>c.evArrEntry),backgroundColor:C.bl+'88',borderRadius:4,barPercentage:.38},{label:'Current EV/ARR',data:coF.map(c=>c.evArr),backgroundColor:C.or,borderRadius:4,barPercentage:.38}]},options:{scales:{y:{title:{display:true,text:'EV/ARR Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  const d=document.getElementById('value-decomp-table');
  d.innerHTML=`<table class="tbl"><thead><tr><th>Driver</th><th class="num">Contribution</th><th class="num">%</th><th>Trend</th></tr></thead><tbody><tr><td>Revenue Growth</td><td class="num up">+$${(totalGain*.50).toFixed(0)}M</td><td class="num">50%</td><td><span class="t t-gr">Accelerating</span></td></tr><tr><td>Multiple Expansion</td><td class="num up">+$${(totalGain*.28).toFixed(0)}M</td><td class="num">28%</td><td><span class="t t-or">Moderating</span></td></tr><tr><td>Margin Improvement</td><td class="num up">+$${(totalGain*.14).toFixed(0)}M</td><td class="num">14%</td><td><span class="t t-gr">Improving</span></td></tr><tr><td>Leverage</td><td class="num up">+$${(totalGain*.05).toFixed(0)}M</td><td class="num">5%</td><td><span class="t t-bl">Stable</span></td></tr><tr><td>FX</td><td class="num up">+$${(totalGain*.03).toFixed(0)}M</td><td class="num">3%</td><td><span class="t t-go">USD tailwind</span></td></tr><tr style="border-top:1px solid var(--border3)"><td style="font-weight:700">Total Created</td><td class="num up" style="font-weight:700">+$${totalGain.toFixed(0)}M</td><td class="num">100%</td><td></td></tr></tbody></table>`;
}
function initFIRR(){
  const qls=['Q2 22','Q3 22','Q4 22','Q1 23','Q2 23','Q3 23','Q4 23','Q1 24','Q2 24','Q3 24','Q4 24','Q1 25'];const pal=[C.pu,C.bl,C.tl,C.or];
  mk('ch-f-irr-traj',{type:'line',data:{labels:qls,datasets:['III','IV','V','VI'].map((k,i)=>({label:FUNDS[k].name,data:FUND_IRR_QQ[k],borderColor:pal[i],tension:.3,pointRadius:2,borderWidth:2}))},options:{scales:{y:{title:{display:true,text:'Net IRR %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  mk('ch-f-tvpi',{type:'bar',data:{labels:Object.keys(FUNDS).map(k=>FUNDS[k].name),datasets:[{label:'DPI (Realized)',data:Object.keys(FUNDS).map(k=>FUNDS[k].dpi),backgroundColor:C.gr,borderRadius:4},{label:'Residual RVPI',data:Object.keys(FUNDS).map(k=>Math.max(0,FUNDS[k].tvpi-FUNDS[k].dpi)),backgroundColor:C.bl+'66',borderRadius:4}]},options:{scales:{y:{stacked:true,title:{display:true,text:'Multiple Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}},x:{stacked:true}}}});
  mk('ch-f-bench',{type:'bar',data:{labels:Object.keys(FUNDS).map(k=>FUNDS[k].name),datasets:[{label:'Top Quartile',data:[28,25,22,20,18,16],backgroundColor:C.gr+'33',borderColor:C.gr,borderWidth:1,borderRadius:4},{label:'Fund IRR',data:Object.keys(FUNDS).map(k=>FUNDS[k].irr),backgroundColor:C.or,borderRadius:4},{label:'Median',data:[22,20,17,15,13,11],backgroundColor:C.bl+'33',borderColor:C.bl,borderWidth:1,borderRadius:4}]},options:{scales:{y:{title:{display:true,text:'IRR %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  mk('ch-f-dpi-mat',{type:'line',data:{labels:['Yr1','Yr2','Yr3','Yr4','Yr5','Yr6','Yr7','Yr8','Yr9','Yr10'],datasets:Object.keys(FUNDS).map((k,i)=>({label:FUNDS[k].name,data:[0,0.1,0.3,0.6,0.9,1.4,1.9,2.2,2.5,3.1].map(v=>+(v*(FUNDS[k].dpi>0?FUNDS[k].dpi:0.02)/3.1).toFixed(2)),borderColor:[C.or,C.orl,C.bl,C.pu,C.tl,C.go][i],tension:.3,pointRadius:2,borderWidth:2}))},options:{scales:{y:{title:{display:true,text:'DPI Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
function initFPME(){
  mk('ch-f-pme',{type:'bar',data:{labels:['Fund I (08)','Fund II (11)','Fund III (13)','Fund IV (18)','Fund V (20)','Fund VI (22)'],datasets:[{label:'PME vs MSCI World',data:[1.62,1.47,1.38,1.29,1.18,1.12],backgroundColor:C.or,borderRadius:4},{label:'PME vs NASDAQ',data:[1.38,1.25,1.18,1.08,0.98,1.02],backgroundColor:C.bl,borderRadius:4}]},options:{scales:{y:{min:0.8,title:{display:true,text:'PME (>1.0 = outperform)',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  const peer=[16.5,15.2,14.1,13.0,11.8,10.5];
  mk('ch-f-alpha',{type:'bar',data:{labels:Object.keys(FUNDS).map(k=>FUNDS[k].name),datasets:[{label:'Fund IRR',data:Object.keys(FUNDS).map(k=>FUNDS[k].irr),backgroundColor:C.or,borderRadius:4},{label:'Peer Median',data:peer,backgroundColor:C.bl+'55',borderRadius:4},{label:'Alpha (pp)',data:Object.keys(FUNDS).map((k,i)=>FUNDS[k].irr-peer[i]),backgroundColor:C.gr,borderRadius:4}]},options:{scales:{y:{title:{display:true,text:'IRR %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
function initFJCurve(){
  const mo=Array.from({length:25},(_,i)=>'M'+i);
  mk('ch-f-jcurve',{type:'line',data:{labels:mo,datasets:[{label:'Called',data:mo.map((_,i)=>-Math.min(294,i*12+10)),borderColor:C.re,tension:.1,pointRadius:1,borderWidth:1.5,borderDash:[4,3]},{label:'Distributions',data:mo.map((_,i)=>i>20?+(i-20)*8:0),borderColor:C.gr,tension:.3,pointRadius:1,borderWidth:1.5},{label:'NAV',data:mo.map((_,i)=>Math.max(0,i>3?i*12-30:0)),borderColor:C.or,backgroundColor:C.or+'12',fill:true,tension:.3,pointRadius:2,borderWidth:2}]},options:{scales:{y:{title:{display:true,text:'$M',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  mk('ch-f-jall',{type:'line',data:{labels:mo,datasets:Object.keys(FUNDS).map((k,i)=>{const f=FUNDS[k];const scl=f.nav>0?f.nav:f.realized;return{label:f.name,data:mo.map((_,j)=>Math.max(0,j>2?+(j*scl/30-scl*0.1).toFixed(0):-(j+1)*3)),borderColor:[C.or,C.orl,C.bl,C.pu,C.tl,C.go][i],tension:.3,pointRadius:1,borderWidth:1.5};})},options:{scales:{y:{title:{display:true,text:'$M/â‚¬M',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
function initFCap(){
  const qls=['Q1 23','Q2 23','Q3 23','Q4 23','Q1 24','Q2 24','Q3 24','Q4 24','Q1 25'];
  mk('ch-f-deploy',{type:'line',data:{labels:qls,datasets:[{label:'Cumulative Deployed',data:[95,125,155,180,210,235,258,278,294],borderColor:C.or,backgroundColor:C.or+'11',fill:true,tension:.3,pointRadius:3},{label:'Committed ($431M)',data:qls.map(()=>431),borderColor:C.go,borderDash:[5,5],pointRadius:0,borderWidth:1},{label:'Cap. Floor ($368M)',data:qls.map(()=>368),borderColor:C.re,borderDash:[3,3],pointRadius:0,borderWidth:1}]},options:{scales:{y:{title:{display:true,text:'$M',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  const fq=['Q2 25','Q3 25','Q4 25','Q1 26','Q2 26','Q3 26','Q4 26','Q1 27','Q2 27'];
  mk('ch-f-dpi-proj',{type:'line',data:{labels:fq,datasets:[{label:'Base',data:[0,0.05,0.14,0.22,0.34,0.45,0.56,0.64,0.73],borderColor:C.or,backgroundColor:C.or+'11',fill:true,tension:.3,pointRadius:3},{label:'Bull',data:[0,0.09,0.22,0.34,0.50,0.65,0.80,0.92,1.05],borderColor:C.gr,borderDash:[5,3],tension:.3,pointRadius:2},{label:'Bear',data:[0,0,0.06,0.10,0.18,0.26,0.34,0.40,0.46],borderColor:C.re,borderDash:[3,3],tension:.3,pointRadius:2}]},options:{scales:{y:{title:{display:true,text:'DPI Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},min:0}}}});
}
// PORTFOLIO
function initPortfolio(){initPortAlloc();}
function initPortAlloc(){
  const f6=CO.filter(c=>c.funds.includes('VI')).sort((a,b)=>b.navPct-a.navPct);
  mk('ch-p-alloc',{type:'doughnut',data:{labels:f6.map(c=>c.name),datasets:[{data:f6.map(c=>c.navPct),backgroundColor:[C.or,C.orl,C.bl,C.pu,C.tl,C.go,C.gr,C.re],borderWidth:0,hoverOffset:6}]},options:{cutout:'52%',plugins:{legend:{position:'right'}}}});
  const irrC=[{n:'Q-CTRL',fwdIRR:28,nW:.279},{n:'d-Matrix',fwdIRR:35,nW:.129},{n:'Multiverse',fwdIRR:18,nW:.187},{n:'Ledger',fwdIRR:14,nW:.109},{n:'Wayflyer',fwdIRR:12,nW:.088},{n:'Matillion',fwdIRR:15,nW:.075},{n:'Sanity',fwdIRR:8,nW:.061},{n:'Headway',fwdIRR:6,nW:.048}];
  const total=irrC.reduce((s,c)=>s+c.fwdIRR*c.nW,0);
  const wf=document.getElementById('irr-waterfall');
  wf.innerHTML=`<div style="font-family:var(--font-mono);font-size:11px;color:var(--text-mid);margin-bottom:10px">Fund forward IRR = Î£(company IRR Ã— NAV weight) = <strong style="color:var(--orange)">${total.toFixed(1)}%</strong></div>`;
  irrC.forEach(c=>{const ct=+(c.fwdIRR*c.nW).toFixed(2);const pct=ct/total*100;wf.innerHTML+=`<div class="wfall-bar"><span class="wfall-label">${c.n}</span><div class="wfall-track"><div class="wfall-fill" style="width:${pct}%;background:${pct>15?C.or:pct>8?C.bl:C.go}"></div></div><span class="wfall-val" style="color:var(--text)">${ct.toFixed(1)}pp</span></div>`;});
  wf.innerHTML+=`<div style="display:flex;justify-content:space-between;padding:8px 0;border-top:1px solid var(--border3);margin-top:6px"><span style="font-family:var(--font-mono);font-size:11px;font-weight:600">Total Forward IRR</span><span style="font-family:'Playfair Display',serif;font-size:16px;color:var(--orange)">${total.toFixed(1)}%</span></div>`;
  const secs={};CO.filter(c=>c.funds.includes('VI')).forEach(c=>{const s=c.sector.split('/')[0];secs[s]=(secs[s]||0)+c.navPct;});
  mk('ch-p-sector',{type:'doughnut',data:{labels:Object.keys(secs),datasets:[{data:Object.values(secs),backgroundColor:[C.or,C.go,C.bl,C.pu,C.gr,C.tl],borderWidth:0}]},options:{cutout:'45%',plugins:{legend:{position:'bottom',labels:{font:{size:11}}}}}});
  mk('ch-p-geo',{type:'doughnut',data:{labels:['US','UK','EU','AUS','Other'],datasets:[{data:[38,33,12,10,7],backgroundColor:[C.bl,C.or,C.pu,C.tl,C.go],borderWidth:0}]},options:{cutout:'45%',plugins:{legend:{position:'bottom',labels:{font:{size:11}}}}}});
}
function initPortFO(){
  mk('ch-p-followon',{type:'bar',data:{labels:['Q-CTRL','d-Matrix','Multiverse','Wayflyer','Matillion','Reserve'],datasets:[{label:'Alloc. ($M)',data:[30,20,12,10,5,60],backgroundColor:[C.or,C.or,C.or,C.or,C.or,C.go+'55'],borderRadius:5}]},options:{plugins:{legend:{display:false}},scales:{y:{title:{display:true,text:'$M',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  mk('ch-p-fimpact',{type:'bar',data:{labels:['No Follow-On','Conservative','Optimal','Aggressive'],datasets:[{label:'TVPI',data:[1.8,2.0,2.2,2.4],backgroundColor:[C.re,C.go,C.gr,C.bl],borderRadius:5}]},options:{plugins:{legend:{display:false}},scales:{y:{min:1.5,title:{display:true,text:'TVPI Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
function initPortMat(){
  const cd=[{n:'Q-CTRL',fwdIRR:28,aGr:120,nW:27.9,cls:'Winner'},{n:'d-Matrix',fwdIRR:35,aGr:200,nW:12.9,cls:'Winner'},{n:'Multiverse',fwdIRR:18,aGr:65,nW:18.7,cls:'Winner'},{n:'Ledger',fwdIRR:14,aGr:35,nW:10.9,cls:'Protector'},{n:'Wayflyer',fwdIRR:12,aGr:55,nW:8.8,cls:'Protector'},{n:'Matillion',fwdIRR:15,aGr:40,nW:7.5,cls:'Protector'},{n:'Sanity',fwdIRR:8,aGr:38,nW:6.1,cls:'Under'},{n:'Headway',fwdIRR:6,aGr:80,nW:4.8,cls:'Under'}];
  mk('ch-p-matrix',{type:'scatter',data:{datasets:cd.map(c=>({label:c.n,data:[{x:c.fwdIRR,y:c.aGr}],backgroundColor:c.cls==='Winner'?C.gr:c.cls==='Protector'?C.bl:C.re,pointRadius:Math.sqrt(c.nW)*3}))},options:{plugins:{legend:{display:false}},scales:{x:{title:{display:true,text:'Forward IRR %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},min:0,max:45},y:{title:{display:true,text:'ARR Growth %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},min:0,max:230}}}});
  document.getElementById('classify-tbody').innerHTML=cd.map(c=>`<tr><td class="name-cell">${c.n}</td><td class="num">${c.fwdIRR}%</td><td><span class="t ${c.cls==='Winner'?'t-gr':c.cls==='Protector'?'t-bl':'t-re'}">${c.cls}</span></td><td style="font-size:11px;color:var(--text-mid)">${c.cls==='Winner'?'Double down':c.cls==='Protector'?'Hold':'Review'}</td></tr>`).join('');
}
function initPortConc(){
  const f6=CO.filter(c=>c.funds.includes('VI')).sort((a,b)=>b.navPct-a.navPct);
  mk('ch-p-conc',{type:'bar',data:{labels:f6.map(c=>c.name),datasets:[{label:'% NAV',data:f6.map(c=>c.navPct),backgroundColor:f6.map(c=>c.navPct>25?C.re:c.navPct>15?C.or:C.bl),borderRadius:5}]},options:{plugins:{legend:{display:false}},scales:{y:{title:{display:true,text:'% of Fund VI NAV',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  document.getElementById('conc-bars').innerHTML=[{l:'Top 1 (Q-CTRL)',v:27.9,col:C.re},{l:'Top 2 (+Multiverse)',v:46.6,col:C.or},{l:'Top 3 (+d-Matrix)',v:59.5,col:C.go},{l:'Top 5',v:79.3,col:C.bl}].map(b=>`<div style="margin-bottom:13px"><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-family:var(--font-mono);font-size:11px;color:var(--text-mid)">${b.l}</span><span style="font-family:var(--font-mono);font-size:13px">${b.v}%</span></div><div class="mbar mbar-lg"><div class="mbar-f" style="width:${b.v}%;background:${b.col}"></div></div></div>`).join('');
}
function initESG(){
  const f6c=CO.filter(c=>c.funds.includes('VI'));
  mk('ch-esg-radar',{type:'radar',data:{labels:['Environment','Social','Governance','Innovation','Jobs'],datasets:f6c.slice(0,4).map((c,i)=>({label:c.name,data:[c.esgE,c.esgS,c.esgG,75+i*3,70+i*4],borderColor:[C.or,C.bl,C.gr,C.pu][i],backgroundColor:[C.or,C.bl,C.gr,C.pu][i]+'18',pointRadius:3,borderWidth:1.5}))},options:{scales:{r:{ticks:{color:'#3A3830',backdropColor:'transparent',stepSize:20},grid:{color:'rgba(255,255,255,0.06)'},pointLabels:{color:'#7A776F',font:{family:'JetBrains Mono',size:10}},min:0,max:100}}}});
  document.getElementById('esg-impact').innerHTML=`<div class="esg-row"><div class="esg-cat"><div class="esg-cat-label">Jobs Created</div><div class="esg-cat-score" style="color:${C.gr}">4,820</div><span class="t t-gr">â†‘ 22% YoY</span></div><div class="esg-cat"><div class="esg-cat-label">Carbon Neutral</div><div class="esg-cat-score" style="color:${C.bl}">7/8</div><span class="t t-bl">Companies</span></div><div class="esg-cat"><div class="esg-cat-label">Board Diversity</div><div class="esg-cat-score" style="color:${C.or}">31%</div><span class="t t-or">Female board</span></div></div>`;
  const tbl=document.querySelector('#tbl-esg tbody');tbl.innerHTML='';
  f6c.forEach(c=>{const tot=Math.round((c.esgE+c.esgS+c.esgG)/3);tbl.innerHTML+=`<tr><td class="name-cell">${c.name}</td><td class="num">${c.esgE}</td><td class="num">${c.esgS}</td><td class="num">${c.esgG}</td><td class="num"><span class="t ${tot>=80?'t-gr':tot>=65?'t-or':'t-re'}">${tot}</span></td><td>${c.esgE<65?'<span class="t t-re">E low</span>':c.esgS<70?'<span class="t t-or">S flag</span>':'<span class="t t-gr">Clean</span>'}</td><td style="font-size:11px;color:var(--text-mid)">${c.sector.includes('AI')||c.sector.includes('Quantum')?'Deep science':'Digital inclusion'}</td></tr>`;});
}
// COMPANIES
function initCos(){
  const tb=document.querySelector('#tbl-co-score tbody');tb.innerHTML='';
  CO.forEach(c=>{tb.innerHTML+=`<tr onclick="openModal('${c.name}')"><td class="name-cell click">${c.name}</td><td><span class="t t-dim">${c.funds.join(',')}</span></td><td><span class="sc ${sc(c.sector)}">${c.sector.split('/')[0]}</span></td><td class="num">$${c.arr}M</td><td class="num ${c.arrGr>=80?'up':c.arrGr>=35?'neu':'dn'}">${c.arrGr}%</td><td class="num">${c.evArr}Ã—</td><td class="num">${c.moic}Ã—</td><td class="num ${c.nrr&&c.nrr>=120?'up':c.nrr&&c.nrr<100?'dn':'neu'}">${c.nrr||'N/A'}</td><td class="num ${c.burn<=1.2?'up':c.burn<=1.8?'neu':'dn'}">${c.burn}Ã—</td><td><span class="t ${stC(c.status)}">${c.status}</span></td><td style="font-size:11px;color:var(--text-mid);max-width:130px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis">${c.lever}</td></tr>`;});
}
function initCoGrowth(){
  const qls=['Q2 23','Q3 23','Q4 23','Q1 24','Q2 24','Q3 24','Q4 24','Q1 25'];
  mk('ch-c-arr',{type:'line',data:{labels:qls,datasets:[{n:'Q-CTRL',base:4,gr:.22,col:C.or},{n:'d-Matrix',base:0.5,gr:.38,col:C.pu},{n:'Multiverse',base:18,gr:.14,col:C.go},{n:'Matillion',base:32,gr:.09,col:C.bl},{n:'Quantexa',base:30,gr:.10,col:C.tl},{n:'Ledger',base:45,gr:.08,col:C.gr}].map(c=>({label:c.n,data:qls.map((_,i)=>+(c.base*Math.pow(1+c.gr,i)).toFixed(1)),borderColor:c.col,tension:.3,pointRadius:2,borderWidth:2}))},options:{scales:{y:{title:{display:true,text:'ARR ($M)',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
function initCoBurn(){
  mk('ch-c-burn',{type:'scatter',data:{datasets:CO.map(c=>({label:c.name,data:[{x:c.arrGr,y:c.burn}],backgroundColor:c.burn>2?C.re:c.burn>1.4?C.or:C.gr,pointRadius:9}))},options:{plugins:{legend:{display:false},tooltip:{callbacks:{title:i=>[i[0].dataset.label],label:i=>`Growth: ${i.parsed.x}%  Burn: ${i.parsed.y}Ã—`}}},scales:{x:{title:{display:true,text:'ARR Growth %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}},y:{title:{display:true,text:'Burn Multiple Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},reverse:true,min:0.2,max:5}}}});
}
function initCoNRR(){
  const d=[{n:'Q-CTRL',v:145},{n:'Matillion',v:130},{n:'Quantexa',v:128},{n:'Multiverse',v:122},{n:'Ledger',v:118},{n:'Wayflyer',v:115},{n:'Booksy',v:110},{n:'Sanity',v:105},{n:'Headway',v:95}];
  mk('ch-c-nrr',{type:'bar',data:{labels:d.map(x=>x.n),datasets:[{label:'NRR %',data:d.map(x=>x.v),backgroundColor:d.map(x=>x.v>=120?C.gr:x.v>=100?C.or:C.re),borderRadius:5}]},options:{plugins:{legend:{display:false}},scales:{y:{min:80,max:160,title:{display:true,text:'Net Revenue Retention %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
// PIPELINE
function initPipeline(){
  const stages=['Tracking','Diligence','IC Ready'];
  const kanban=document.getElementById('pipeline-kanban');
  kanban.innerHTML=stages.map(function(s){
    var cs=PIPELINE.filter(function(p){return p.stage===s;});
    var cards=cs.map(function(p){
      return '<div class="pipe-card">'
        +'<div class="pipe-card-name">'+p.name+'</div>'
        +'<div class="pipe-card-sub">'+p.sector+'</div>'
        +'<div style="display:flex;justify-content:space-between;font-family:var(--font-mono);font-size:11px;color:var(--text-mid)">'
        +'<span>'+(p.arr?'$'+p.arr+'M ARR':'')+'</span>'
        +'<span class="'+(p.arrGr>=100?'up':'')+'">'+p.arrGr+'%â†‘</span>'
        +'</div></div>';
    }).join('');
    return '<div style="margin-bottom:14px"><div class="pipe-stage-hdr">'+s+'<span>'+cs.length+'</span></div>'
      +'<div>'+cards+'</div></div>';
  }).join('');
  const psec={};PIPELINE.forEach(p=>{psec[p.sector]=(psec[p.sector]||0)+1;});
  mk('ch-pipe-sector',{type:'doughnut',data:{labels:Object.keys(psec),datasets:[{data:Object.values(psec),backgroundColor:[C.or,C.bl,C.pu,C.tl,C.gr,C.go,C.re],borderWidth:0}]},options:{cutout:'45%',plugins:{legend:{position:'bottom',labels:{font:{size:11}}}}}});
  document.getElementById('pipe-notes').innerHTML='Focus areas: <strong style="color:var(--orange)">AI/Cybersec</strong> (2 in DD), <strong style="color:var(--blue)">B2B FinTech</strong> (Form3 IC ready). Target deployments: Form3 ($225M, 8Ã—) and Sertis ($175M, 8Ã—). Est. Q2 commitment: $35â€“50M.';
  const tb=document.querySelector('#tbl-pipeline tbody');tb.innerHTML='';
  PIPELINE.filter(p=>p.stage!=='Passed').sort((a,b)=>(['IC Ready','Diligence','Tracking'].indexOf(a.stage))-(['IC Ready','Diligence','Tracking'].indexOf(b.stage))).forEach(p=>{
    const sc2=p.stage==='IC Ready'?'t-gr':p.stage==='Diligence'?'t-or':'t-dim';const pc=p.priority==='High'?'t-gr':p.priority==='Med'?'t-or':'t-dim';
    tb.innerHTML+=`<tr><td class="name-cell">${p.name}</td><td><span class="sc ${sc(p.sector)}">${p.sector}</span></td><td><span class="t ${sc2}">${p.stage}</span></td><td class="num">$${p.arr}M</td><td class="num ${p.arrGr>=100?'up':p.arrGr>=50?'neu':'dn'}">${p.arrGr}%</td><td class="num">$${p.val}M</td><td class="num">${p.evArr}Ã—</td><td style="font-size:11px;color:var(--text-mid)">${p.src}</td><td><span class="t ${pc}">${p.priority}</span></td></tr>`;});
}
// EXITS
function initExits(){renderExitScores();}
function renderExitScores(){
  const ss=[{n:'Ledger',s:95,ms:['ARR $85M âœ“','GM 72% âœ“','Burn 0.6Ã— âœ“'],nx:'Ready â€” Thoma Bravo / IPO',col:C.gr},{n:'Matillion',s:88,ms:['ARR $62M âœ“','GM 70% âœ“','IPO banker âœ“'],nx:'S-1 prep Q3 2025',col:C.gr},{n:'Wayflyer',s:82,ms:['ARR $42M âœ“','Unit econ âœ“','18mo runway'],nx:'Raise bridge or strategic 2026',col:C.gr},{n:'Quantexa',s:78,ms:['ARR $72M âœ“','GM 68% âœ“','Burn 1.5Ã— âš '],nx:'Reduce burn â†’ exit ready H2 2025',col:C.or},{n:'Multiverse',s:72,ms:['ARR $48M âœ“','US exp âš '],nx:'US ARR >$20M â†’ strategic 2026',col:C.or},{n:'Booksy',s:68,ms:['ARR $38M (need $40M)','GM 71% âœ“'],nx:'Hit $40M â†’ readiness 85+',col:C.or},{n:'Q-CTRL',s:45,ms:['ARR $18M (need $40M)','GM 75% âœ“'],nx:'Need $40M ARR â†’ 2.5yr timeline',col:C.go},{n:'Sanity',s:35,ms:['ARR $24M (need $40M)','Burn 2.0Ã— âœ—'],nx:'Fix burn AND hit $40M ARR',col:C.re},{n:'d-Matrix',s:15,ms:['ARR $5M âœ—','GM 45% âœ—','Burn 4.2Ã— âœ—'],nx:'Hold for AI market scale-up',col:C.re}];
  document.getElementById('exit-readiness-scores').innerHTML=ss.map(function(s){
    var milestones=s.ms.map(function(m){
      var cls=m.includes('âœ“')?'done':m.includes('âš ')?'partial':'';
      return '<span class="score-m '+cls+'">'+m+'</span>';
    }).join('');
    return '<div class="score-wrap">'
      +'<div class="score-hdr"><span class="score-name">'+s.n+'</span>'
      +'<span class="score-val" style="color:'+s.col+'">'+s.s+'/100</span></div>'
      +'<div class="score-bar"><div class="score-fill" style="width:'+s.s+'%;background:'+s.col+'"></div></div>'
      +'<div class="score-ms">'+milestones+'</div>'
      +'<div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-top:4px">â–¶ '+s.nx+'</div>'
      +'</div>';
  }).join('');
}
var EXIT_PROBS={bear:20,base:50,bull:30};
function initExitScen(){exitUpdate();}
function exitProbUpdate(k,v){
  EXIT_PROBS[k]=+v;
  document.getElementById('expv-'+k).textContent=v+'%';
  var tot=EXIT_PROBS.bear+EXIT_PROBS.base+EXIT_PROBS.bull;
  var el=document.getElementById('exit-prob-total');
  if(el){el.textContent=tot+'%';el.style.color=tot===100?'var(--green)':tot>100?'var(--red)':'var(--orange)';}
  exitUpdate();
}
function exitUpdate(){
  var bear=parseFloat(document.getElementById('ex-bear')?document.getElementById('ex-bear').value:5);
  var base=parseFloat(document.getElementById('ex-base')?document.getElementById('ex-base').value:12);
  var bull=parseFloat(document.getElementById('ex-bull')?document.getElementById('ex-bull').value:22);
  var yr=parseFloat(document.getElementById('ex-yr')?document.getElementById('ex-yr').value:2027);
  var dil=parseFloat(document.getElementById('ex-dil')?document.getElementById('ex-dil').value:15)/100;
  var aiPrem=parseFloat(document.getElementById('ex-ai-prem')?document.getElementById('ex-ai-prem').value:30)/100;

  var el=document.getElementById('exv-bear');if(el)el.textContent=bear+'Ã—';
  var el2=document.getElementById('exv-base');if(el2)el2.textContent=base+'Ã—';
  var el3=document.getElementById('exv-bull');if(el3)el3.textContent=bull+'Ã—';
  var el4=document.getElementById('exv-yr');if(el4)el4.textContent=yr;
  var el5=document.getElementById('exv-dil');if(el5)el5.textContent=Math.round(dil*100)+'%';
  var el6=document.getElementById('exv-ai-prem');if(el6)el6.textContent=(aiPrem>=0?'+':'')+Math.round(aiPrem*100)+'%';

  var lbl=document.getElementById('exit-mult-label');
  if(lbl)lbl.textContent='Bear '+bear+'Ã— / Base '+base+'Ã— / Bull '+bull+'Ã—';

  var pb=EXIT_PROBS.bear/100,pba=EXIT_PROBS.base/100,pu=EXIT_PROBS.bull/100;
  var yrsOut=yr-2025;

  var cos2=[
    {name:'Q-CTRL',arr:18,nav:82,sector:'quantum'},
    {name:'Multiverse',arr:48,nav:55,sector:'saas'},
    {name:'d-Matrix',arr:5,nav:38,sector:'ai'},
    {name:'Ledger',arr:85,nav:32,sector:'saas'},
    {name:'Wayflyer',arr:42,nav:26,sector:'saas'},
    {name:'Matillion',arr:62,nav:22,sector:'saas'},
    {name:'Sanity',arr:24,nav:18,sector:'saas'},
    {name:'Headway',arr:15,nav:14,sector:'saas'},
  ];

  var totalPwav=0,totalBull=0;
  var rows=cos2.map(function(c){
    var prem=c.sector==='quantum'||c.sector==='ai'?aiPrem:0;
    var arrFwd=c.arr*(1+0.55*(yrsOut>0?yrsOut:1));
    var bearEV=arrFwd*bear*(1+prem)*(1-dil);
    var baseEV=arrFwd*base*(1+prem)*(1-dil);
    var bullEV=arrFwd*bull*(1+prem)*(1-dil);
    var pwav=bearEV*pb+baseEV*pba+bullEV*pu;
    var gpShare=c.nav/arrFwd;
    var bearGP=Math.round(bearEV*gpShare);
    var baseGP=Math.round(baseEV*gpShare);
    var bullGP=Math.round(bullEV*gpShare);
    var pwavGP=Math.round(pwav*gpShare);
    totalPwav+=pwavGP;
    totalBull+=bullGP;
    var pwavCol=pwavGP>c.nav*1.5?'t-gr':pwavGP>c.nav?'t-or':'t-re';
    return '<tr><td class="name-cell">'+c.name+'</td>'
      +'<td class="num dn">$'+bearGP+'M</td>'
      +'<td class="num">$'+baseGP+'M</td>'
      +'<td class="num up">$'+bullGP+'M</td>'
      +'<td class="num">$'+pwavGP+'M <span class="t '+pwavCol+'">P-Wtd</span></td></tr>';
  }).join('');

  var tblEl=document.getElementById('exit-matrix-table');
  if(tblEl)tblEl.innerHTML='<table class="tbl"><thead><tr>'
    +'<th>Company</th>'
    +'<th class="num">Bear ('+bear+'Ã—)</th>'
    +'<th class="num">Base ('+base+'Ã—)</th>'
    +'<th class="num">Bull ('+bull+'Ã—)</th>'
    +'<th class="num">P-Weighted</th>'
    +'</tr></thead><tbody>'+rows+'</tbody></table>';

  var fundMOIC=(totalPwav/294).toFixed(2);
  var fundDPI=(totalPwav/294*0.65).toFixed(2);
  var fundIRR=Math.max(0,Math.min(60,(totalPwav/294-1)/(yrsOut||2)*100)).toFixed(0);

  function setLive(id,val,color){var e=document.getElementById(id);if(e){e.textContent=val;e.className='live-kpi-val '+color;}}
  setLive('ex-total-ev','$'+totalPwav+'M',totalPwav>891?'up':totalPwav>500?'neu':'dn');
  setLive('ex-fund-moic',fundMOIC+'Ã—',fundMOIC>2.5?'up':fundMOIC>1.5?'neu':'dn');
  setLive('ex-dpi',fundDPI+'Ã—',fundDPI>1.5?'up':fundDPI>0.5?'neu':'dn');
  setLive('ex-irr',fundIRR+'%',fundIRR>15?'up':fundIRR>8?'neu':'dn');

  // Update chart
  dc('ch-e-fundret');
  mk('ch-e-fundret',{type:'bar',data:{
    labels:cos2.map(function(c){return c.name;}),
    datasets:[
      {label:'Bear',data:cos2.map(function(c){var gpS=c.nav/(c.arr*(1+0.55*(yrsOut||1)));return Math.round(c.arr*(1+0.55*(yrsOut||1))*bear*(1+(c.sector==='quantum'||c.sector==='ai'?aiPrem:0))*(1-dil)*gpS);}),backgroundColor:C.re+'99',borderRadius:3},
      {label:'Base',data:cos2.map(function(c){var gpS=c.nav/(c.arr*(1+0.55*(yrsOut||1)));return Math.round(c.arr*(1+0.55*(yrsOut||1))*base*(1+(c.sector==='quantum'||c.sector==='ai'?aiPrem:0))*(1-dil)*gpS);}),backgroundColor:C.or+'99',borderRadius:3},
      {label:'Bull',data:cos2.map(function(c){var gpS=c.nav/(c.arr*(1+0.55*(yrsOut||1)));return Math.round(c.arr*(1+0.55*(yrsOut||1))*bull*(1+(c.sector==='quantum'||c.sector==='ai'?aiPrem:0))*(1-dil)*gpS);}),backgroundColor:C.gr+'99',borderRadius:3},
    ]
  },options:{
    plugins:{legend:{labels:{color:'#7A776F',font:{family:'JetBrains Mono',size:9}}}},
    scales:{y:{title:{display:true,text:'GP Proceeds ($M)',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},grid:{color:'rgba(255,255,255,0.04)'}}}
  }});
}
function initExitTiming(){
  mk('ch-e-timing',{type:'bar',data:{labels:['Ledger','Quantexa','Matillion','Booksy','d-Matrix'],datasets:[{label:'Exit Now',data:[18.2,22.1,16.8,15.5,12.4],backgroundColor:C.gr,borderRadius:4,barPercentage:.25},{label:'Wait 1Y',data:[15.8,20.5,15.2,13.8,10.3],backgroundColor:C.or,borderRadius:4,barPercentage:.25},{label:'Wait 2Y',data:[13.5,18.8,13.9,12.1,8.2],backgroundColor:C.re,borderRadius:4,barPercentage:.25}]},options:{scales:{y:{title:{display:true,text:'IRR %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
// RISK
// â”€â”€ RISK: INTERACTIVE SCENARIO BUILDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var SC_PRESETS={
  base:{arrGr:55,gm:0,nrr:118,evMult:0,dr:8,timing:0,rates:0,fx:0,wo:0},
  soft:{arrGr:75,gm:3,nrr:128,evMult:15,dr:8,timing:-3,rates:-50,fx:3,wo:0},
  mild:{arrGr:30,gm:-5,nrr:105,evMult:-20,dr:10,timing:6,rates:100,fx:-5,wo:5},
  deep:{arrGr:-10,gm:-12,nrr:88,evMult:-40,dr:13,timing:18,rates:200,fx:-10,wo:15},
  tech:{arrGr:35,gm:-2,nrr:108,evMult:-45,dr:12,timing:12,rates:0,fx:0,wo:8},
  ai:{arrGr:95,gm:5,nrr:138,evMult:30,dr:8,timing:-6,rates:0,fx:5,wo:0}
};
var PROB_W={soft:25,base:30,mild:20,deep:10,tech:10,ai:20};

var IPO_STATUS='selective';
function setIPO(v,el){
  IPO_STATUS=v;
  document.querySelectorAll('#ipo-chips .chip').forEach(function(c){c.classList.remove('on');});
  el.classList.add('on');
  macroUpdate();
}

function initRisk(){
  renderProbWeights();
  scUpdate();
  renderFxStressTable();
}

function renderProbWeights(){
  var order=['ai','soft','base','mild','tech','deep'];
  var labels={ai:'AI Acceleration',soft:'Soft Landing',base:'Base Case',mild:'Mild Recession',tech:'Tech Correction',deep:'Deep Recession'};
  var colors={ai:'green-range',soft:'green-range',base:'blue-range',mild:'',tech:'',deep:'red-range'};
  document.getElementById('prob-weights').innerHTML=order.map(function(k){
    return '<div class="ctrl-row">'
      +'<span class="ctrl-label" style="width:130px">'+labels[k]+'</span>'
      +'<input type="range" id="pw-'+k+'" min="0" max="60" value="'+PROB_W[k]+'" class="'+colors[k]+'" oninput="pwUpdate(\''+k+'\',this.value)">'
      +'<span class="ctrl-val" id="pwv-'+k+'">'+PROB_W[k]+'%</span>'
      +'</div>';
  }).join('');
  updateProbTotal();
}

function pwUpdate(k,v){
  PROB_W[k]=+v;
  document.getElementById('pwv-'+k).textContent=v+'%';
  updateProbTotal();
  renderPWAVChart();
}

function updateProbTotal(){
  var tot=Object.values(PROB_W).reduce(function(a,b){return a+b;},0);
  var el=document.getElementById('prob-total-lbl');
  if(el){el.textContent=tot+'%';el.className='t '+(tot===100?'t-gr':tot>100?'t-re':'t-or');}
}

function applyPreset(key,el){
  var p=SC_PRESETS[key];
  document.querySelectorAll('#scen-presets .chip').forEach(function(c){c.classList.remove('on');});
  el.classList.add('on');
  function setSlider(id,v){
    var sl=document.getElementById(id);
    if(sl){sl.value=v;}
  }
  setSlider('sl-arr-gr',p.arrGr);setSlider('sl-gm',p.gm);setSlider('sl-nrr',p.nrr);
  setSlider('sl-evmult',p.evMult);setSlider('sl-dr',p.dr);setSlider('sl-timing',p.timing);
  setSlider('sl-rates',p.rates);setSlider('sl-fx',p.fx);setSlider('sl-wo',p.wo);
  scUpdate();
}

function getSliderVal(id){return parseFloat(document.getElementById(id)?document.getElementById(id).value:0);}

function scUpdate(){
  var arrGr=getSliderVal('sl-arr-gr');
  var gm=getSliderVal('sl-gm');
  var nrr=getSliderVal('sl-nrr');
  var evMult=getSliderVal('sl-evmult');
  var dr=getSliderVal('sl-dr');
  var timing=getSliderVal('sl-timing');
  var rates=getSliderVal('sl-rates');
  var fx=getSliderVal('sl-fx');
  var wo=getSliderVal('sl-wo');

  // Update display labels
  function setLbl(id,v,suffix){var el=document.getElementById(id);if(el)el.textContent=(v>0?'+':'')+v+suffix;}
  setLbl('sv-arr-gr',arrGr,'%');
  setLbl('sv-gm',gm,'pp');
  setLbl('sv-nrr',nrr,'%');
  setLbl('sv-evmult',evMult,'%');
  document.getElementById('sv-dr').textContent=dr+'%';
  setLbl('sv-timing',timing,' mo');
  setLbl('sv-rates',rates,'bp');
  setLbl('sv-fx',fx,'%');
  setLbl('sv-wo',wo,'%');

  // Compute scenario NAV from sliders
  var baseNAV=294;
  var arrFactor=1+(arrGr-55)/100*0.7;       // ARR growth impact on revenue trajectory
  var multFactor=1+evMult/100;               // EV/ARR multiple compression/expansion
  var gmFactor=1+gm/100*0.5;                // Margin impact
  var nrrFactor=1+(nrr-118)/100*0.4;        // Retention quality
  var rateFactor=1-(rates/10000)*2.2;       // Rate sensitivity (VC discount rate)
  var fxFactor=1+fx/100*0.35;              // FX (35% non-USD exposure)
  var woFactor=1-wo/100;                    // Write-off

  var scenNAV=baseNAV*arrFactor*multFactor*gmFactor*nrrFactor*rateFactor*fxFactor*woFactor;
  scenNAV=Math.max(50,Math.min(600,Math.round(scenNAV)));

  var navDelta=scenNAV-baseNAV;
  var navDeltaPct=(navDelta/baseNAV*100).toFixed(1);

  // Compute IRR: rough estimate (base 12.4%, adjusts proportionally to NAV)
  var scenIRR=(12.4*(scenNAV/baseNAV)*0.7+12.4*0.3-timing/12*0.8);
  scenIRR=Math.max(0,Math.min(35,+scenIRR.toFixed(1)));
  var scenTVPI=+(scenNAV/210).toFixed(2);
  var scenDPI=scenNAV>350?+(0.05*(scenNAV-350)/100).toFixed(2):0;

  // Update live cards
  function setLiveCard(navId,deltaId,val,base,unit,decimals){
    var el=document.getElementById(navId);if(!el)return;
    var delta=val-base;
    var cls=delta>0?'up':delta<0?'dn':'';
    el.textContent=(unit||'')+(decimals!==undefined?val.toFixed(decimals):val)+(unit===''?'Ã—':'');
    el.className='live-kpi-val '+cls;
    var del=document.getElementById(deltaId);
    if(del)del.textContent=(delta>=0?'+':'')+delta.toFixed(decimals!==undefined?decimals:0)+(unit||'');
  }
  var navEl=document.getElementById('lv-nav');if(navEl){navEl.textContent='$'+scenNAV+'M';navEl.className='live-kpi-val '+(navDelta>0?'up':navDelta<0?'dn':'');}
  var navDEl=document.getElementById('lv-nav-delta');if(navDEl)navDEl.textContent=(navDelta>=0?'+$':'âˆ’$')+Math.abs(navDelta)+'M ('+Math.abs(navDeltaPct)+'%)';
  var irrEl=document.getElementById('lv-irr');if(irrEl){irrEl.textContent=scenIRR+'%';irrEl.className='live-kpi-val '+(scenIRR>12.4?'up':scenIRR<12.4?'dn':'');}
  var irrDEl=document.getElementById('lv-irr-delta');if(irrDEl)irrDEl.textContent=(scenIRR>=12.4?'+':'')+((scenIRR-12.4).toFixed(1))+'pp vs base';
  var tvpiEl=document.getElementById('lv-tvpi');if(tvpiEl){tvpiEl.textContent=scenTVPI+'Ã—';tvpiEl.className='live-kpi-val '+(scenTVPI>1.40?'up':scenTVPI<1.40?'dn':'');}
  var tvpiDEl=document.getElementById('lv-tvpi-delta');if(tvpiDEl)tvpiDEl.textContent=(scenTVPI>=1.40?'+':'')+(scenTVPI-1.40).toFixed(2)+'Ã— vs base';
  var dpiEl=document.getElementById('lv-dpi');if(dpiEl){dpiEl.textContent=scenDPI+'Ã—';dpiEl.className='live-kpi-val '+(scenDPI>0?'up':'');}

  // Flash effect
  ['lc-nav','lc-irr','lc-tvpi','lc-dpi'].forEach(function(id){
    var el=document.getElementById(id);if(!el)return;
    el.classList.remove('flash');void el.offsetWidth;el.classList.add('flash');
  });

  // Update scenario label: find closest preset
  var bestKey='custom',bestDiff=999;
  Object.keys(SC_PRESETS).forEach(function(k){
    var p=SC_PRESETS[k];
    var diff=Math.abs(arrGr-p.arrGr)+Math.abs(evMult-p.evMult)+Math.abs(wo-p.wo);
    if(diff<bestDiff){bestDiff=diff;bestKey=k;}
  });
  var labelMap={base:'Base',soft:'Soft Landing',mild:'Mild Recession',deep:'Deep Recession',tech:'Tech Correction',ai:'AI Accel.'};
  var lbl=document.getElementById('scen-label');
  if(lbl)lbl.textContent=bestDiff<15?labelMap[bestKey]:'Custom';

  // Update scenario bar chart
  updateScenChart(scenNAV);
  renderCoImpactBars(arrFactor,multFactor,gmFactor,nrrFactor,rateFactor,fxFactor,woFactor);
  renderPWAVChart();
}

function updateScenChart(scenNAV){
  dc('ch-r-scenarios');
  var baseNAV=294;
  var scens=[
    {label:'Deep Rec.',nav:191},
    {label:'Tech Corr.',nav:206},
    {label:'Mild Rec.',nav:235},
    {label:'Crypto Wtr',nav:270},
    {label:'Base',nav:baseNAV},
    {label:'Soft Ldng',nav:338},
    {label:'AI Accel.',nav:368},
    {label:'Custom â–¶',nav:scenNAV,custom:true}
  ];
  scens.sort(function(a,b){return a.nav-b.nav;});
  mk('ch-r-scenarios',{type:'bar',data:{
    labels:scens.map(function(s){return s.label;}),
    datasets:[{
      label:'NAV ($M)',
      data:scens.map(function(s){return s.nav;}),
      backgroundColor:scens.map(function(s){
        if(s.custom)return C.pu;
        return s.nav>=baseNAV?C.gr+'99':C.re+'88';
      }),
      borderColor:scens.map(function(s){return s.custom?C.pu:'transparent';}),
      borderWidth:scens.map(function(s){return s.custom?2:0;}),
      borderRadius:5
    }]
  },options:{
    plugins:{legend:{display:false}},
    scales:{y:{title:{display:true,text:'Fund VI NAV ($M)',color:getComputedStyle(document.documentElement).getPropertyValue('--chart-legend').trim(),font:{family:'JetBrains Mono',size:10}}}}
  }});
}

function renderCoImpactBars(arrF,multF,gmF,nrrF,rateF,fxF,woF){
  var el=document.getElementById('co-impact-bars');if(!el)return;
  var cos=[
    {name:'Q-CTRL',nav:82,beta:1.5},
    {name:'Multiverse',nav:55,beta:0.8},
    {name:'d-Matrix',nav:38,beta:1.8},
    {name:'Ledger',nav:32,beta:1.0},
    {name:'Wayflyer',nav:26,beta:1.0},
    {name:'Matillion',nav:22,beta:0.9},
    {name:'Sanity',nav:18,beta:1.0},
    {name:'Headway',nav:14,beta:0.7},
  ];
  var totalFactor=arrF*multF*gmF*nrrF*rateF*fxF*woF;
  el.innerHTML=cos.map(function(c){
    var adjFactor=1+(totalFactor-1)*c.beta;
    var newNav=Math.max(0,Math.round(c.nav*adjFactor));
    var delta=newNav-c.nav;
    var pct=Math.round(adjFactor*100-100);
    var barColor=delta>=0?'var(--green)':'var(--red)';
    var baseW=50;
    var fillW=Math.min(100,Math.abs(pct)*1.2+baseW);
    return '<div class="scen-bar-wrap">'
      +'<div class="scen-bar-label"><span>'+c.name+'</span>'
      +'<span style="color:'+barColor+'">'+(delta>=0?'+':'')+delta+'M  ('+pct+'%)</span></div>'
      +'<div class="scen-bar">'
      +'<div class="scen-bar-fill" style="width:'+fillW+'%;background:'+barColor+'"></div>'
      +'<div class="scen-bar-base" style="left:'+baseW+'%"></div>'
      +'</div></div>';
  }).join('');
}

function renderPWAVChart(){
  dc('ch-r-pwav');
  var keys=['deep','tech','mild','base','soft','ai'];
  var labels={deep:'Deep Rec',tech:'Tech Corr',mild:'Mild Rec',base:'Base',soft:'Soft Ldng',ai:'AI Accel'};
  var navMap={deep:191,tech:206,mild:235,base:294,soft:338,ai:368};
  var tot=Object.values(PROB_W).reduce(function(a,b){return a+b;},0)||1;
  var pwav=keys.reduce(function(s,k){return s+navMap[k]*(PROB_W[k]||0)/tot;},0);
  mk('ch-r-pwav',{type:'bar',data:{
    labels:keys.map(function(k){return labels[k];}),
    datasets:[
      {label:'NAV ($M)',data:keys.map(function(k){return navMap[k];}),
       backgroundColor:keys.map(function(k){return k==='ai'||k==='soft'?C.gr+'88':k==='deep'||k==='tech'?C.re+'88':C.or+'88';}),borderRadius:3},
      {label:'Weight (%)',data:keys.map(function(k){return PROB_W[k]||0;}),
       backgroundColor:C.bl+'55',borderRadius:3,yAxisID:'y1'}
    ]
  },options:{
    scales:{
      y:{title:{display:true,text:'NAV ($M)',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},grid:{color:'rgba(255,255,255,0.04)'}},
      y1:{position:'right',title:{display:true,text:'Weight %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},grid:{display:false},max:60}
    },
    plugins:{
      tooltip:{callbacks:{footer:function(){return 'P-Wtd Expected NAV: $'+Math.round(pwav)+'M';}}}
    }
  }});
}

// â”€â”€ MACRO SENSITIVITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initRiskMacro(){macroUpdate();}
function macroUpdate(){
  var fed=getSliderVal('ms-fed')/100;
  var yr10=getSliderVal('ms-10yr')/100;
  var gdp=getSliderVal('ms-gdp');
  var cpi=getSliderVal('ms-cpi');
  var it=getSliderVal('ms-it');
  var saas=getSliderVal('ms-saas');
  var vc=getSliderVal('ms-vc');

  function setLabel(id,v,fmt){var el=document.getElementById(id);if(el)el.textContent=fmt(v);}
  setLabel('msv-fed',fed,function(v){return v.toFixed(2)+'%';});
  setLabel('msv-10yr',yr10,function(v){return v.toFixed(2)+'%';});
  setLabel('msv-gdp',gdp,function(v){return (v>0?'+':'')+v.toFixed(1)+'%';});
  setLabel('msv-cpi',cpi,function(v){return v.toFixed(1)+'%';});
  setLabel('msv-it',it,function(v){return (v>0?'+':'')+v+'%';});
  setLabel('msv-saas',saas,function(v){return v+'Ã—';});
  setLabel('msv-vc',vc,function(v){return '$'+v+'B';});

  // Compute macro impact on each fund
  var rateMult=Math.max(0.3,1-(fed-5.25)*0.15);
  var growthMult=Math.max(0.5,1+(gdp-2)*0.08);
  var saasMult=saas/13;
  var totalMult=rateMult*growthMult*saasMult;

  var funds=[
    {name:'Fund IV',base:256,color:C.pu},
    {name:'Fund V',base:420,color:C.bl},
    {name:'Fund VI',base:294,color:C.or}
  ];

  dc('ch-r-macro');
  mk('ch-r-macro',{type:'bar',data:{
    labels:funds.map(function(f){return f.name;}),
    datasets:[
      {label:'Base NAV',data:funds.map(function(f){return f.base;}),
       backgroundColor:funds.map(function(f){return f.color+'88';}),borderRadius:4},
      {label:'Scenario NAV',data:funds.map(function(f){return Math.round(f.base*totalMult);}),
       backgroundColor:funds.map(function(f){return f.color;}),borderRadius:4},
    ]
  },options:{
    plugins:{legend:{labels:{color:'#7A776F',font:{family:'JetBrains Mono',size:9}}}},
    scales:{y:{title:{display:true,text:'NAV ($M)',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},grid:{color:'rgba(255,255,255,0.04)'}}}
  }});

  // Sector beta bars
  var sectors=[
    {name:'AI Hardware',beta:1.8,nav:38},
    {name:'DeepTech/Quantum',beta:1.5,nav:82},
    {name:'FinTech/Crypto',beta:1.3,nav:58},
    {name:'Software/SaaS',beta:1.0,nav:76},
    {name:'EdTech',beta:0.7,nav:69},
  ];
  var el=document.getElementById('sector-beta-bars');
  if(el){
    el.innerHTML=sectors.map(function(s){
      var adj=Math.round(s.nav*(1+(totalMult-1)*s.beta));
      var delta=adj-s.nav;
      var pct=(delta/s.nav*100).toFixed(1);
      var barW=Math.min(100,50+Math.abs(pct)*0.5);
      var col=delta>=0?'var(--green)':'var(--red)';
      return '<div class="scen-bar-wrap">'
        +'<div class="scen-bar-label"><span>'+s.name+' (Î²='+s.beta+')</span>'
        +'<span style="color:'+col+'">'+(delta>=0?'+':'')+delta+'M ('+pct+'%)</span></div>'
        +'<div class="scen-bar">'
        +'<div class="scen-bar-fill" style="width:'+barW+'%;background:'+col+'"></div>'
        +'<div class="scen-bar-base" style="left:50%"></div>'
        +'</div></div>';
    }).join('');
  }
}

// â”€â”€ FX STRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var FX_EXPOSURE={gbp:77,eur:32,aud:82,ils:21};
function initRiskFX(){
  fxUpdate();
  mk('ch-r-fx',{type:'doughnut',data:{labels:['USD','GBP','EUR','AUD','ILS/Other'],
    datasets:[{data:[82,77,32,82,21],backgroundColor:[C.bl,C.or,C.pu,C.tl,C.go],borderWidth:0}]},
    options:{cutout:'50%',plugins:{legend:{position:'right',labels:{color:'#7A776F',font:{family:'JetBrains Mono',size:9}}}}}});
}
function fxUpdate(){
  var shifts={gbp:getSliderVal('fx-gbp'),eur:getSliderVal('fx-eur'),aud:getSliderVal('fx-aud'),ils:getSliderVal('fx-ils')};
  var hedges={gbp:getSliderVal('fx-hgbp')/100,eur:getSliderVal('fx-heur')/100,aud:0,ils:0};

  var totalUnhedged=0,totalHedged=0;
  Object.keys(FX_EXPOSURE).forEach(function(ccy){
    var exp=FX_EXPOSURE[ccy];
    var shift=shifts[ccy]||0;
    var impact=exp*shift/100;
    totalUnhedged+=impact;
    totalHedged+=impact*(1-(hedges[ccy]||0));

    var vEl=document.getElementById('fxv-'+ccy);if(vEl)vEl.textContent=(shift>0?'+':'')+shift+'%';
    var iEl=document.getElementById('fxi-'+ccy);
    if(iEl){iEl.textContent=(impact>=0?'+$':'-$')+Math.abs(impact).toFixed(1)+'M';iEl.style.color=impact>=0?'var(--green)':'var(--red)';}
    var hvEl=document.getElementById('fxhv-'+ccy);if(hvEl)hvEl.textContent=(hedges[ccy]||0)*100+'%';
  });

  var navEl=document.getElementById('fx-total-nav');
  if(navEl){navEl.textContent=(totalUnhedged>=0?'+$':'-$')+Math.abs(totalUnhedged).toFixed(1)+'M';navEl.className='live-kpi-val '+(totalUnhedged>0?'up':'dn');}
  var hEl=document.getElementById('fx-hedged-nav');
  if(hEl){hEl.textContent=(totalHedged>=0?'+$':'-$')+Math.abs(totalHedged).toFixed(1)+'M';hEl.className='live-kpi-val '+(totalHedged>0?'up':'dn');}

  renderFxStressTable();
}

function renderFxStressTable(){
  var el=document.getElementById('fx-stress-table');if(!el)return;
  var scenarios=[
    {name:'USD Strength +10%',gbp:-10,eur:-10,aud:-8,ils:-5},
    {name:'Sterling Crisis âˆ’15%',gbp:-15,eur:0,aud:0,ils:0},
    {name:'EUR Weakness âˆ’12%',gbp:0,eur:-12,aud:0,ils:0},
    {name:'EM/AUD Sell-off âˆ’20%',gbp:-5,eur:-5,aud:-20,ils:-10},
    {name:'USD Weakness âˆ’10%',gbp:10,eur:10,aud:8,ils:5},
  ];
  var rows=scenarios.map(function(sc){
    var impact=Object.keys(FX_EXPOSURE).reduce(function(s,c){return s+FX_EXPOSURE[c]*(sc[c]||0)/100;},0);
    var col=impact>=0?'var(--green)':'var(--red)';
    return '<tr><td class="name-cell">'+sc.name+'</td>'
      +'<td style="font-family:var(--font-mono);font-size:11px;text-align:right;color:'+col+'">'
      +(impact>=0?'+$':'-$')+Math.abs(impact).toFixed(1)+'M</td>'
      +'<td style="font-family:var(--font-mono);font-size:11px;text-align:right;color:var(--text-mid)">'
      +'$'+(294+impact).toFixed(0)+'M</td></tr>';
  }).join('');
  el.innerHTML='<table class="tbl"><thead><tr><th>Scenario</th><th class="num">NAV Impact</th><th class="num">New NAV</th></tr></thead><tbody>'+rows+'</tbody></table>';
}

// stubs for lazy loading
function initRiskScen(){scUpdate();}

// LP
function initLP(){
  const tb=document.querySelector('#tbl-lp tbody');tb.innerHTML='';
  LPS.forEach(l=>{const tt=l.type==='GP'?'t-or':l.type==='Pension'?'t-bl':l.type==='Government'?'t-pu':l.type==='DFI'?'t-tl':'t-go';tb.innerHTML+=`<tr><td class="name-cell">${l.name}</td><td><span class="t ${tt}">${l.type}</span></td><td class="num">$${l.commit}M</td><td class="num">$${l.called}M</td><td class="num">$${l.dist}M</td><td class="num">$${l.nav}M</td><td class="num ${l.irr>=13?'up':'neu'}">${l.irr}%</td><td class="num">${l.tvpi}Ã—</td></tr>`;});
}
function initLPCap(){
  const qls=['Q1 23','Q2 23','Q3 23','Q4 23','Q1 24','Q2 24','Q3 24','Q4 24','Q1 25'];
  mk('ch-l-calls',{type:'bar',data:{labels:qls,datasets:[{label:'Capital Called ($M)',data:[35,28,22,30,25,18,22,28,16],backgroundColor:C.or,borderRadius:4},{label:'Distributions ($M)',data:[0,0,0,2,3,4,5,8,15],backgroundColor:C.gr,borderRadius:4}]},options:{scales:{y:{title:{display:true,text:'$M',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  const ty={};LPS.forEach(l=>{ty[l.type]=(ty[l.type]||0)+l.commit;});
  mk('ch-l-type',{type:'doughnut',data:{labels:Object.keys(ty),datasets:[{data:Object.values(ty),backgroundColor:[C.go,C.bl,C.pu,C.tl,C.or],borderWidth:0}]},options:{cutout:'50%',plugins:{legend:{position:'right'}}}});
}
function initLPCF(){
  const fq=['Q2 25','Q3 25','Q4 25','Q1 26','Q2 26','Q3 26','Q4 26','Q1 27','Q2 27'];
  mk('ch-l-dpi-build',{type:'line',data:{labels:fq,datasets:[{label:'Base',data:[0,0.05,0.14,0.22,0.34,0.45,0.56,0.64,0.73],borderColor:C.or,backgroundColor:C.or+'11',fill:true,tension:.3,pointRadius:3},{label:'Bull',data:[0,0.09,0.22,0.34,0.50,0.65,0.80,0.92,1.05],borderColor:C.gr,borderDash:[5,3],tension:.3,pointRadius:2},{label:'Bear',data:[0,0,0.06,0.10,0.18,0.26,0.34,0.40,0.46],borderColor:C.re,borderDash:[3,3],tension:.3,pointRadius:2}]},options:{scales:{y:{title:{display:true,text:'DPI Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},min:0}}}});
  mk('ch-l-cf',{type:'bar',data:{labels:fq,datasets:[{label:'Capital Calls',data:[-18,-12,-10,-8,-5,-3,-2,0,0],backgroundColor:C.re+'88',borderRadius:4},{label:'Distributions',data:[0,15,35,28,65,55,48,35,42],backgroundColor:C.gr,borderRadius:4}]},options:{scales:{y:{title:{display:true,text:'$M',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
function initLPAttr(){
  mk('ch-l-bridge',{type:'bar',data:{labels:['Gross Return','Mgmt Fee','Carry','Expenses','Net Return'],datasets:[{data:[294,-17.6,0,-2.8,273.6],backgroundColor:[C.bl,C.re,C.re,C.re,C.gr],borderRadius:5}]},options:{plugins:{legend:{display:false}},scales:{y:{title:{display:true,text:'$M',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
// INVESTORS
function initInvestors(){
  const tb=document.querySelector('#tbl-lp-dir tbody');tb.innerHTML='';
  LP_DIR.forEach(function(l){
    var tt=l.type==='GP'?'t-or':l.type==='Pension'?'t-bl':l.type==='Gov'?'t-pu':l.type==='DFI'?'t-tl':'t-go';
    var f7c=l.f7==='Soft-circled'||l.f7==='Committed'?'t-gr':l.f7==='In discussion'||l.f7==='Considering'||l.f7==='Interested'?'t-or':'t-dim';
    var fundChips=l.funds.map(function(f){return '<span class="t t-dim">'+f+'</span>';}).join(' ');
    var reupBadge=l.reup?'<span class="t t-gr">âœ“</span>':'<span class="t t-dim">No</span>';
    tb.innerHTML+='<tr>'
      +'<td class="name-cell">'+l.name+'</td>'
      +'<td style="font-size:11px;color:var(--text-mid)">'+l.hq+'</td>'
      +'<td><span class="t '+tt+'">'+l.type+'</span></td>'
      +'<td class="num">â‚¬'+l.totalCommit+'M</td>'
      +'<td>'+fundChips+'</td>'
      +'<td>'+reupBadge+'</td>'
      +'<td><span class="t '+f7c+'">'+l.f7+'</span></td>'
      +'<td style="font-size:11px;color:var(--text-mid)">'+l.next+'</td>'
      +'</tr>';
  });
}
function initInvHist(){
  mk('ch-inv-reup',{type:'bar',data:{labels:['Iâ†’II','IIâ†’III','IIIâ†’IV','IVâ†’V','Vâ†’VI'],datasets:[{label:'Re-up Rate %',data:[90,88,86,89,87],backgroundColor:[C.gr,C.gr,C.or,C.gr,C.gr],borderRadius:5}]},options:{plugins:{legend:{display:false}},scales:{y:{min:70,max:100,title:{display:true,text:'Re-up %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  mk('ch-inv-ret',{type:'doughnut',data:{labels:['Always Re-up','Selective','Exited'],datasets:[{data:[62,25,13],backgroundColor:[C.gr,C.or,C.re],borderWidth:0}]},options:{cutout:'50%',plugins:{legend:{position:'right'}}}});
  const tbl=document.querySelector('#tbl-reup tbody');const fks=['I','II','III','IV','V','VI'];const key=LP_DIR.filter(l=>l.totalCommit>=25);
  tbl.innerHTML=key.map(function(l){
    var cells=fks.map(function(k){
      var inF=l.funds.includes(k);
      return '<td class="num">'+(inF?'<span class="t t-gr">âœ“</span>':'<span class="t t-dim">â€”</span>')+'</td>';
    }).join('');
    var f7cls=l.f7==='Soft-circled'||l.f7==='Committed'?'t-gr':l.f7==='In discussion'?'t-or':'t-dim';
    return '<tr><td class="name-cell">'+l.name+'</td>'+cells+'<td class="num"><span class="t '+f7cls+'">'+l.f7+'</span></td></tr>';
  }).join('');
}
function renderComms(){
  const tl=[{c:'gr',d:'Apr 3, 2025',t:'APG Amsterdam â€” confirmed â‚¬60M soft-circle for Fund VII. ESG requirements discussed.'},{c:'',d:'Mar 28, 2025',t:'Q1 LP letter distributed to all Fund VI LPs. IRR updated to 12.4%.'},{c:'bl',d:'Mar 15, 2025',t:'Schroder Adveq call â€” positive on Fund VII strategy. Requesting updated data room.'},{c:'',d:'Feb 22, 2025',t:'Neuberger Berman flagged AI concentration concern. Awaiting IC response memo.'},{c:'gr',d:'Jan 30, 2025',t:'EIF Luxembourg â€” re-up to Fund VII confirmed in principle.'}];
  const cal=[{c:'or',d:'Apr 18, 2025',t:'Isomer Capital LP advisory call â€” Q-CTRL concentration discussion.'},{c:'or',d:'Apr 25, 2025',t:'British Business Bank annual review â€” governance and ESG.'},{c:'bl',d:'May 8, 2025',t:'CPP Investments first meeting (New York) â€” Fund VII pitch.'},{c:'',d:'May 15, 2025',t:'Annual LP meeting (London) â€” all Fund VI LPs. Q1 performance.'},{c:'',d:'Jun 1, 2025',t:'NBIM (Norges Bank) introduction via Neuberger Berman.'}];
  const tele=document.getElementById('lp-timeline');const cale=document.getElementById('lp-calendar');
  if(tele)tele.innerHTML=tl.map(t=>`<div class="tl-item ${t.c}"><div class="tl-date">${t.d}</div><div class="tl-text">${t.t}</div></div>`).join('');
  if(cale)cale.innerHTML=cal.map(t=>`<div class="tl-item ${t.c}"><div class="tl-date">${t.d}</div><div class="tl-text">${t.t}</div></div>`).join('');
}
// REPORTS
var RP_SECTIONS=[
  {id:'open',  title:'Opening Salutation',   on:true,  locked:true, content:'Dear Limited Partner,\n\nWe are pleased to present the Fund VI Q1 2025 quarterly report. This letter covers fund performance, portfolio developments, risk monitoring, and our outlook for the remainder of 2025.'},
  {id:'mkt',   title:'Market Commentary',    on:true,  locked:false, content:'Global technology markets continued to recover in Q1 2025, with the S&P 500 advancing 8.2% year-to-date. Enterprise AI infrastructure investment remains a key driver, with hyperscaler capex up 34% YoY. VC funding recovered to $58B globally (+22% QoQ), and the IPO window is opening for high-quality SaaS businesses with $50M+ ARR. Rate cuts expected H2 2025 should expand software multiples from current 10â€“14Ã— EV/ARR levels.'},
  {id:'perf',  title:'Fund Performance',     on:true,  locked:false, content:'Fund VI NAV increased to $294M as of March 31, 2025, representing a 12.4% net IRR â€” up 2.2pp from Q4 2024. TVPI stands at 1.40Ã—, with DPI at 0.00Ã— (first distributions expected Q3 2026). 68% of committed capital has been deployed across 10 portfolio companies. Q-CTRL (27.9% of NAV) and d-Matrix (12.9%) were the primary contributors to Q1 value creation.'},
  {id:'port',  title:'Portfolio Updates',     on:true,  locked:false, content:'Matillion: S-1 preparation initiated with Goldman Sachs and Morgan Stanley. IPO targeting H2 2025 window. ARR at $62M (+40% YoY), gross margin 70%.\n\nLedger: Engaged Thoma Bravo for M&A discussions. ARR at $85M, profitable at operating level. Process expected to conclude Q2 2026.\n\nd-Matrix: Series C process commenced with JP Morgan. $5M ARR growing 200% YoY. Current runway 14 months.\n\nQ-CTRL: Raised $25M Series B+ at $340M post-money. NRR at 145%. Concentration remediation plan in progress.'},
  {id:'dist',  title:'Distribution Outlook', on:true,  locked:false, content:'We project the following exit events over the next 24 months:\nâ€¢ Q-CTRL secondary sale: $15â€“20M proceeds (Q3 2025, medium confidence)\nâ€¢ Matillion IPO: $28â€“42M distributions (Q4 2025, medium confidence)\nâ€¢ Quantexa strategic: $38â€“56M proceeds (Q1 2026, medium confidence)\nâ€¢ Ledger M&A / IPO: $45â€“65M distributions (Q2 2026, high confidence)\n\nCumulative projected DPI by end 2026: 0.28â€“0.42Ã— (base case).'},
  {id:'risk',  title:'Risk & Monitoring',    on:true,  locked:false, content:'Q-CTRL Concentration (HIGH): 27.9% of NAV exceeds IC 25% limit. Co-investment syndication of $15â€“20M targeted Q2 2025.\n\nd-Matrix Runway (MEDIUM): 14-month runway requires Series C close by Q3 2025. Bankers engaged.\n\nSanity Growth (MEDIUM): ARR growth decelerated from 46% to 38%. Board-level GTM review initiated.\n\nHeadway NRR (HIGH): NRR at 95%, below 100% threshold. Full churn audit commissioned; results Q2 2025.'},
  {id:'esg',   title:'ESG & Impact',         on:false, locked:false, content:'Portfolio impact metrics (Q1 2025):\nâ€¢ Jobs created: 4,820 (+22% YoY)\nâ€¢ Carbon neutral: 7 of 8 portfolio companies\nâ€¢ Board gender diversity: 31% (vs. 24% European VC benchmark)\nâ€¢ Education impact: Multiverse apprenticeships serving 14,000 learners\nâ€¢ Financial inclusion: Wayflyer supported 1,200 SME borrowers\n\nGP Bullhound Capital is a signatory to the UN PRI. Full ESG report available on the LP portal.'},
  {id:'cflow', title:'Capital Account',      on:true,  locked:false, content:'[LP-SPECIFIC: Capital called, NAV, IRR, TVPI and unfunded commitment will be inserted per recipient before distribution.]'},
  {id:'f7',    title:'Fund VII Preview',     on:false, locked:false, content:'We are beginning early conversations around Fund VII, targeting â‚¬600M. The fund will continue our strategy of backing European and Israeli deep-tech and AI-native businesses at Series Bâ€“C. We anticipate a formal launch in H2 2026, with a first close targeted Q1 2027. We will reach out individually to discuss continuation terms.'},
  {id:'close', title:'Closing & Signature',  on:true,  locked:true,  content:'Yours sincerely,\n\nThe GP Bullhound Capital Investment Team\nLondon Â· Stockholm Â· San Francisco\nir@gpbullhound.com\n\nThis document is confidential. Past performance is not indicative of future results.'},
];
var RP_LP='Schroder Adveq';
var RP_FUND='VI';

function initReports(){
  var lpOpts=['All LPs','Schroder Adveq','APG Asset Mgmt','Neuberger Berman','British Business Bank','EIF','Adams Street Partners','Isomer Capital'];
  var sel=function(id,opts,val,fn){
    return '<select id="'+id+'" onchange="'+fn+'" style="background:var(--s2);border:1px solid var(--border2);color:var(--text);padding:6px 10px;border-radius:5px;font-family:var(--font-mono);font-size:11px;width:100%">'
      +opts.map(function(o){return'<option'+(o===val?' selected':'')+'>'+o+'</option>';}).join('')+'</select>';
  };
  document.getElementById('report-config').innerHTML=
    '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">'
    +'<div><div class="kpi-label" style="margin-bottom:5px">Fund</div>'
    +sel('rp-fund',['Fund VI â€” Q1 2025','Fund V â€” Q1 2025'],'Fund VI â€” Q1 2025','rpSetFund(this.value)')+'</div>'
    +'<div><div class="kpi-label" style="margin-bottom:5px">Recipient</div>'
    +sel('rp-lp',lpOpts,'Schroder Adveq','rpSetLP(this.value)')+'</div>'
    +'<div><div class="kpi-label" style="margin-bottom:5px">Quarter</div>'
    +sel('rp-qtr',['Q1 2025','Q4 2024','Q3 2024'],'Q1 2025','updateRpPreview()')+'</div>'
    +'<div><div class="kpi-label" style="margin-bottom:5px">Tone</div>'
    +sel('rp-tone',['Standard','Detailed','Concise'],'Standard','updateRpPreview()')+'</div>'
    +'</div>'
    +'<div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);padding:8px;background:var(--s2);border-radius:5px;border:1px solid var(--border)">'
    +'Auto-populated from live dashboard data Â· Last updated: April 14, 2025 Â· Editable before export</div>';

  renderRpSections();
  updateRpPreview();
}

function rpSetFund(v){RP_FUND=v.replace('Fund ','').split(' ')[0];updateRpPreview();}
function rpSetLP(v){RP_LP=v;updateRpPreview();}

function renderRpSections(){
  document.getElementById('report-sections').innerHTML=RP_SECTIONS.map(function(s,i){
    return '<div id="rps-'+s.id+'" style="background:var(--s2);border:1px solid var(--border);border-radius:8px;padding:13px;margin-bottom:10px;transition:border-color .2s" '
      +'onmouseenter="this.style.borderColor=\'var(--border2)\'" onmouseleave="this.style.borderColor=\'var(--border)\'">'
      +'<div style="display:flex;align-items:center;gap:9px;margin-bottom:9px">'
      +(s.locked?'<div style="width:28px;height:16px;background:var(--border2);border-radius:8px;display:flex;align-items:center;justify-content:center"><span style="font-size:11px">ðŸ”’</span></div>'
               :'<div class="toggle'+(s.on?' on':'')+'" onclick="rpToggle(\''+s.id+'\',this)"></div>')
      +'<span style="font-family:var(--font-mono);font-size:11px;font-weight:600;color:var(--text);text-transform:uppercase;letter-spacing:1px">'+s.title+'</span>'
      +(s.locked?'<span class="t t-dim" style="margin-left:auto">Always included</span>':'')
      +'</div>'
      +'<textarea id="rp-ta-'+s.id+'" onkeyup="updateRpPreview()" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:5px;color:var(--text-mid);font-family:var(--font-mono);font-size:10.5px;line-height:1.6;padding:9px;resize:vertical;min-height:80px;box-sizing:border-box">'
      +s.content+'</textarea>'
      +'</div>';
  }).join('');
}

function rpToggle(id,el){
  var s=RP_SECTIONS.find(function(x){return x.id===id;});
  if(!s||s.locked)return;
  s.on=!s.on;
  el.classList.toggle('on',s.on);
  updateRpPreview();
}

function updateRpPreview(){
  var lp=RP_LP==='All LPs'?'Limited Partner':RP_LP;
  var lpData={
    'Schroder Adveq':{commit:65,called:44.2,nav:52.0,irr:14.1,tvpi:1.38},
    'APG Asset Mgmt':{commit:50,called:34.0,nav:41.0,irr:13.8,tvpi:1.39},
    'Neuberger Berman':{commit:45,called:30.6,nav:36.0,irr:13.5,tvpi:1.35},
    'British Business Bank':{commit:40,called:27.2,nav:32.0,irr:12.9,tvpi:1.35},
    'EIF':{commit:35,called:23.8,nav:27.0,irr:13.2,tvpi:1.30},
    'Adams Street Partners':{commit:30,called:20.4,nav:24.0,irr:12.8,tvpi:1.33},
    'Isomer Capital':{commit:25,called:17.0,nav:19.5,irr:12.6,tvpi:1.29},
    'All LPs':{commit:431,called:294,nav:294,irr:12.4,tvpi:1.40}
  };
  var d=lpData[RP_LP]||lpData['All LPs'];
  var calledPct=Math.round(d.called/d.commit*100);

  var body='<div class="rp-heading">GP Bullhound Capital â€” Fund '+RP_FUND+' Quarterly Letter Q1 2025</div>'
    +'<div style="font-size:11px;color:var(--text-dim);margin-bottom:10px">CONFIDENTIAL Â· Prepared for: '+lp+' Â· April 14, 2025</div>'
    +'<div class="rp-kpis">'
    +'<div class="rp-kpi"><div class="rp-kpi-label">Net IRR</div><div class="rp-kpi-val" style="color:var(--green)">'+d.irr+'%</div></div>'
    +'<div class="rp-kpi"><div class="rp-kpi-label">TVPI</div><div class="rp-kpi-val">'+d.tvpi+'Ã—</div></div>'
    +'<div class="rp-kpi"><div class="rp-kpi-label">Your NAV</div><div class="rp-kpi-val">$'+d.nav+'M</div></div>'
    +'<div class="rp-kpi"><div class="rp-kpi-label">Called</div><div class="rp-kpi-val">'+calledPct+'%</div></div>'
    +'<div class="rp-kpi"><div class="rp-kpi-label">DPI</div><div class="rp-kpi-val">0.00Ã—</div></div>'
    +'</div>';

  RP_SECTIONS.forEach(function(s){
    if(!s.on&&!s.locked)return;
    var ta=document.getElementById('rp-ta-'+s.id);
    var txt=ta?ta.value:s.content;
    // Personalise capital account section
    if(s.id==='cflow'){
      txt='Your Commitment: $'+d.commit+'M  Â·  Capital Called: $'+d.called+'M ('+calledPct+'%)\nCurrent NAV: $'+d.nav+'M  Â·  Net IRR: '+d.irr+'%  Â·  TVPI: '+d.tvpi+'Ã—\nRemaining unfunded: $'+(d.commit-d.called).toFixed(1)+'M';
    }
    body+='<div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--border)">'
      +'<div style="font-family:var(--font-mono);font-size:11px;font-weight:700;color:var(--orange);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:6px">'+s.title+'</div>'
      +'<div style="font-size:10.5px;color:var(--text-mid);line-height:1.7;white-space:pre-line">'+txt+'</div>'
      +'</div>';
  });

  var onCount=RP_SECTIONS.filter(function(s){return s.on||s.locked;}).length;
  body+='<div style="margin-top:14px;padding-top:9px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">'
    +'<span style="font-size:11px;color:var(--text-dim)">'+onCount+' of '+RP_SECTIONS.length+' sections included</span>'
    +'<div style="display:flex;gap:10px">'
    +'<span style="font-family:var(--font-mono);font-size:11px;color:var(--blue);cursor:pointer" onclick="window.print()">â¬‡ Print / Export PDF</span>'
    +'</div></div>';

  document.getElementById('report-preview').innerHTML=body;
}
// RESEARCH
function initResearch(){initResComps();}
function initResComps(){
  const comps=[{n:'Datadog',ev:18.2,gr:26},{n:'MongoDB',ev:14.5,gr:22},{n:'Cloudflare',ev:21.3,gr:30},{n:'HubSpot',ev:12.8,gr:20},{n:'Elastic',ev:8.2,gr:18},{n:'GitLab',ev:10.5,gr:28},{n:'IonQ',ev:38.0,gr:118},{n:'Rigetti',ev:28.0,gr:95}];
  mk('ch-re-comps',{type:'scatter',data:{datasets:comps.map((c,i)=>({label:c.n,data:[{x:c.gr,y:c.ev}],backgroundColor:[C.or,C.bl,C.pu,C.tl,C.go,C.gr,C.re,C.orl][i],pointRadius:11,pointHoverRadius:14}))},options:{scales:{x:{title:{display:true,text:'Revenue Growth %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}},y:{title:{display:true,text:'EV/Revenue Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}},plugins:{tooltip:{callbacks:{title:i=>[i[0].dataset.label],label:i=>`EV/Rev: ${i.parsed.y}Ã—  Gr: ${i.parsed.x}%`}}}}});
}
function initResMA(){
  mk('ch-ma-mult',{type:'bar',data:{labels:['AI/ML','Data Analytics','FinTech AI','Payments','Quantum','Vertical SaaS'],datasets:[{label:'Strategic',data:[22,14,11,8,28,12],backgroundColor:C.or,borderRadius:4},{label:'Financial',data:[16,11,8,6,18,9],backgroundColor:C.bl,borderRadius:4}]},options:{scales:{y:{title:{display:true,text:'EV/ARR Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
  mk('ch-ma-prem',{type:'bar',data:{labels:['2022','2023','2024','2025E'],datasets:[{label:'Strategic Premium vs Financial %',data:[42,28,35,38],backgroundColor:[C.re,C.or,C.go,C.gr],borderRadius:5}]},options:{plugins:{legend:{display:false}},scales:{y:{title:{display:true,text:'Premium %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
function initResMacro(){
  mk('ch-macro-rates',{type:'line',data:{labels:['Q1 21','Q2 21','Q4 21','Q2 22','Q4 22','Q2 23','Q4 23','Q2 24','Q4 24','Q1 25'],datasets:[{label:'Fed Rate %',data:[0.1,0.1,0.1,1.5,4.3,5.1,5.3,5.3,4.6,5.25],borderColor:C.re,tension:.3,pointRadius:2,borderWidth:2,yAxisID:'y'},{label:'SaaS EV/Rev Ã—',data:[20,22,26,16,10,9.5,10.5,12,13,13.5],borderColor:C.or,tension:.3,pointRadius:2,borderWidth:2,yAxisID:'y1'}]},options:{scales:{y:{position:'left',title:{display:true,text:'Rate %',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}},y1:{position:'right',title:{display:true,text:'EV/Rev Ã—',color:'#7A776F',font:{family:'JetBrains Mono',size:10}},grid:{display:false}}}}});
  mk('ch-macro-vc',{type:'bar',data:{labels:['Q1 23','Q2 23','Q3 23','Q4 23','Q1 24','Q2 24','Q3 24','Q4 24','Q1 25'],datasets:[{label:'Global VC ($B)',data:[41,39,43,46,48,50,52,55,58],backgroundColor:qls=>[C.bl+'88',C.bl+'88',C.bl+'88',C.bl+'88',C.bl+'88',C.bl+'88',C.bl+'88',C.bl+'88',C.or][qls.dataIndex]||C.bl+'88',borderRadius:4}]},options:{plugins:{legend:{display:false}},scales:{y:{title:{display:true,text:'$B',color:'#7A776F',font:{family:'JetBrains Mono',size:10}}}}}});
}
function renderCompMaps(){
  [{id:'comp-qctrl',tiers:{Leaders:['IonQ','Rigetti','Quantinuum'],Peers:['Q-CTRL â˜…','D-Wave'],Challengers:['PsiQuantum','Oxford QC']}},
   {id:'comp-dmatrix',tiers:{Leaders:['NVIDIA','AMD','Intel'],Peers:['d-Matrix â˜…','Cerebras','Groq'],Challengers:['Tenstorrent','SambaNova']}},
   {id:'comp-matillion',tiers:{Leaders:['Informatica','Talend'],Peers:['Matillion â˜…','Fivetran'],Challengers:['Rivery','Census','Stitch']}},
   {id:'comp-ledger',tiers:{Leaders:['Coinbase Custody','BitGo'],Peers:['Ledger â˜…','Anchorage'],Challengers:['Fireblocks','Copper','Hex Trust']}}
  ].forEach(function(m){
    var el=document.getElementById(m.id);if(!el)return;
    el.innerHTML=Object.entries(m.tiers).map(function(entry){
      var tier=entry[0],cos=entry[1];
      var chips=cos.map(function(c){
        return '<span class="t '+(c.includes('â˜…')?'t-or':'t-dim')+'">'+c+'</span>';
      }).join('');
      return '<div style="margin-bottom:10px">'
        +'<div style="font-family:var(--font-mono);font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim);margin-bottom:5px">'+tier+'</div>'
        +'<div style="display:flex;flex-wrap:wrap;gap:5px">'+chips+'</div></div>';
    }).join('');
  });
}
// MODAL
function openModal(name){
  const c=CO.find(x=>x.name===name);if(!c)return;
  document.getElementById('modal-title').innerHTML=`${c.name} <span class="t t-dim" style="font-size:11px;margin-left:5px">${c.sector}</span>`;
  const nrr=c.nrr?c.nrr+'%':'N/A';
  document.getElementById('modal-body').innerHTML=`<div class="stat-grid"><div class="stat-item"><div class="stat-label">ARR</div><div class="stat-val">$${c.arr}M</div></div><div class="stat-item"><div class="stat-label">ARR Growth</div><div class="stat-val ${c.arrGr>=80?'up':c.arrGr>=35?'neu':'dn'}">${c.arrGr}%</div></div><div class="stat-item"><div class="stat-label">EV/ARR</div><div class="stat-val">${c.evArr}Ã—</div></div><div class="stat-item"><div class="stat-label">MOIC</div><div class="stat-val">${c.moic}Ã—</div></div><div class="stat-item"><div class="stat-label">Burn Mult</div><div class="stat-val ${c.burn<=1.2?'up':c.burn<=1.8?'neu':'dn'}">${c.burn}Ã—</div></div><div class="stat-item"><div class="stat-label">Gross Margin</div><div class="stat-val">${c.gm}%</div></div><div class="stat-item"><div class="stat-label">NRR</div><div class="stat-val ${c.nrr&&c.nrr>=120?'up':c.nrr&&c.nrr<100?'dn':'neu'}">${nrr}</div></div><div class="stat-item"><div class="stat-label">NAV</div><div class="stat-val">$${c.nav}M</div></div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:13px;margin-top:13px"><div><div class="kpi-label" style="margin-bottom:7px">Investment Details</div><table class="tbl"><tr><td style="color:var(--text-mid);font-size:11px">Fund(s)</td><td class="num">${c.funds.join(', ')}</td></tr><tr><td style="color:var(--text-mid);font-size:11px">Stage</td><td class="num">${c.stage}</td></tr><tr><td style="color:var(--text-mid);font-size:11px">Geography</td><td class="num">${c.geo}</td></tr><tr><td style="color:var(--text-mid);font-size:11px">Valuation</td><td class="num">$${c.valuation}M</td></tr><tr><td style="color:var(--text-mid);font-size:11px">Status</td><td class="num"><span class="t ${stC(c.status)}">${c.status}</span></td></tr></table></div><div><div class="kpi-label" style="margin-bottom:7px">ESG Scores</div>'+[['Environment',c.esgE,C.gr],['Social',c.esgS,C.bl],['Governance',c.esgG,C.pu]].map(function(row){
        var l=row[0],v=row[1],col=row[2];
        return '<div style="margin-bottom:8px">'
          +'<div style="display:flex;justify-content:space-between;margin-bottom:3px">'
          +'<span style="font-family:var(--font-mono);font-size:11px;color:var(--text-mid)">'+l+'</span>'
          +'<span style="font-family:var(--font-mono);font-size:11px;color:'+col+'">'+v+'</span></div>'
          +'<div class="score-bar"><div class="score-fill" style="width:'+v+'%;background:'+col+'"></div></div></div>';
      }).join('')+'
</div></div><div style="margin-top:14px;background:var(--s2);border:1px solid var(--border);border-radius:8px;padding:13px"><div class="kpi-label" style="margin-bottom:7px">Investment Thesis</div><div style="font-size:12px;color:var(--text-mid);line-height:1.6">${c.lever}</div></div>`;
  document.getElementById('co-modal').classList.add('on');
}
function closeModal(){document.getElementById('co-modal').classList.remove('on');}
document.getElementById('co-modal').addEventListener('click',function(e){if(e.target===this)closeModal();});
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal();});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// == PERSISTENCE ENGINE â€” localStorage auto-save / restore ================
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var PERSIST_KEY='gpb_state_v1';
var SCENARIO_KEY='gpb_scenarios_v1';
var NOTES_KEY='gpb_notes_v1';

// Save all interactive state to localStorage
function saveState(){
  try{
    var state={
      ts:Date.now(),
      // Risk scenario sliders
      risk:{
        arrGr:getSliderVal('sl-arr-gr'),gm:getSliderVal('sl-gm'),nrr:getSliderVal('sl-nrr'),
        evMult:getSliderVal('sl-evmult'),dr:getSliderVal('sl-dr'),timing:getSliderVal('sl-timing'),
        rates:getSliderVal('sl-rates'),fx:getSliderVal('sl-fx'),wo:getSliderVal('sl-wo'),
        probW:JSON.parse(JSON.stringify(PROB_W)),
        macro:{fed:getSliderVal('ms-fed'),yr10:getSliderVal('ms-10yr'),gdp:getSliderVal('ms-gdp'),
               cpi:getSliderVal('ms-cpi'),it:getSliderVal('ms-it'),saas:getSliderVal('ms-saas'),
               vc:getSliderVal('ms-vc'),ipo:IPO_STATUS},
        fx2:{gbp:getSliderVal('fx-gbp'),eur:getSliderVal('fx-eur'),aud:getSliderVal('fx-aud'),
             ils:getSliderVal('fx-ils'),hgbp:getSliderVal('fx-hgbp'),heur:getSliderVal('fx-heur')}
      },
      // Exit scenario sliders
      exits:{
        bear:getSliderVal('ex-bear'),base:getSliderVal('ex-base'),bull:getSliderVal('ex-bull'),
        pbear:EXIT_PROBS.bear,pbase:EXIT_PROBS.base,pbull:EXIT_PROBS.bull,
        yr:getSliderVal('ex-yr'),dil:getSliderVal('ex-dil'),aiPrem:getSliderVal('ex-ai-prem')
      },
      // Report builder
      report:{
        lp:RP_LP,fund:RP_FUND,
        sections:RP_SECTIONS.map(function(s){
          var ta=document.getElementById('rp-ta-'+s.id);
          return {id:s.id,on:s.on,content:ta?ta.value:s.content};
        })
      },
      // Data source
      sheetUrl:document.getElementById('sheet-url-input')?document.getElementById('sheet-url-input').value:''
    };
    localStorage.setItem(PERSIST_KEY,JSON.stringify(state));
    showPersistBadge('Saved');
  }catch(e){console.warn('Save failed',e);}
}

function loadState(){
  try{
    var raw=localStorage.getItem(PERSIST_KEY);
    if(!raw)return;
    var state=JSON.parse(raw);

    // Restore risk sliders (deferred â€” page may not be rendered yet)
    window._savedRisk=state.risk;
    window._savedExits=state.exits;
    window._savedReport=state.report;
    window._savedSheetUrl=state.sheetUrl||'';

    var d=new Date(state.ts);
    var badge=document.getElementById('persist-badge');
    if(badge)badge.textContent='Restored: '+d.toLocaleDateString()+' '+d.toLocaleTimeString(undefined,{hour:'2-digit',minute:'2-digit'});
  }catch(e){console.warn('Load failed',e);}
}

function restorePageState(page){
  if(page==='risk'&&window._savedRisk){
    var r=window._savedRisk;
    var sliders=[['sl-arr-gr',r.arrGr],['sl-gm',r.gm],['sl-nrr',r.nrr],['sl-evmult',r.evMult],
                 ['sl-dr',r.dr],['sl-timing',r.timing],['sl-rates',r.rates],['sl-fx',r.fx],['sl-wo',r.wo]];
    sliders.forEach(function(s){var el=document.getElementById(s[0]);if(el)el.value=s[1];});
    if(r.probW)Object.assign(PROB_W,r.probW);
    if(r.macro){
      var ms=[['ms-fed',r.macro.fed],['ms-10yr',r.macro.yr10],['ms-gdp',r.macro.gdp],
              ['ms-cpi',r.macro.cpi],['ms-it',r.macro.it],['ms-saas',r.macro.saas],['ms-vc',r.macro.vc]];
      ms.forEach(function(s){var el=document.getElementById(s[0]);if(el&&s[1]!==undefined)el.value=s[1];});
      if(r.macro.ipo)IPO_STATUS=r.macro.ipo;
    }
    if(r.fx2){
      var fx=[['fx-gbp',r.fx2.gbp],['fx-eur',r.fx2.eur],['fx-aud',r.fx2.aud],['fx-ils',r.fx2.ils],
              ['fx-hgbp',r.fx2.hgbp],['fx-heur',r.fx2.heur]];
      fx.forEach(function(s){var el=document.getElementById(s[0]);if(el&&s[1]!==undefined)el.value=s[1];});
    }
    scUpdate();
  }
  if(page==='exits'&&window._savedExits){
    var ex=window._savedExits;
    var exs=[['ex-bear',ex.bear],['ex-base',ex.base],['ex-bull',ex.bull],
             ['ex-yr',ex.yr],['ex-dil',ex.dil],['ex-ai-prem',ex.aiPrem]];
    exs.forEach(function(s){var el=document.getElementById(s[0]);if(el&&s[1]!==undefined)el.value=s[1];});
    if(ex.pbear!==undefined){EXIT_PROBS.bear=ex.pbear;EXIT_PROBS.base=ex.pbase;EXIT_PROBS.bull=ex.pbull;}
    var pb=[['ex-pbear',EXIT_PROBS.bear],['ex-pbase',EXIT_PROBS.base],['ex-pbull',EXIT_PROBS.bull]];
    pb.forEach(function(s){var el=document.getElementById(s[0]);if(el)el.value=s[1];});
    exitUpdate();
  }
  if(page==='reports'&&window._savedReport){
    var rp=window._savedReport;
    if(rp.lp)RP_LP=rp.lp;
    if(rp.fund)RP_FUND=rp.fund;
    if(rp.sections){
      rp.sections.forEach(function(saved){
        var s=RP_SECTIONS.find(function(x){return x.id===saved.id;});
        if(s){s.on=saved.on;s.content=saved.content;}
      });
    }
  }
}

// Named scenario save/load
function saveNamedScenario(){
  var name=prompt('Save this scenario as:','Q1 2025 Base');
  if(!name)return;
  try{
    var scenarios=JSON.parse(localStorage.getItem(SCENARIO_KEY)||'[]');
    var scen={
      name:name,ts:Date.now(),
      risk:{arrGr:getSliderVal('sl-arr-gr'),gm:getSliderVal('sl-gm'),nrr:getSliderVal('sl-nrr'),
            evMult:getSliderVal('sl-evmult'),dr:getSliderVal('sl-dr'),timing:getSliderVal('sl-timing'),
            rates:getSliderVal('sl-rates'),fx:getSliderVal('sl-fx'),wo:getSliderVal('sl-wo'),probW:JSON.parse(JSON.stringify(PROB_W))},
      exits:{bear:getSliderVal('ex-bear'),base:getSliderVal('ex-base'),bull:getSliderVal('ex-bull'),
             pbear:EXIT_PROBS.bear,pbase:EXIT_PROBS.base,pbull:EXIT_PROBS.bull,
             yr:getSliderVal('ex-yr'),dil:getSliderVal('ex-dil'),aiPrem:getSliderVal('ex-ai-prem')}
    };
    // Replace existing with same name
    scenarios=scenarios.filter(function(s){return s.name!==name;});
    scenarios.unshift(scen);
    if(scenarios.length>10)scenarios=scenarios.slice(0,10);
    localStorage.setItem(SCENARIO_KEY,JSON.stringify(scenarios));
    renderSavedScenarios();
    showPersistBadge('Scenario saved: '+name);
  }catch(e){console.warn('Scenario save failed',e);}
}

function loadNamedScenario(name){
  try{
    var scenarios=JSON.parse(localStorage.getItem(SCENARIO_KEY)||'[]');
    var scen=scenarios.find(function(s){return s.name===name;});
    if(!scen)return;
    window._savedRisk=scen.risk;
    window._savedExits=scen.exits;
    restorePageState('risk');
    restorePageState('exits');
    showPersistBadge('Loaded: '+name);
  }catch(e){console.warn('Load scenario failed',e);}
}

function deleteNamedScenario(name){
  try{
    var scenarios=JSON.parse(localStorage.getItem(SCENARIO_KEY)||'[]');
    scenarios=scenarios.filter(function(s){return s.name!==name;});
    localStorage.setItem(SCENARIO_KEY,JSON.stringify(scenarios));
    renderSavedScenarios();
  }catch(e){}
}

function renderSavedScenarios(){
  var el=document.getElementById('saved-scenarios-list');
  if(!el)return;
  try{
    var scenarios=JSON.parse(localStorage.getItem(SCENARIO_KEY)||'[]');
    if(scenarios.length===0){el.innerHTML='<div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);padding:8px 0">No saved scenarios yet.</div>';return;}
    el.innerHTML=scenarios.map(function(s){
      var d=new Date(s.ts);
      return '<div style="display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border)">'
        +'<div><div style="font-family:var(--font-mono);font-size:11px;color:var(--text);cursor:pointer" onclick="loadNamedScenario(\''+s.name.replace(/'/g,"\\'")+'\')">'
        +s.name+'</div>'
        +'<div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim)">'+d.toLocaleDateString()+' '+d.toLocaleTimeString(undefined,{hour:'2-digit',minute:'2-digit'})+'</div></div>'
        +'<div style="display:flex;gap:8px">'
        +'<span style="font-family:var(--font-mono);font-size:11px;color:var(--blue);cursor:pointer" onclick="loadNamedScenario(\''+s.name.replace(/'/g,"\\'")+'\')")>Load</span>'
        +'<span style="font-family:var(--font-mono);font-size:11px;color:var(--red);cursor:pointer" onclick="deleteNamedScenario(\''+s.name.replace(/'/g,"\\'")+'\')")>Ã—</span>'
        +'</div></div>';
    }).join('');
  }catch(e){}
}

// Company notes
function saveNote(company,text){
  try{
    var notes=JSON.parse(localStorage.getItem(NOTES_KEY)||'{}');
    notes[company]={text:text,ts:Date.now()};
    localStorage.setItem(NOTES_KEY,JSON.stringify(notes));
  }catch(e){}
}
function getNote(company){
  try{
    var notes=JSON.parse(localStorage.getItem(NOTES_KEY)||'{}');
    return notes[company]||null;
  }catch(e){return null;}
}

function showPersistBadge(msg){
  var b=document.getElementById('persist-badge');
  if(!b)return;
  b.textContent=msg;
  b.style.color='var(--green)';
  b.style.opacity='1';
  setTimeout(function(){b.style.opacity='0.5';b.style.color='var(--text-dim)';},2500);
}

// Auto-save every 15 seconds and on slider changes
setInterval(saveState,15000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// == GOOGLE SHEETS LIVE DATA FEED =========================================
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var SHEET_LOADING=false;
var SHEET_LAST_UPDATED=null;
var SHEET_URL_DEFAULT=''; // Partner pastes their sheet's CSV export URL here

function parseSheetCSV(csv){
  var lines=csv.trim().split('\n');
  var headers=lines[0].split(',').map(function(h){return h.trim().replace(/"/g,'');});
  return lines.slice(1).map(function(line){
    var vals=line.split(',').map(function(v){return v.trim().replace(/"/g,'');});
    var obj={};
    headers.forEach(function(h,i){obj[h]=vals[i]||'';});
    return obj;
  });
}

function applySheetData(rows){
  var updated=0;
  rows.forEach(function(row){
    if(!row.name)return;
    var co=CO.find(function(c){return c.name.toLowerCase()===row.name.toLowerCase();});
    if(!co)return;
    if(row.arr&&!isNaN(+row.arr))co.arr=+row.arr;
    if(row.arr_gr&&!isNaN(+row.arr_gr))co.arrGr=+row.arr_gr;
    if(row.arr_growth&&!isNaN(+row.arr_growth))co.arrGr=+row.arr_growth;
    if(row.nav&&!isNaN(+row.nav))co.nav=+row.nav;
    if(row.moic&&!isNaN(+row.moic))co.moic=+row.moic;
    if(row.burn&&!isNaN(+row.burn))co.burn=+row.burn;
    if(row.gm&&!isNaN(+row.gm))co.gm=+row.gm;
    if(row.nrr&&!isNaN(+row.nrr))co.nrr=+row.nrr;
    if(row.ev_arr&&!isNaN(+row.ev_arr))co.evArr=+row.ev_arr;
    if(row.status)co.status=row.status;
    updated++;
  });
  return updated;
}

function fetchSheetData(url,onDone){
  if(!url||SHEET_LOADING)return;
  SHEET_LOADING=true;
  setDataFeedStatus('loading');
  // Convert standard Google Sheets share URL â†’ CSV export URL
  var csvUrl=url;
  if(url.includes('docs.google.com/spreadsheets')){
    var sheetId=url.match(/\/d\/([a-zA-Z0-9_-]+)/);
    if(sheetId){
      var gid=url.match(/gid=([0-9]+)/);
      csvUrl='https://docs.google.com/spreadsheets/d/'+sheetId[1]+'/export?format=csv'+(gid?'&gid='+gid[1]:'');
    }
  }
  fetch(csvUrl)
    .then(function(r){if(!r.ok)throw new Error('HTTP '+r.status);return r.text();})
    .then(function(csv){
      var rows=parseSheetCSV(csv);
      var count=applySheetData(rows);
      SHEET_LAST_UPDATED=new Date();
      SHEET_LOADING=false;
      setDataFeedStatus('ok',count+' fields updated Â· '+SHEET_LAST_UPDATED.toLocaleTimeString());
      // Refresh current page
      var active=document.querySelector('.pg.on');
      if(active)initPage(active.id.replace('pg-',''));
      if(onDone)onDone(count);
    })
    .catch(function(err){
      SHEET_LOADING=false;
      setDataFeedStatus('error',err.message);
      console.warn('Sheet fetch failed:',err);
    });
}

function setDataFeedStatus(state,msg){
  var el=document.getElementById('data-feed-status');
  if(!el)return;
  var colors={loading:'var(--orange)',ok:'var(--green)',error:'var(--red)',idle:'var(--text-dim)'};
  var icons={loading:'âŸ³ ',ok:'âœ“ ',error:'âœ— ',idle:'â—‹ '};
  el.textContent=icons[state]+(msg||state);
  el.style.color=colors[state]||colors.idle;
}

function initDataFeedPanel(){
  var el=document.getElementById('data-feed-url');if(!el)return;
  el.innerHTML='<div class="ctrl-panel">'
    +'<div class="ctrl-section">Google Sheets Data Feed</div>'
    +'<div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);margin-bottom:10px;line-height:1.5">'
    +'Paste your Google Sheet URL below. The sheet must be published to the web (File â†’ Share â†’ Publish to web â†’ CSV). '
    +'Column headers: <b>name, arr, arr_gr, nav, moic, burn, gm, nrr, ev_arr, status</b>'
    +'</div>'
    +'<div style="display:flex;gap:8px;margin-bottom:10px">'
    +'<input id="sheet-url-input" type="text" placeholder="https://docs.google.com/spreadsheets/d/..." '
    +'style="flex:1;background:var(--s2);border:1px solid var(--border2);color:var(--text);font-family:var(--font-mono);font-size:11px;padding:7px 10px;border-radius:5px" '
    +'value="'+(window._savedSheetUrl||'')+'">'
    +'<button onclick="triggerSheetFetch()" style="background:var(--orange);border:none;color:white;font-family:var(--font-mono);font-size:11px;padding:7px 14px;border-radius:5px;cursor:pointer">Connect</button>'
    +'</div>'
    +'<div style="display:flex;justify-content:space-between;align-items:center">'
    +'<span id="data-feed-status" style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim)">â—‹ Not connected</span>'
    +'<span style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim)">Auto-refresh: every 5 min</span>'
    +'</div>'
    +'<div class="ctrl-section" style="margin-top:14px">Sheet Template</div>'
    +'<div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);line-height:1.8">'
    +'Row 1 (headers): name, arr, arr_gr, nav, moic, burn, gm, nrr, ev_arr, status<br>'
    +'Row 2+: Q-CTRL, 18, 120, 82, 2.3, 1.2, 75, 145, 22, Star<br>'
    +'Any column can be left blank â€” only non-empty values overwrite dashboard data.'
    +'</div>'
    +'</div>';
  if(window._savedSheetUrl)setTimeout(function(){triggerSheetFetch();},1200);
  setInterval(function(){if(window._savedSheetUrl)triggerSheetFetch();},300000);
}

function triggerSheetFetch(){
  var input=document.getElementById('sheet-url-input');
  var url=input?input.value.trim():'';
  if(!url){setDataFeedStatus('idle','Enter a Google Sheets URL first');return;}
  window._savedSheetUrl=url;
  saveState();
  fetchSheetData(url);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// == BULLHUB INTELLIGENCE PAGE ============================================
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initBullhub(){
  renderBHHeatmap();
  renderBHDealflow();
  renderBHResearch();
  renderBHSynergies();
  // Research sub-tabs lazy-load on click via lazyBH
}

function initTools(){
  // Init first tab (Monte Carlo) on page load
  initMonteCarlo();
}

function renderBHHeatmap(){
  var el=document.getElementById('bh-heatmap');if(!el)return;
  var sectors=[
    {name:'AI / ML Infrastructure',sentiment:'Bullish',score:88,note:'Inference cost curves collapsing â€” compute moats eroding. Favour middleware and orchestration plays over raw hardware.',col:C.gr},
    {name:'Quantum Computing',sentiment:'Bullish',score:82,note:'EU Quantum Flagship 2030 creating institutional demand earlier than expected. Error-correction breakthroughs validating Q-CTRL thesis.',col:C.gr},
    {name:'Cybersecurity (AI-Native)',sentiment:'Bullish',score:76,note:'SOC automation wave accelerating. Legacy SIEM vendors losing ground to real-time ML detection. Series A pipeline strong.',col:C.gr},
    {name:'B2B SaaS (Horizontal)',sentiment:'Neutral',score:52,note:'Multiple compression stabilised at 8-10Ã— EV/ARR for growth. Consolidation M&A picking up â€” good for exits, tough for new entries.',col:C.go},
    {name:'FinTech (B2B)',sentiment:'Neutral',score:48,note:'Revenue-based lending under pressure from rate sensitivity. Embedded finance and payments infra remain strong sub-verticals.',col:C.go},
    {name:'EdTech',sentiment:'Bearish',score:24,note:'B2C EdTech demand collapsed post-COVID normalisation. Enterprise L&D and upskilling pivots the only viable path. Multiverse exposure concerning.',col:C.re},
    {name:'DeepTech (Hardware)',sentiment:'Bullish',score:72,note:'AI chip startups attracting record capital. d-Matrix inference architecture well-positioned if execution holds. Watch supply chain.',col:C.gr},
    {name:'Crypto / Web3',sentiment:'Neutral',score:44,note:'Retail volume down 44%. Institutional custody narrative replacing retail speculation story. Reframe Ledger accordingly.',col:C.go},
  ];
  el.innerHTML=sectors.map(function(s){
    var barColor=s.sentiment==='Bullish'?'var(--green)':s.sentiment==='Bearish'?'var(--red)':'var(--gold)';
    var bgColor=s.sentiment==='Bullish'?'var(--green-dim)':s.sentiment==='Bearish'?'var(--red-dim)':'var(--gold-dim)';
    return '<div style="padding:10px 0;border-bottom:1px solid var(--border)">'
      +'<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">'
      +'<span style="font-family:\'Syne\',sans-serif;font-size:12px;font-weight:700;color:var(--text)">'+s.name+'</span>'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;font-weight:700;color:'+s.col+';background:'+bgColor+';padding:2px 8px;border-radius:10px">'+s.sentiment.toUpperCase()+'</span>'
      +'</div>'
      +'<div style="height:5px;background:var(--s3);border-radius:3px;margin-bottom:6px;overflow:hidden">'
      +'<div style="height:100%;width:'+s.score+'%;background:'+barColor+';border-radius:3px;transition:width .6s ease"></div>'
      +'</div>'
      +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-mid);line-height:1.6;font-style:italic">ðŸ“ '+s.note+'</div>'
      +'</div>';
  }).join('');
}

function renderBHDealflow(){
  var el=document.getElementById('bh-dealflow');if(!el)return;
  var deals=[
    {co:'NeuralBridge AI',stage:'Series B',lead:'M. Maymann',prob:78,sector:'AI Infra'},
    {co:'CipherShield',stage:'Series A',lead:'J. Rathbone',prob:65,sector:'Cybersecurity'},
    {co:'Arkonis Quantum',stage:'Late Stage',lead:'M. Maymann',prob:42,sector:'DeepTech'},
    {co:'PayGrid',stage:'Series B',lead:'J. Rathbone',prob:55,sector:'FinTech'},
    {co:'Synthwave Robotics',stage:'Series A',lead:'M. Maymann',prob:38,sector:'AI / Robotics'},
    {co:'VaultEdge',stage:'Series B',lead:'J. Rathbone',prob:72,sector:'Cybersecurity'},
    {co:'Aether Data',stage:'Late Stage',lead:'M. Maymann',prob:28,sector:'B2B SaaS'},
    {co:'QuantumLedger',stage:'Series A',lead:'J. Rathbone',prob:48,sector:'Crypto Infra'},
  ];
  var probColor=function(p){return p>=70?'var(--green)':p>=45?'var(--orange)':'var(--red)';};
  el.innerHTML='<table class="tbl"><thead><tr><th>Company</th><th>Stage</th><th>Sector</th><th>Lead Partner</th><th class="num" style="min-width:140px">Probability to Close</th></tr></thead><tbody>'
    +deals.map(function(d){
      return '<tr>'
        +'<td class="name-cell">'+d.co+'</td>'
        +'<td style="font-family:\'JetBrains Mono\',monospace;font-size:11px;color:var(--text-mid)">'+d.stage+'</td>'
        +'<td><span class="t t-dim">'+d.sector+'</span></td>'
        +'<td style="font-family:\'JetBrains Mono\',monospace;font-size:11px;color:var(--text-mid)">'+d.lead+'</td>'
        +'<td class="num">'
        +'<div style="display:flex;align-items:center;gap:8px;justify-content:flex-end">'
        +'<div style="flex:1;max-width:90px;height:6px;background:var(--s3);border-radius:3px;overflow:hidden">'
        +'<div style="height:100%;width:'+d.prob+'%;background:'+probColor(d.prob)+';border-radius:3px"></div>'
        +'</div>'
        +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:11px;font-weight:700;color:'+probColor(d.prob)+';min-width:32px;text-align:right">'+d.prob+'%</span>'
        +'</div>'
        +'</td></tr>';
    }).join('')
    +'</tbody></table>';
}

function renderBHResearch(){
  var el=document.getElementById('bh-research');if(!el)return;
  var memos=[
    {title:'AI Inference Economics: Why Middleware Wins',time:'6 min',sector:'AI / ML',date:'Feb 17',priority:'HIGH',col:C.or,
     desc:'Cost-per-token analysis across 14 inference providers. Edge middleware margin structure suggests 68-72% gross margins at scale.'},
    {title:'Quantum Error Correction â€” Commercial Readiness',time:'8 min',sector:'DeepTech',date:'Feb 14',priority:'HIGH',col:C.pu,
     desc:'EU Quantum Flagship 2030 roadmap analysis. Q-CTRL cited as benchmark. First enterprise RFPs from financial services.'},
    {title:'Series A Compression: Quality vs Volume',time:'4 min',sector:'All Sectors',date:'Feb 12',priority:'MED',col:C.bl,
     desc:'Median ARR at Series A down 23% since Q3 2023. More companies eligible but quality dilution risk rising. Tighter screening needed.'},
    {title:'Groq $640M Raise: d-Matrix Competitive Impact',time:'5 min',sector:'AI Infra',date:'Feb 10',priority:'URGENT',col:C.re,
     desc:'Groq valued at $2.8B â€” direct inference chip competitor. Validates market but creates narrative pressure. IC note required.'},
    {title:'Cybersecurity M&A Wave: SOC Automation Targets',time:'7 min',sector:'Cybersecurity',date:'Feb 7',priority:'MED',col:C.gr,
     desc:'12 AI-native SOC startups mapped. 3 Unit 8200 founders active on platform. Matches Corelight DD thesis.'},
    {title:'FinTech Down-Round Tracker: Opportunities Emerging',time:'3 min',sector:'FinTech',date:'Feb 5',priority:'LOW',col:C.tl,
     desc:'Median Series B in B2B FinTech dropped from â‚¬28M to â‚¬20M. Distressed co-investment opportunities in Q2-Q3.'},
    {title:'Fireblocks Acquisition Comp: Ledger Exit Framing',time:'4 min',sector:'Crypto',date:'Feb 3',priority:'MED',col:C.go,
     desc:'Fireblocks rumoured at 18Ã— revenue. Sets direct comparable for Ledger institutional custody exit narrative.'},
    {title:'EdTech Sector Review: Survival Strategies',time:'9 min',sector:'EdTech',date:'Jan 30',priority:'LOW',col:C.re,
     desc:'B2C EdTech demand down 32%. Enterprise L&D the only viable pivot. Multiverse and Headway position analysis.'},
  ];
  var prioColors={'URGENT':C.re+'22','HIGH':C.or+'18','MED':C.bl+'18','LOW':'var(--s3)'};
  el.innerHTML=memos.map(function(m){
    return '<div style="padding:12px 0;border-bottom:1px solid var(--border);display:flex;gap:12px;align-items:flex-start">'
      +'<div style="flex-shrink:0;width:4px;height:56px;border-radius:2px;background:'+m.col+';margin-top:2px"></div>'
      +'<div style="flex:1;min-width:0">'
      +'<div style="display:flex;align-items:center;gap:6px;margin-bottom:4px;flex-wrap:wrap">'
      +'<span style="font-family:\'Syne\',sans-serif;font-size:12px;font-weight:700;color:var(--text);flex:1;min-width:0">'+m.title+'</span>'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:9px;font-weight:700;color:'+m.col+';background:'+prioColors[m.priority]+';padding:2px 7px;border-radius:10px;flex-shrink:0">'+m.priority+'</span>'
      +'</div>'
      +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-mid);line-height:1.6;margin-bottom:5px">'+m.desc+'</div>'
      +'<div style="display:flex;align-items:center;gap:10px">'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:'+m.col+';background:'+m.col+'15;padding:2px 7px;border-radius:4px">'+m.sector+'</span>'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim)">â± '+m.time+'</span>'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim);margin-left:auto">'+m.date+'</span>'
      +'</div>'
      +'</div></div>';
  }).join('');
}

function renderBHSynergies(){
  var el=document.getElementById('bh-synergies');if(!el)return;
  var synergies=[
    {from:'Q-CTRL',to:'Ledger',type:'Technology',strength:92,col:C.pu,
     desc:'Q-CTRL\'s quantum error correction could provide quantum-safe encryption for Ledger\'s institutional custody infrastructure â€” a critical differentiator as quantum computing threatens current cryptographic standards.',
     action:'Schedule joint technical review between CTOs'},
    {from:'d-Matrix',to:'Matillion',type:'Infrastructure',strength:78,col:C.or,
     desc:'d-Matrix\'s inference acceleration chips could dramatically reduce Matillion\'s cloud compute costs for large-scale data transformation workloads. Potential 40-60% cost reduction on ML pipeline processing.',
     action:'Introduce VP Engineering for POC discussion'},
    {from:'Quantexa',to:'Wayflyer',type:'Data Intelligence',strength:85,col:C.bl,
     desc:'Quantexa\'s entity resolution and network analytics could supercharge Wayflyer\'s underwriting models â€” real-time merchant risk scoring using connected data rather than siloed financial statements.',
     action:'Propose data partnership at next board meeting'},
    {from:'Multiverse',to:'Headway',type:'Distribution',strength:64,col:C.gr,
     desc:'Multiverse\'s enterprise apprenticeship network overlaps with Headway\'s corporate L&D buyer base. Joint go-to-market for "hire + upskill" packages could reduce CAC for both by 25-30%.',
     action:'Connect sales leaders â€” pilot with 2 shared accounts'},
    {from:'Sanity',to:'Matillion',type:'Product Integration',strength:58,col:C.tl,
     desc:'Sanity\'s structured content platform could serve as the presentation layer for Matillion\'s data transformation outputs â€” a "data to content" pipeline that neither can build alone.',
     action:'Explore integration partnership for joint customers'},
  ];
  el.innerHTML=synergies.map(function(s){
    var barW=Math.round(s.strength);
    return '<div style="padding:12px;margin-bottom:10px;background:var(--s2);border:1px solid var(--border);border-left:3px solid '+s.col+';border-radius:6px">'
      +'<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">'
      +'<div style="display:flex;align-items:center;gap:6px">'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:12px;font-weight:700;color:var(--text)">'+s.from+'</span>'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:11px;color:'+s.col+'">âŸ·</span>'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:12px;font-weight:700;color:var(--text)">'+s.to+'</span>'
      +'</div>'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:'+s.col+';background:'+s.col+'18;padding:2px 8px;border-radius:10px">'+s.type+'</span>'
      +'</div>'
      +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-mid);line-height:1.7;margin-bottom:8px">'+s.desc+'</div>'
      +'<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim);min-width:65px">Synergy fit</span>'
      +'<div style="flex:1;height:4px;background:var(--s3);border-radius:2px;overflow:hidden">'
      +'<div style="height:100%;width:'+barW+'%;background:'+s.col+';border-radius:2px"></div>'
      +'</div>'
      +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;font-weight:700;color:'+s.col+'">'+s.strength+'%</span>'
      +'</div>'
      +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--orange);background:var(--orange-dim);padding:5px 10px;border-radius:4px;display:inline-block">â†’ '+s.action+'</div>'
      +'</div>';
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// == SECURITY & TRUST PAGE ================================================
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initSecurity(){
  var el=document.getElementById('audit-log-display');if(!el)return;
  var logs=[
    {ts:'2025-02-19 08:47:12',user:'M. Maymann',action:'VALUATION_ADJ',detail:'Fund VI Q4 NAV mark â€” Q-CTRL EV/ARR adjusted from 14.2Ã— to 15.8Ã—',old:'$72.4M',new:'$82.0M',cls:'or'},
    {ts:'2025-02-19 08:44:03',user:'M. Maymann',action:'SCENARIO_RUN',detail:'Risk Scenario Builder â€” Deep Recession preset applied',old:'Base NAV $294M',new:'Stress NAV $191M',cls:'re'},
    {ts:'2025-02-18 17:22:41',user:'System',action:'AUTO_SAVE',detail:'Session state persisted â€” 14 slider positions, 3 named scenarios',old:'â€”',new:'SHA-256: 9f3aâ€¦c8d1',cls:'dim'},
    {ts:'2025-02-18 16:05:18',user:'J. Rathbone',action:'DCF_OVERRIDE',detail:'d-Matrix WACC changed from 25% to 22% â€” IC-approved adjustment',old:'IV: $31.2M',new:'IV: $38.6M',cls:'pu'},
    {ts:'2025-02-18 14:30:55',user:'M. Maymann',action:'MONTE_CARLO',detail:'10,000-path simulation â€” Fund VI TVPI distribution generated',old:'â€”',new:'P50: 1.82Ã— / P90: 2.41Ã—',cls:'bl'},
    {ts:'2025-02-18 11:12:09',user:'System',action:'PAGE_ACCESS',detail:'LP Reporting page accessed â€” STRICTLY CONFIDENTIAL data viewed',old:'â€”',new:'Session logged',cls:'dim'},
    {ts:'2025-02-17 09:41:33',user:'J. Rathbone',action:'EXIT_SCENARIO',detail:'Matillion IPO scenario â€” Bear/Base/Bull modelled, exit timing Q4 2025',old:'â€”',new:'Wtd Exit: $36M',cls:'gr'},
    {ts:'2025-02-17 08:55:02',user:'M. Maymann',action:'FX_STRESS',detail:'USD/EUR âˆ’10% shock applied to multi-currency portfolio',old:'NAV $294M',new:'Stress NAV $276M',cls:'or'},
    {ts:'2025-02-16 16:20:17',user:'System',action:'QUARTER_LOCK',detail:'Q4 2024 valuation assumptions locked â€” read-only until IC override',old:'â€”',new:'Lock ID: QL-2024Q4-001',cls:'gr'},
    {ts:'2025-02-16 10:08:44',user:'J. Rathbone',action:'VALUATION_ADJ',detail:'Wayflyer ARR growth revised from 42% to 38% per board update',old:'MOIC 1.6Ã—',new:'MOIC 1.5Ã—',cls:'or'},
  ];
  el.innerHTML=logs.map(function(l){
    var actionColor={'VALUATION_ADJ':C.or,'SCENARIO_RUN':C.re,'AUTO_SAVE':'var(--text-dim)','DCF_OVERRIDE':C.pu,'MONTE_CARLO':C.bl,'PAGE_ACCESS':'var(--text-dim)','EXIT_SCENARIO':C.gr,'FX_STRESS':C.or,'QUARTER_LOCK':C.gr}[l.action]||'var(--text-mid)';
    return '<div style="display:flex;gap:8px;padding:5px 0;border-bottom:1px solid var(--border);align-items:flex-start">'
      +'<span style="color:var(--text-dim);min-width:120px;flex-shrink:0">'+l.ts+'</span>'
      +'<span style="color:var(--text-mid);min-width:85px;flex-shrink:0">'+l.user+'</span>'
      +'<span style="color:'+actionColor+';font-weight:700;min-width:110px;flex-shrink:0">'+l.action+'</span>'
      +'<span style="color:var(--text-mid);flex:1">'+l.detail+'</span>'
      +'<span style="color:var(--text-dim);min-width:90px;text-align:right;flex-shrink:0">'+l.old+' â†’ '+l.new+'</span>'
      +'</div>';
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// == SETTINGS / DATA HUB PAGE =============================================
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initSettings(){
  initDataFeedPanel();
  renderSavedScenarios();
  renderAPIPanel();
}

function renderAPIPanel(){
  var el=document.getElementById('api-panel');if(!el)return;
  el.innerHTML=''
    +'<div style="display:flex;align-items:center;gap:8px;margin-bottom:16px;padding:10px 12px;background:var(--green-dim);border:1px solid var(--green)33;border-radius:6px">'
    +'<div style="width:10px;height:10px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green),0 0 12px var(--green)44;animation:dot-blink 2s infinite"></div>'
    +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:12px;font-weight:600;color:var(--green)">Ready for Live Sync</span>'
    +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim);margin-left:auto">All endpoints configured</span>'
    +'</div>'
    +'<div style="margin-bottom:14px">'
    +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:11px;font-weight:700;color:var(--text);margin-bottom:6px">Portfolio Management System</div>'
    +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim);margin-bottom:6px">eFront / iLevel â€” Fund accounting, capital calls, NAV reconciliation</div>'
    +'<div style="display:flex;gap:8px;align-items:center">'
    +'<input type="password" id="api-pms" value="sk-ef-live-9a3fâ€¦d8c1" readonly style="flex:1;background:var(--bg);border:1px solid var(--border2);border-radius:5px;color:var(--text-mid);font-family:\'JetBrains Mono\',monospace;font-size:11px;padding:8px 10px;box-sizing:border-box">'
    +'<button onclick="toggleAPIVis(\'api-pms\',this)" style="background:var(--s3);border:1px solid var(--border2);color:var(--text-mid);font-family:\'JetBrains Mono\',monospace;font-size:10px;padding:8px 10px;border-radius:5px;cursor:pointer;white-space:nowrap">Show</button>'
    +'</div>'
    +'<div style="display:flex;align-items:center;gap:6px;margin-top:6px">'
    +'<div style="width:7px;height:7px;border-radius:50%;background:var(--green)"></div>'
    +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--green)">Connected</span>'
    +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim);margin-left:auto">Last sync: 08:45 UTC</span>'
    +'</div>'
    +'</div>'
    +'<div style="margin-bottom:14px">'
    +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:11px;font-weight:700;color:var(--text);margin-bottom:6px">Market Data Feed</div>'
    +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim);margin-bottom:6px">Bloomberg / FactSet â€” Public comps, sector multiples, FX rates</div>'
    +'<div style="display:flex;gap:8px;align-items:center">'
    +'<input type="password" id="api-mkt" value="bbg-api-7f2eâ€¦a4b9" readonly style="flex:1;background:var(--bg);border:1px solid var(--border2);border-radius:5px;color:var(--text-mid);font-family:\'JetBrains Mono\',monospace;font-size:11px;padding:8px 10px;box-sizing:border-box">'
    +'<button onclick="toggleAPIVis(\'api-mkt\',this)" style="background:var(--s3);border:1px solid var(--border2);color:var(--text-mid);font-family:\'JetBrains Mono\',monospace;font-size:10px;padding:8px 10px;border-radius:5px;cursor:pointer;white-space:nowrap">Show</button>'
    +'</div>'
    +'<div style="display:flex;align-items:center;gap:6px;margin-top:6px">'
    +'<div style="width:7px;height:7px;border-radius:50%;background:var(--green)"></div>'
    +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--green)">Connected</span>'
    +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim);margin-left:auto">Last sync: 08:42 UTC</span>'
    +'</div>'
    +'</div>'
    +'<div style="margin-bottom:14px;padding-top:12px;border-top:1px solid var(--border)">'
    +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:11px;font-weight:700;color:var(--text);margin-bottom:6px">Cap Table Integration</div>'
    +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim);margin-bottom:6px">Carta / Pulley â€” Ownership tables, liquidation preferences, dilution</div>'
    +'<div style="display:flex;align-items:center;gap:6px">'
    +'<div style="width:7px;height:7px;border-radius:50%;background:var(--gold)"></div>'
    +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--gold)">Not configured</span>'
    +'</div>'
    +'</div>'
    +'<div style="margin-bottom:14px;padding-top:12px;border-top:1px solid var(--border)">'
    +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:11px;font-weight:700;color:var(--text);margin-bottom:6px">Revenue Monitoring</div>'
    +'<div style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--text-dim);margin-bottom:6px">ChartMogul / Stripe â€” Live ARR, MRR, churn for portfolio companies</div>'
    +'<div style="display:flex;align-items:center;gap:6px">'
    +'<div style="width:7px;height:7px;border-radius:50%;background:var(--gold)"></div>'
    +'<span style="font-family:\'JetBrains Mono\',monospace;font-size:10px;color:var(--gold)">Not configured</span>'
    +'</div>'
    +'</div>'
    +'<button id="api-test-btn" onclick="testAPIConnection()" style="width:100%;margin-top:8px;background:var(--s3);border:1px solid var(--green);color:var(--green);font-family:\'JetBrains Mono\',monospace;font-size:11px;font-weight:600;padding:10px;border-radius:6px;cursor:pointer;transition:all .2s">'
    +'âš¡ Test Connection</button>'
    +'<div id="api-test-result" style="margin-top:8px;font-family:\'JetBrains Mono\',monospace;font-size:10px;text-align:center;min-height:18px"></div>';
}

function toggleAPIVis(id,btn){
  var inp=document.getElementById(id);if(!inp)return;
  if(inp.type==='password'){inp.type='text';btn.textContent='Hide';}
  else{inp.type='password';btn.textContent='Show';}
}

function testAPIConnection(){
  var btn=document.getElementById('api-test-btn');
  var res=document.getElementById('api-test-result');
  if(!btn||!res)return;
  btn.disabled=true;btn.textContent='Testingâ€¦';btn.style.opacity='0.6';
  res.innerHTML='<span style="color:var(--text-dim)">Pinging endpointsâ€¦</span>';
  setTimeout(function(){
    res.innerHTML='<span style="color:var(--green)">âœ“ PMS (eFront): 200 OK â€” 42ms</span>';
    setTimeout(function(){
      res.innerHTML='<span style="color:var(--green)">âœ“ PMS: 200 OK â€” 42ms &nbsp;|&nbsp; âœ“ Market Data: 200 OK â€” 67ms</span>';
      btn.textContent='âš¡ Test Connection';btn.disabled=false;btn.style.opacity='1';
    },800);
  },1200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// == AUGMENT initPage TO RESTORE STATE & HOOK SAVE TRIGGERS ===============
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var _origInitPage=initPage;
initPage=function(id){
  _origInitPage(id);
  setTimeout(function(){restorePageState(id);},120);
  if(id==='settings')setTimeout(initSettings,50);
};

// Hook all slider inputs to auto-save (debounced)
var _saveTimer=null;
document.addEventListener('input',function(e){
  if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA'){
    clearTimeout(_saveTimer);
    _saveTimer=setTimeout(saveState,1200);
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// == NAV BAR: ADD SETTINGS + PERSIST BADGE ================================
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  var nav=document.querySelector('.nav');
  if(!nav)return;
  // Persist badge
  var badge=document.createElement('div');
  badge.id='persist-badge';
  badge.style.cssText='font-family:"JetBrains Mono",monospace;font-size:11px;color:var(--text-dim);padding:0 8px;opacity:0.5;white-space:nowrap;align-self:center;transition:color .3s,opacity .5s';
  badge.textContent='Auto-save on';
  nav.appendChild(badge);
  // Save button
  var saveBtn=document.createElement('div');
  saveBtn.style.cssText='font-family:"JetBrains Mono",monospace;font-size:11px;color:var(--orange);padding:9px 12px;cursor:pointer;border-left:1px solid var(--border);white-space:nowrap;align-self:center';
  saveBtn.textContent='âŠž Save Scenario';
  saveBtn.onclick=saveNamedScenario;
  nav.appendChild(saveBtn);
  // Settings link
  var settingsLink=document.createElement('a');
  settingsLink.style.cssText='font-family:"JetBrains Mono",monospace;font-size:11px;color:var(--text-mid);padding:9px 14px;cursor:pointer;border-left:1px solid var(--border);white-space:nowrap;align-self:center;text-decoration:none';
  settingsLink.textContent='âš™ Settings';
  settingsLink.onclick=function(){go('settings');};
  nav.appendChild(settingsLink);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// == SETTINGS PAGE HTML (injected dynamically) ============================
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function(){
  var existing=document.getElementById('pg-settings');
  if(existing)return;
  var pg=document.createElement('div');
  pg.className='pg';pg.id='pg-settings';
  pg.innerHTML='<div class="sec-hdr"><h2>Settings & Data</h2><p>Connect live data, manage saved scenarios, configure enterprise integrations</p></div>'
    +'<div class="grid g32">'
    +'<div>'
    +'<div class="card"><div class="ch"><h3>Live Data Feed</h3><span class="t t-or">Google Sheets</span></div>'
    +'<div class="cb" id="data-feed-url"></div></div>'
    +'<div class="card" style="margin-top:14px"><div class="ch"><h3>Saved Scenarios</h3><span class="t t-dim" id="scenarios-count"></span></div>'
    +'<div class="cb"><div id="saved-scenarios-list"></div>'
    +'<button onclick="saveNamedScenario()" style="margin-top:10px;background:var(--s3);border:1px solid var(--border2);color:var(--orange);font-family:var(--font-mono);font-size:11px;padding:7px 14px;border-radius:5px;cursor:pointer;width:100%">+ Save Current State as Scenario</button>'
    +'</div></div>'
    +'<div class="card" style="margin-top:14px"><div class="ch"><h3>Data Persistence</h3></div>'
    +'<div class="cb">'
    +'<div class="ctrl-row"><span class="ctrl-label">Auto-save interval</span><span style="font-family:var(--font-mono);font-size:11px;color:var(--green)">15 seconds</span></div>'
    +'<div class="ctrl-row"><span class="ctrl-label">Storage location</span><span style="font-family:var(--font-mono);font-size:11px;color:var(--text-mid)">Browser localStorage</span></div>'
    +'<div class="ctrl-row"><span class="ctrl-label">Last saved</span><span id="last-saved-time" style="font-family:var(--font-mono);font-size:11px;color:var(--text-mid)">â€”</span></div>'
    +'<div style="margin-top:10px;display:flex;gap:8px">'
    +'<button onclick="saveState()" style="flex:1;background:var(--s3);border:1px solid var(--orange);color:var(--orange);font-family:var(--font-mono);font-size:11px;padding:6px;border-radius:5px;cursor:pointer">Save Now</button>'
    +'<button onclick="if(confirm(\'Clear all saved state?\'))localStorage.clear();showPersistBadge(\'Cleared\')" style="flex:1;background:var(--s3);border:1px solid var(--red);color:var(--red);font-family:var(--font-mono);font-size:11px;padding:6px;border-radius:5px;cursor:pointer">Clear All</button>'
    +'</div>'
    +'</div></div>'
    +'</div>'
    +'<div>'
    +'<div class="card"><div class="ch"><h3>Enterprise Connectivity (APIs)</h3><span class="t t-gr">READY</span></div>'
    +'<div class="cb" id="api-panel"></div></div>'
    +'</div>'
    +'</div>';
  (document.querySelector('main')||document.querySelector('.main')||document.body).appendChild(pg);
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// == BOOT ================================================================
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESTORED CORE FUNCTIONS (DCF, VaR, Monte Carlo base engines)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ Shared math utilities
function randn(){var u=0,v=0;while(u===0)u=Math.random();while(v===0)v=Math.random();return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v);}
function randT(df){var n=randn(),chi2=0;for(var i=0;i<df;i++){var x=randn();chi2+=x*x;}return n/Math.sqrt(chi2/df);}
function normInv(p){var a=[2.515517,0.802853,0.010328],b=[1.432788,0.189269,0.001308],sign=p<0.5?-1:1,t=p<0.5?Math.sqrt(-2*Math.log(p)):Math.sqrt(-2*Math.log(1-p)),num=a[0]+a[1]*t+a[2]*t*t,den=1+b[0]*t+b[1]*t*t+b[2]*t*t*t;return sign*(t-num/den);}

// â”€â”€ Monte Carlo helpers
var MC_DIST='lognormal';
var MC_RESULTS=null;
function setMCDist(v,el){MC_DIST=v;document.querySelectorAll('#mc-dist-chips .chip').forEach(c=>c.classList.remove('on'));el.classList.add('on');}
function mcUpdateLabel(slId,valId,fmt){var v=parseFloat(document.getElementById(slId).value);document.getElementById(valId).textContent=fmt(v);}
function initMonteCarlo(){var el=document.getElementById('mc-status');if(el)el.textContent='Ready';}

// â”€â”€ DCF helpers
var DCF_CO='Q-CTRL';
var DCF_TV_METHOD='gordon';
var DCF_DEFAULTS={
  'Q-CTRL':    {arr:18, gm:75,g1:100,g2:80,g3:60,g4:40,g5:25,sm:45,rd:30,ga:12,wacc:20,tg:3,tvMult:25,mark:82},
  'Matillion': {arr:62, gm:70,g1:55, g2:45,g3:35,g4:25,g5:18,sm:35,rd:20,ga:10,wacc:18,tg:3,tvMult:22,mark:32},
  'Ledger':    {arr:85, gm:72,g1:45, g2:35,g3:28,g4:20,g5:15,sm:30,rd:18,ga:9, wacc:16,tg:3,tvMult:20,mark:32},
  'd-Matrix':  {arr:5,  gm:45,g1:180,g2:150,g3:100,g4:65,g5:40,sm:60,rd:45,ga:15,wacc:25,tg:4,tvMult:30,mark:38},
  'Quantexa': {arr:55, gm:68,g1:80, g2:60,g3:45,g4:30,g5:20,sm:38,rd:22,ga:10,wacc:17,tg:3,tvMult:22,mark:58},
  'Multiverse':{arr:48, gm:66,g1:70, g2:55,g3:40,g4:28,g5:18,sm:40,rd:25,ga:11,wacc:18,tg:3,tvMult:20,mark:55},
};

function setDCFTV(v,el){DCF_TV_METHOD=v;document.querySelectorAll('#dcf-tv-chips .chip').forEach(c=>c.classList.remove('on'));el.classList.add('on');dcfUpdate();}
function dcfUpdateSlider(slId,valId,fmt){var v=parseFloat(document.getElementById(slId).value);document.getElementById(valId).textContent=fmt(v);}

function selectDCFCo(name,el){
  DCF_CO=name;
  document.querySelectorAll('#dcf-co-chips .chip').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');
  var d=DCF_DEFAULTS[name];if(!d)return;
  document.getElementById('dcf-arr').value=d.arr;
  ['gm','g1','g2','g3','g4','g5','sm','rd','ga','wacc','tg'].forEach(id=>{
    var el2=document.getElementById('dcf-'+id);if(el2&&d[id]!==undefined)el2.value=d[id];
  });
  var tmEl=document.getElementById('dcf-tv-mult');if(tmEl&&d.tvMult)tmEl.value=d.tvMult;
  ['gm','g1','g2','g3','g4','g5','sm','rd','ga','wacc','tg'].forEach(id=>{
    var sl=document.getElementById('dcf-'+id),vEl=document.getElementById('dcf-'+id+'-v');
    if(sl&&vEl)vEl.textContent=sl.value+'%';
  });
  var tmvEl=document.getElementById('dcf-tv-mult-v');if(tmvEl&&d.tvMult)tmvEl.textContent=d.tvMult+'Ã—';
  dcfUpdate();
}

function dcfCalcIV(arr,gm,g1,g2,g3,g4,g5,sm,rd,ga,wacc,tg,tvM){
  var rev=arr,pvTotal=0,growths=[g1,g2,g3,g4,g5],lastFCF=0;
  for(var yr=1;yr<=5;yr++){
    rev*=(1+growths[yr-1]);
    var ebitda=rev*(gm-sm-rd-ga),fcf=ebitda*0.85;
    pvTotal+=fcf/Math.pow(1+wacc,yr);
    if(yr===5)lastFCF=fcf;
  }
  var tv=lastFCF>0?lastFCF*(1+tg)/(wacc-tg):Math.abs(lastFCF)*tvM;
  return pvTotal+tv/Math.pow(1+wacc,5);
}

function dcfUpdate(){
  var arr=parseFloat(document.getElementById('dcf-arr').value)||18;
  var gm=parseFloat(document.getElementById('dcf-gm').value)/100;
  var g=[1,2,3,4,5].map(i=>parseFloat(document.getElementById('dcf-g'+i).value)/100);
  var sm=parseFloat(document.getElementById('dcf-sm').value)/100;
  var rd=parseFloat(document.getElementById('dcf-rd').value)/100;
  var ga=parseFloat(document.getElementById('dcf-ga').value)/100;
  var wacc=parseFloat(document.getElementById('dcf-wacc').value)/100;
  var tg=parseFloat(document.getElementById('dcf-tg').value)/100;
  var tvM=parseFloat(document.getElementById('dcf-tv-mult').value);
  var mark=(DCF_DEFAULTS[DCF_CO]||{mark:82}).mark;

  var years=[],revs=[],grossProfits=[],ebitdas=[],fcfs=[],pvFCFs=[];
  var rev=arr,pvTotal=0;
  for(var yr=1;yr<=5;yr++){
    rev=rev*(1+g[yr-1]);
    var gp=rev*gm,smC=rev*sm,rdC=rev*rd,gaC=rev*ga;
    var ebitda=gp-smC-rdC-gaC,fcf=ebitda*0.85;
    var pv=fcf/Math.pow(1+wacc,yr);
    pvTotal+=pv;
    years.push('Year '+yr);revs.push(+rev.toFixed(1));grossProfits.push(+gp.toFixed(1));
    ebitdas.push(+ebitda.toFixed(1));fcfs.push(+fcf.toFixed(1));pvFCFs.push(+pv.toFixed(1));
  }
  var lastFCF=fcfs[4];
  var tvGordon=lastFCF>0?lastFCF*(1+tg)/(wacc-tg):0;
  var tvMultiple=Math.abs(ebitdas[4])*tvM;
  var tvRaw=DCF_TV_METHOD==='gordon'?tvGordon:DCF_TV_METHOD==='multiple'?tvMultiple:(tvGordon+tvMultiple)/2;
  var tvPV=tvRaw/Math.pow(1+wacc,5);
  var ivTotal=pvTotal+tvPV;
  var tvPct=tvRaw>0?(tvPV/ivTotal*100).toFixed(0):'â€”';

  function setCard(id,val,cls){var el=document.getElementById(id);if(el){el.textContent=val;if(cls)el.className='live-kpi-val '+cls;}}
  setCard('dcf-iv','$'+ivTotal.toFixed(0)+'M',ivTotal>mark?'up':'dn');
  var updown=((ivTotal/mark-1)*100).toFixed(1);
  setCard('dcf-vs-mark',(ivTotal>mark?'+':'')+updown+'%',ivTotal>mark?'up':'dn');
  var udEl=document.getElementById('dcf-updown');if(udEl)udEl.textContent=(ivTotal>mark?'Undervaluedâ†‘':'Overvaluedâ†“')+' ($'+mark+'M mark)';
  var subEl=document.getElementById('dcf-iv-sub');if(subEl)subEl.textContent=DCF_CO+' Â· WACC '+(wacc*100).toFixed(1)+'% Â· '+DCF_TV_METHOD;
  setCard('dcf-pv-fcf','$'+pvTotal.toFixed(0)+'M');
  setCard('dcf-tv-pv','$'+tvPV.toFixed(0)+'M');
  var tpEl=document.getElementById('dcf-tv-pct');if(tpEl)tpEl.textContent=tvPct+'% of total';

  // P&L table
  var tblEl=document.getElementById('dcf-table');
  if(tblEl){
    var rows=[
      ['ARR / Revenue ($M)',revs,'up'],
      ['Gross Profit ($M)',grossProfits,'up'],
      ['Gross Margin %',revs.map((r,i)=>+(grossProfits[i]/r*100).toFixed(1)),''],
      ['S&M ($M)',revs.map(r=>-(r*sm).toFixed(1)),'dn'],
      ['R&D ($M)',revs.map(r=>-(r*rd).toFixed(1)),'dn'],
      ['G&A ($M)',revs.map(r=>-(r*ga).toFixed(1)),'dn'],
      ['EBITDA ($M)',ebitdas,''],
      ['EBITDA Margin %',revs.map((r,i)=>+(ebitdas[i]/r*100).toFixed(1)),''],
      ['FCF ($M)',fcfs,''],
      ['PV of FCF ($M)',pvFCFs,'up'],
    ];
    tblEl.innerHTML='<table class="tbl"><thead><tr><th>Metric</th>'+years.map(y=>'<th class="num">'+y+'</th>').join('')+'</tr></thead><tbody>'+
      rows.map(([label,vals])=>'<tr><td style="font-family:var(--font-mono);font-size:11px;color:var(--text-mid)">'+label+'</td>'+
        vals.map(v=>'<td class="num" style="font-family:var(--font-mono);font-size:11px;color:'+(+v>0?'var(--green)':+v<0?'var(--red)':'var(--text)')+'">'+v+'</td>').join('')+'</tr>'
      ).join('')+'</tbody></table>';
  }

  // Charts
  dc('ch-dcf-proj');
  mk('ch-dcf-proj',{type:'bar',data:{labels:years,datasets:[
    {label:'Revenue',data:revs,backgroundColor:C.bl+'88',borderRadius:4},
    {label:'Gross Profit',data:grossProfits,backgroundColor:C.or+'88',borderRadius:4},
    {label:'FCF',data:fcfs,backgroundColor:fcfs.map(v=>v>=0?C.gr+'88':C.re+'88'),borderRadius:4},
    {label:'PV FCF',type:'line',data:pvFCFs,borderColor:C.tl,tension:0.3,pointRadius:4,yAxisID:'y'},
  ]},options:{scales:{y:{title:{display:true,text:'$M',color:'#7A776F',font:{size:11}}}}}});

  dc('ch-dcf-bridge');
  var running=0;
  var starts=pvFCFs.concat([tvPV]).map(v=>{var s=running;running+=v;return s;});
  mk('ch-dcf-bridge',{type:'bar',data:{labels:years.concat(['Terminal Value']),datasets:[
    {data:starts,backgroundColor:'transparent',borderWidth:0},
    {label:'Value',data:pvFCFs.concat([tvPV]),backgroundColor:[...pvFCFs.map(()=>C.or),C.pu],borderRadius:4},
  ]},options:{plugins:{legend:{display:false}},scales:{x:{stacked:true},y:{stacked:true,title:{display:true,text:'$M',color:'#7A776F',font:{size:11}}}}}});

  // Burn linkage badge
  var g1pct=parseFloat(document.getElementById('dcf-g1').value);
  var burnMult=impliedBurnMultiple(g1pct);
  var badgeEl=document.getElementById('dcf-burn-badge');
  if(badgeEl){
    var col=burnMult>3?'var(--red)':burnMult>2?'var(--orange)':'var(--green)';
    badgeEl.innerHTML='Implied Burn: <span style="font-weight:700;color:'+col+'">'+burnMult.toFixed(1)+'Ã—</span> at '+g1pct+'% growth';
  }
  var burnNote=document.getElementById('dcf-burn-note');
  if(!burnNote&&tblEl){burnNote=document.createElement('div');burnNote.id='dcf-burn-note';burnNote.style.cssText='font-family:var(--font-mono);font-size:11px;padding:6px 12px;background:var(--bg);border-top:1px solid var(--border2)';tblEl.appendChild(burnNote);}
  if(burnNote){var col2=burnMult>3?'var(--red)':burnMult>2?'var(--orange)':'var(--green)';burnNote.style.color=col2;burnNote.textContent='âš¡ At '+g1pct+'% growth, implied burn multiple '+burnMult.toFixed(1)+'Ã— â†’ adjusted S&M ~'+(burnAdjustedSM(g1pct,sm)*100).toFixed(0)+'% of ARR (base: '+(sm*100).toFixed(0)+'%)';}
}

function dcfTab(n){
  document.querySelectorAll('#dcf-tabs .stab').forEach((t,i)=>t.classList.toggle('on',i===n));
  ['dcf0','dcf1','dcf2'].forEach((id,i)=>{var el=document.getElementById(id);if(el)el.classList.toggle('on',i===n);});
  if(n===1)dcfSensitivity();
  if(n===2){dcfSOP();setTimeout(function(){selectLPCo('Ledger',document.querySelector('#lp-co-chips .chip'));},100);}
}

function dcfSensitivity(){
  var arr=parseFloat(document.getElementById('dcf-arr').value)||18;
  var gm=parseFloat(document.getElementById('dcf-gm').value)/100;
  var g1=parseFloat(document.getElementById('dcf-g1').value)/100,g2=parseFloat(document.getElementById('dcf-g2').value)/100;
  var g3=parseFloat(document.getElementById('dcf-g3').value)/100,g4=parseFloat(document.getElementById('dcf-g4').value)/100,g5=parseFloat(document.getElementById('dcf-g5').value)/100;
  var sm=parseFloat(document.getElementById('dcf-sm').value)/100,rd=parseFloat(document.getElementById('dcf-rd').value)/100,ga=parseFloat(document.getElementById('dcf-ga').value)/100;
  var baseWacc=parseFloat(document.getElementById('dcf-wacc').value)/100,baseTg=parseFloat(document.getElementById('dcf-tg').value)/100;
  var tvM=parseFloat(document.getElementById('dcf-tv-mult').value);
  var mark=(DCF_DEFAULTS[DCF_CO]||{mark:82}).mark;
  var el1=document.getElementById('dcf-sens-table-wacc'),el2=document.getElementById('dcf-sens-table-growth');
  var coEl=document.getElementById('dcf-sens-co');if(coEl)coEl.textContent=DCF_CO;
  var waccs=[baseWacc-0.06,baseWacc-0.04,baseWacc-0.02,baseWacc,baseWacc+0.02,baseWacc+0.04,baseWacc+0.06];
  var tgs=[0.01,0.02,baseTg,0.04,0.05,0.06];
  function heatColor(v){var r=(v-mark*0.5)/(mark*2-mark*0.5);r=Math.min(1,Math.max(0,r));return r>0.6?'#1a3a2a':r>0.4?'#1a2e1a':r>0.2?'#2a2010':'#3a1818';}
  if(el1){el1.innerHTML='<table class="tbl"><thead><tr><th>WACCâ†“/TGâ†’</th>'+tgs.map(t=>'<th class="num">'+(t*100).toFixed(0)+'%</th>').join('')+'</tr></thead><tbody>'+waccs.map(w=>'<tr><td style="font-family:var(--font-mono);font-size:11px;font-weight:700;color:var(--orange)">'+(w*100).toFixed(0)+'%</td>'+tgs.map(t=>{var v=dcfCalcIV(arr,gm,g1,g2,g3,g4,g5,sm,rd,ga,w,t,tvM),diff=((v/mark-1)*100).toFixed(0);return'<td class="num" style="background:'+heatColor(v)+';font-family:var(--font-mono);font-size:11px;color:'+(v>mark?'#2ECC8A':'#E05555')+'">'+'$'+v.toFixed(0)+'M<br><span style="font-size:11px;opacity:0.7">'+(v>mark?'+':'')+diff+'%</span></td>';}).join('')+'</tr>').join('')+'</tbody></table>';}
  var gmVals=[gm-0.1,gm-0.05,gm,gm+0.05,gm+0.10].map(v=>Math.max(0.1,Math.min(0.95,v)));
  var g1Vals=[g1*0.5,g1*0.75,g1,g1*1.25,g1*1.5];
  if(el2){el2.innerHTML='<table class="tbl"><thead><tr><th>Yr1 Grâ†“/GMâ†’</th>'+gmVals.map(g=>'<th class="num">'+(g*100).toFixed(0)+'%</th>').join('')+'</tr></thead><tbody>'+g1Vals.map(gr=>'<tr><td style="font-family:var(--font-mono);font-size:11px;font-weight:700;color:var(--blue)">'+(gr*100).toFixed(0)+'%</td>'+gmVals.map(gv=>{var v=dcfCalcIV(arr,gv,gr,g2,g3,g4,g5,sm,rd,ga,baseWacc,baseTg,tvM),diff=((v/mark-1)*100).toFixed(0);return'<td class="num" style="background:'+heatColor(v)+';font-family:var(--font-mono);font-size:11px;color:'+(v>mark?'#2ECC8A':'#E05555')+'">'+'$'+v.toFixed(0)+'M<br><span style="font-size:11px;opacity:0.7">'+(v>mark?'+':'')+diff+'%</span></td>';}).join('')+'</tr>').join('')+'</tbody></table>';}
  dc('ch-dcf-tornado');
  var baseIV=dcfCalcIV(arr,gm,g1,g2,g3,g4,g5,sm,rd,ga,baseWacc,baseTg,tvM);
  var drivers=[['WACC -2pp',dcfCalcIV(arr,gm,g1,g2,g3,g4,g5,sm,rd,ga,baseWacc-0.02,baseTg,tvM)-baseIV],['Yr1 Growth +25%',dcfCalcIV(arr,gm,g1*1.25,g2,g3,g4,g5,sm,rd,ga,baseWacc,baseTg,tvM)-baseIV],['Gross Margin +5pp',dcfCalcIV(arr,gm+0.05,g1,g2,g3,g4,g5,sm,rd,ga,baseWacc,baseTg,tvM)-baseIV],['S&M -10pp',dcfCalcIV(arr,gm,g1,g2,g3,g4,g5,sm-0.10,rd,ga,baseWacc,baseTg,tvM)-baseIV],['Terminal Gr +1pp',dcfCalcIV(arr,gm,g1,g2,g3,g4,g5,sm,rd,ga,baseWacc,baseTg+0.01,tvM)-baseIV],['R&D -10pp',dcfCalcIV(arr,gm,g1,g2,g3,g4,g5,sm,rd-0.10,ga,baseWacc,baseTg,tvM)-baseIV],['ARR +20%',dcfCalcIV(arr*1.2,gm,g1,g2,g3,g4,g5,sm,rd,ga,baseWacc,baseTg,tvM)-baseIV]].sort((a,b)=>Math.abs(b[1])-Math.abs(a[1]));
  mk('ch-dcf-tornado',{type:'bar',data:{labels:drivers.map(d=>d[0]),datasets:[{data:drivers.map(d=>+d[1].toFixed(0)),backgroundColor:drivers.map(d=>d[1]>=0?C.gr+'99':C.re+'99'),borderRadius:4}]},options:{indexAxis:'y',plugins:{legend:{display:false}},scales:{x:{title:{display:true,text:'Impact ($M)',color:'#7A776F',font:{size:11}}}}}});
}

function dcfSOP(){
  var cos2=CO.filter(c=>c.funds.includes('VI'));
  var rows=cos2.map(c=>{
    var d=DCF_DEFAULTS[c.name]||{arr:c.arr,gm:(c.gm||65)/100,g1:(c.arrGr||60)/100,g2:0.5,g3:0.35,g4:0.25,g5:0.18,sm:0.40,rd:0.25,ga:0.12,wacc:0.18,tg:0.03,tvMult:22,mark:c.nav};
    var iv=dcfCalcIV(d.arr,d.gm,d.g1,d.g2||0.5,d.g3||0.35,d.g4||0.25,d.g5||0.18,d.sm,d.rd,d.ga,d.wacc,d.tg,d.tvMult||22);
    var updown=((iv/c.nav-1)*100).toFixed(0);
    return{name:c.name,sector:c.sector,mark:c.nav,iv:iv.toFixed(0),updown,col:iv>c.nav?'#2ECC8A':'#E05555'};
  });
  var totalIV=rows.reduce((s,r)=>s+parseFloat(r.iv),0);
  var totalMark=rows.reduce((s,r)=>s+r.mark,0);
  var totEl=document.getElementById('sop-total');if(totEl)totEl.textContent='Portfolio IV: $'+totalIV.toFixed(0)+'M vs Mark $'+totalMark+'M';
  var sopEl=document.getElementById('sop-table');
  if(sopEl){sopEl.innerHTML='<table class="tbl"><thead><tr><th>Company</th><th>Sector</th><th class="num">Current Mark</th><th class="num">DCF IV</th><th class="num">vs Mark</th></tr></thead><tbody>'+rows.map(r=>'<tr><td class="name-cell">'+r.name+'</td><td style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim)">'+r.sector+'</td><td class="num">$'+r.mark+'M</td><td class="num" style="font-weight:700;color:'+r.col+'">$'+r.iv+'M</td><td class="num" style="color:'+r.col+'">'+(parseFloat(r.updown)>=0?'+':'')+r.updown+'%</td></tr>').join('')+'</tbody></table>';}
  dc('ch-sop-waterfall');
  mk('ch-sop-waterfall',{type:'bar',data:{labels:rows.map(r=>r.name),datasets:[{label:'Current Mark ($M)',data:rows.map(r=>r.mark),backgroundColor:C.bl+'66',borderRadius:4},{label:'DCF Intrinsic Value ($M)',data:rows.map(r=>parseFloat(r.iv)),backgroundColor:rows.map(r=>parseFloat(r.iv)>r.mark?C.gr+'88':C.re+'88'),borderRadius:4}]},options:{scales:{y:{title:{display:true,text:'$M',color:'#7A776F',font:{size:11}}}}}});
}

function initDCF(){
  selectDCFCo('Q-CTRL',document.querySelector('#dcf-co-chips .chip'));
  setTimeout(()=>{dcfSensitivity();dcfSOP();},200);
  setTimeout(function(){selectLPCo('Ledger',document.querySelector('#lp-co-chips .chip'));},400);
}

// â”€â”€ VaR helpers
var VAR_METHOD='parametric';
var VAR_CONF=95;
function setVARMethod(v,el){VAR_METHOD=v;document.querySelectorAll('#var-method-chips .chip').forEach(c=>c.classList.remove('on'));el.classList.add('on');varUpdate();}
function setVARConf(v,el){VAR_CONF=v;document.querySelectorAll('#var-conf-chips .chip').forEach(c=>c.classList.remove('on'));el.classList.add('on');varUpdate();}
function varUpdateLabel(slId,valId,fmt){var v=parseFloat(document.getElementById(slId).value);document.getElementById(valId).textContent=fmt(v);}

function varUpdate(){
  var dailyVol=parseFloat(document.getElementById('var-vol').value)/100;
  var horizon=parseInt(document.getElementById('var-horizon').value);
  var skew=parseFloat(document.getElementById('var-skew').value);
  var kurt=parseFloat(document.getElementById('var-kurt').value);
  var nav=294;
  var z=-normInv(1-VAR_CONF/100);
  var skewAdj=1+skew*z/6,kurtAdj=1+(kurt-3)*(z*z-1)/24;
  var adjZ=z*skewAdj*kurtAdj;
  var var1d=dailyVol*adjZ,varNd=dailyVol*adjZ*Math.sqrt(horizon);
  var esZ=Math.exp(-z*z/2)/(Math.sqrt(2*Math.PI)*(1-VAR_CONF/100));
  var esNd=dailyVol*esZ*Math.sqrt(horizon);
  var annVol=dailyVol*Math.sqrt(252)*100;
  function setC(id1,id2,pct,amt){var e1=document.getElementById(id1),e2=document.getElementById(id2);if(e1){e1.textContent='-'+(pct*100).toFixed(2)+'%';e1.className='live-kpi-val dn';}if(e2)e2.textContent='-$'+amt.toFixed(1)+'M';}
  setC('var-1d','var-1d-usd',var1d,var1d*nav);setC('var-nd','var-nd-usd',varNd,varNd*nav);setC('var-es','var-es-usd',esNd,esNd*nav);
  var avEl=document.getElementById('var-annvol');if(avEl)avEl.textContent=annVol.toFixed(1)+'%';
  dc('ch-var-dist');
  var xs=[],ys=[],norm=1/(dailyVol*Math.sqrt(2*Math.PI));
  for(var i=-5;i<=5;i+=0.1){xs.push((i*dailyVol*100).toFixed(2)+'%');var adj=1+skew*i/6+(kurt-3)*(i*i-1)/24;ys.push(+(norm*Math.exp(-i*i/2)*adj).toFixed(5));}
  mk('ch-var-dist',{type:'bar',data:{labels:xs,datasets:[{data:ys,backgroundColor:xs.map(x=>parseFloat(x)<-var1d*100?'rgba(224,85,85,0.85)':'rgba(232,98,42,0.5)'),borderRadius:1,categoryPercentage:1,barPercentage:1}]},options:{plugins:{legend:{display:false}},scales:{x:{ticks:{maxTicksLimit:10,font:{size:11}}},y:{display:false}}}});
  dc('ch-var-conf');
  var confs=[80,85,90,92,95,97,99,99.5,99.9];
  mk('ch-var-conf',{type:'line',data:{labels:confs.map(c=>c+'%'),datasets:[{label:'VaR ($M)',data:confs.map(c=>{var zc=-normInv(1-c/100);return+(dailyVol*zc*Math.sqrt(horizon)*nav).toFixed(1);}),borderColor:C.or,backgroundColor:C.or+'22',fill:true,tension:0.3,pointRadius:4},{label:'ES ($M)',data:confs.map(c=>{var zc=-normInv(1-c/100),es=Math.exp(-zc*zc/2)/(Math.sqrt(2*Math.PI)*(1-c/100));return+(dailyVol*es*Math.sqrt(horizon)*nav).toFixed(1);}),borderColor:C.re,borderDash:[5,3],tension:0.3,pointRadius:3}]},options:{scales:{y:{title:{display:true,text:'$M Loss',color:'#7A776F',font:{size:11}}}}}});
}

function ddUpdate(){
  var mu=parseFloat(document.getElementById('dd-mu')?document.getElementById('dd-mu').value:12)/100/252;
  var sigma=parseFloat(document.getElementById('dd-sigma')?document.getElementById('dd-sigma').value:28)/100/Math.sqrt(252);
  var yrs=parseInt(document.getElementById('dd-yrs')?document.getElementById('dd-yrs').value:5);
  var nav=294,N=3000,steps=yrs*252;
  var maxDrawdowns=[],samplePaths=[];
  for(var i=0;i<N;i++){var S=nav,peak=nav,mdd=0,path=i<5?[nav]:null;for(var t=0;t<steps;t++){S*=Math.exp((mu-0.5*sigma*sigma)+sigma*randn());if(S>peak)peak=S;var dd=(peak-S)/peak;if(dd>mdd)mdd=dd;if(path)path.push(+S.toFixed(1));}maxDrawdowns.push(mdd);if(i<5)samplePaths.push(path);}
  maxDrawdowns.sort((a,b)=>a-b);
  var mddMean=(maxDrawdowns.reduce((a,b)=>a+b,0)/N*100).toFixed(1);
  var mddMedian=(maxDrawdowns[Math.floor(N*0.5)]*100).toFixed(1);
  var mddP95=(maxDrawdowns[Math.floor(N*0.95)]*100).toFixed(1);
  var mddP99=(maxDrawdowns[Math.floor(N*0.99)]*100).toFixed(1);
  var statsEl=document.getElementById('dd-stats');
  if(statsEl){statsEl.innerHTML=[['Avg Max Drawdown','-'+mddMean+'%','dn'],['Median Max DD','-'+mddMedian+'%','dn'],['P95 Max DD','-'+mddP95+'%','dn'],['P99 Max DD','-'+mddP99+'%','dn'],['P(DD>20%)',(maxDrawdowns.filter(d=>d>0.20).length/N*100).toFixed(1)+'%',''],['P(DD>40%)',(maxDrawdowns.filter(d=>d>0.40).length/N*100).toFixed(1)+'%','']].map(([l,v,c])=>'<div class="live-kpi" style="border-bottom:1px solid var(--border);padding:6px 0"><span class="live-kpi-lbl">'+l+'</span><span style="font-family:var(--font-mono);font-size:13px;font-weight:700;color:'+(c==='dn'?'var(--red)':'var(--orange)')+'">'+v+'</span></div>').join('');}
  dc('ch-dd-underwater');
  var bestPath=samplePaths[2]||[];var peak2=nav;
  var underwater=bestPath.map(v=>{if(v>peak2)peak2=v;return+((v/peak2-1)*100).toFixed(2);});
  mk('ch-dd-underwater',{type:'line',data:{labels:underwater.map((_,i)=>i%63===0?'Q'+(Math.floor(i/63)+1)+' Yr'+(Math.floor(i/252)+1):''),datasets:[{label:'Drawdown %',data:underwater,borderColor:C.re,backgroundColor:C.re+'22',fill:true,tension:0.3,pointRadius:0},{label:'0% peak',data:underwater.map(()=>0),borderColor:C.go+'55',borderDash:[4,3],pointRadius:0,borderWidth:1}]},options:{scales:{y:{title:{display:true,text:'Drawdown %',color:'#7A776F',font:{size:11}},ticks:{callback:v=>v+'%'}},x:{ticks:{maxTicksLimit:8,font:{size:11}}}}}});
  dc('ch-dd-dist');
  var bins2=30,ddMax=maxDrawdowns[Math.floor(N*0.99)],bw2=ddMax/bins2,counts2=new Array(bins2).fill(0);
  maxDrawdowns.forEach(d=>{var b=Math.min(bins2-1,Math.floor(d/bw2));if(b>=0)counts2[b]++;});
  mk('ch-dd-dist',{type:'bar',data:{labels:counts2.map((_,i)=>'>'+(((i*bw2)*100).toFixed(0))+'%'),datasets:[{data:counts2,backgroundColor:counts2.map((_,i)=>{var v=(i*bw2)*100;return v<15?C.gr+'88':v<30?C.or+'88':C.re+'88';}),borderRadius:2}]},options:{plugins:{legend:{display:false}},scales:{x:{ticks:{maxTicksLimit:8,font:{size:11}}},y:{display:false}}}});
}

function renderVARStress(){
  var nav=294;
  var stresses=[{name:'GFC (2008â€“09)',navShock:-52,duration:18,recovery:36},{name:'COVID Crash (Mar 2020)',navShock:-38,duration:1,recovery:14},{name:'Dot-com Bust (2000â€“02)',navShock:-62,duration:30,recovery:48},{name:'VC Correction (2022â€“23)',navShock:-34,duration:18,recovery:24},{name:'SVB Crisis (2023)',navShock:-12,duration:2,recovery:6},{name:'Rate Shock +300bp',navShock:-25,duration:12,recovery:18},{name:'AI Bubble Burst',navShock:-45,duration:24,recovery:36},{name:'Geopolitical Shock',navShock:-20,duration:6,recovery:12}];
  var stressEl=document.getElementById('var-stress-table');
  if(stressEl){stressEl.innerHTML='<table class="tbl"><thead><tr><th>Scenario</th><th class="num">NAV Shock</th><th class="num">New NAV</th><th class="num">Duration (mo)</th><th class="num">Recovery (mo)</th></tr></thead><tbody>'+stresses.map(s=>{var nN=nav*(1+s.navShock/100),col=s.navShock<-40?C.re:C.or;return'<tr><td class="name-cell">'+s.name+'</td><td class="num" style="color:'+col+';font-weight:700">'+s.navShock+'%</td><td class="num">$'+nN.toFixed(0)+'M</td><td class="num">'+s.duration+'</td><td class="num">'+s.recovery+'</td></tr>';}).join('')+'</tbody></table>';}
  dc('ch-var-stress');
  mk('ch-var-stress',{type:'bar',data:{labels:stresses.map(s=>s.name),datasets:[{label:'NAV Drop ($M)',data:stresses.map(s=>+(nav*s.navShock/100).toFixed(0)),backgroundColor:stresses.map(s=>s.navShock<-40?C.re+'99':C.or+'99'),borderRadius:4},{label:'New NAV ($M)',data:stresses.map(s=>+(nav*(1+s.navShock/100)).toFixed(0)),backgroundColor:C.bl+'44',borderRadius:4}]},options:{indexAxis:'y',scales:{x:{title:{display:true,text:'$M',color:'#7A776F',font:{size:11}}}}}});
  dc('ch-var-recovery');
  mk('ch-var-recovery',{type:'scatter',data:{datasets:[{label:'Scenarios',data:stresses.map(s=>({x:s.duration,y:s.recovery})),backgroundColor:stresses.map(s=>s.navShock<-40?C.re:C.or),pointRadius:8}]},options:{scales:{x:{title:{display:true,text:'Crisis Duration (mo)',color:'#7A776F',font:{size:11}}},y:{title:{display:true,text:'Recovery Time (mo)',color:'#7A776F',font:{size:11}}}}}});
}

function renderCorrMatrix(){
  var companies=['Q-CTRL','Multiverse','d-Matrix','Ledger','Wayflyer','Matillion'];
  var corr=[[1.00,0.22,0.55,0.18,0.15,0.28],[0.22,1.00,0.18,0.12,0.42,0.65],[0.55,0.18,1.00,0.25,0.22,0.30],[0.18,0.12,0.25,1.00,0.52,0.15],[0.15,0.42,0.22,0.52,1.00,0.38],[0.28,0.65,0.30,0.15,0.38,1.00]];
  var el=document.getElementById('var-corr-matrix');
  if(el){function corrCol(v){return v===1?'#1a2a3a':v>0.5?'#1a3a1a':v>0.3?'#2a3010':v>0.1?'#1a1e28':'#2a1a1a';}el.innerHTML='<table class="tbl"><thead><tr><th></th>'+companies.map(c=>'<th class="num" style="font-size:11px">'+c+'</th>').join('')+'</tr></thead><tbody>'+companies.map((r,ri)=>'<tr><td style="font-family:var(--font-mono);font-size:11px;font-weight:700;color:var(--orange)">'+r+'</td>'+companies.map((_,ci)=>{var v=corr[ri][ci];return'<td class="num" style="background:'+corrCol(v)+';font-family:var(--font-mono);font-size:11px;font-weight:'+(v===1?700:400)+';color:'+(v>0.4?'#2ECC8A':v>0.2?'#D4A843':'var(--text-mid)')+'">'+v.toFixed(2)+'</td>';}).join('')+'</tr>').join('')+'</tbody></table>';}
  var navs=CO.filter(c=>c.funds.includes('VI')).map(c=>c.nav);
  var vols=[0.28,0.24,0.42,0.22,0.25,0.28,0.30,0.26];
  var portVol=0.22,totalNav=navs.reduce((a,b)=>a+b,0);
  dc('ch-var-div');
  var sumVarU=navs.reduce((s,n,i)=>s+n*n*(vols[i]||0.28)*(vols[i]||0.28),0);
  mk('ch-var-div',{type:'doughnut',data:{labels:['Portfolio VaR','Diversification Benefit'],datasets:[{data:[Math.sqrt(totalNav*totalNav*portVol*portVol).toFixed(0),Math.sqrt(Math.max(0,sumVarU-totalNav*totalNav*portVol*portVol)).toFixed(0)],backgroundColor:[C.or,C.gr+'88'],borderWidth:0}]},options:{cutout:'55%',plugins:{legend:{position:'bottom',labels:{color:'#7A776F',font:{size:11}}}}}});
  dc('ch-var-comp');
  var compNames=CO.filter(c=>c.funds.includes('VI')).map(c=>c.name);
  var compVaR=CO.filter(c=>c.funds.includes('VI')).map((c,i)=>{var beta=(vols[i]||0.28)/portVol*0.7;return+(c.nav*portVol*beta*1.645).toFixed(0);});
  mk('ch-var-comp',{type:'bar',data:{labels:compNames,datasets:[{label:'Component VaR ($M)',data:compVaR,backgroundColor:compVaR.map(v=>v>20?C.re+'88':v>10?C.or+'88':C.bl+'88'),borderRadius:4}]},options:{plugins:{legend:{display:false}},scales:{y:{title:{display:true,text:'VaR ($M)',color:'#7A776F',font:{size:11}}}}}});
}

function initVAR(){
  varUpdate();
  ddUpdate();
  renderVARStress();
  renderCorrMatrix();
  setTimeout(calcMarginalVaR,300);
}

function varTab(n){
  document.querySelectorAll('#var-tabs .stab').forEach((t,i)=>t.classList.toggle('on',i===n));
  ['var0','var1','var2','var3','var4','var5'].forEach((id,i)=>{var el=document.getElementById(id);if(el)el.classList.toggle('on',i===n);});
  if(n===1)ddUpdate();
  if(n===2)renderVARStress();
  if(n===3)renderCorrMatrix();
  if(n===4)calcMarginalVaR();
  if(n===5){if(BT_SCENARIO)runBacktest(BT_SCENARIO);}
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆ UPGRADE A: CORRELATED SHOCKS + INVERSE STRESS TEST â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Per-company beta coefficients (systematic market sensitivity)
var CO_BETAS = {
  'Q-CTRL':    1.85, // Deep tech quantum â€” very high beta
  'd-Matrix':  2.10, // AI hardware â€” highest beta, pre-revenue
  'Multiverse':0.80, // EdTech â€” more defensive
  'Ledger':    1.40, // Crypto-adjacent â€” elevated
  'Wayflyer':  1.10, // Revenue-based lending â€” moderate
  'Matillion': 1.00, // Mature SaaS â€” market beta
  'Sanity':    0.95, // SaaS â€” near market
  'Headway':   0.85, // EdTech â€” below market
  'Booksy':    0.90, // SMB SaaS â€” moderate
  'Quantexa': 1.20, // AI analytics â€” above market
};

// Run correlated Monte Carlo: portfolio returns driven by a common market factor
// Return = Beta Ã— MarketShock + Idiosyncratic Ã— sqrt(1-corr^2)
function runMonteCarlo() {
  var t0 = performance.now();
  var N         = parseInt(document.getElementById('mc-paths').value);
  var T         = parseInt(document.getElementById('mc-horizon').value);
  var steps     = parseInt(document.getElementById('mc-steps').value);
  var mu        = parseFloat(document.getElementById('mc-mu').value) / 100;
  var sig       = parseFloat(document.getElementById('mc-sigma').value) / 100;
  var jumpP     = parseFloat(document.getElementById('mc-jump-p').value) / 100;
  var jumpSz    = parseFloat(document.getElementById('mc-jump-sz').value) / 100;
  var portBeta  = parseFloat(document.getElementById('mc-beta').value);
  var idioVol   = parseFloat(document.getElementById('mc-idio').value) / 100;
  var crashBeta = parseFloat(document.getElementById('mc-crash-beta').value);

  var dt = 1 / steps;
  var totalSteps = T * steps;
  var S0 = 294;

  // Market vol (systematic component)
  var mktVol = sig / portBeta; // back out market vol from portfolio vol

  var finals = new Float64Array(N);
  var batchTrack = Math.min(500, N);
  var allPaths = [];

  // Per-company weights for correlated sim
  var cos3 = CO.filter(c => c.funds.includes('VI'));
  var navTotal = cos3.reduce((s,c) => s + c.nav, 0);
  var weights = cos3.map(c => c.nav / navTotal);
  var betas = cos3.map(c => CO_BETAS[c.name] || 1.0);

  for (var i = 0; i < N; i++) {
    var path = i < batchTrack ? new Float64Array(totalSteps) : null;
    // Per-company NAV values
    var navs = cos3.map(c => c.nav);

    for (var t = 0; t < totalSteps; t++) {
      // Draw common market shock
      var mktZ = randn();
      var isCrash = Math.random() < jumpP * dt;

      // Per-company returns driven by common factor + idio noise
      var newNavs = navs.map((n, ci) => {
        var beta = betas[ci];
        var idioZ = randn();
        // Systematic return
        var sysRet = beta * mktVol * Math.sqrt(dt) * mktZ;
        // Idiosyncratic return (orthogonal to market)
        var idioRet = idioVol * Math.sqrt(dt) * idioZ * Math.sqrt(1 - Math.min(0.99, beta * mktVol / sig));
        // Drift
        var drift = (mu - 0.5 * (sysRet + idioRet) * (sysRet + idioRet) / dt) * dt;
        var ret = Math.exp(drift + sysRet + idioRet);
        // Crash: high-beta companies get hit harder
        if (isCrash) {
          var crashRet = 1 - jumpSz * beta * crashBeta / portBeta * (0.6 + Math.random() * 0.8);
          ret *= Math.max(0.1, crashRet);
        }
        return n * ret;
      });
      navs = newNavs;
      var portNav = navs.reduce((s, v) => s + v, 0);
      if (path) path[t] = portNav;
    }
    var portFinal = navs.reduce((s, v) => s + v, 0);
    finals[i] = portFinal;
    if (i < batchTrack) allPaths.push(path);
  }

  var sortedFinals = Array.from(finals).sort((a, b) => a - b);

  // Percentile paths
  allPaths.sort((a, b) => a[totalSteps - 1] - b[totalSteps - 1]);
  var pct = [5, 25, 50, 75, 95];
  var percentilePaths = pct.map((p) => {
    var idx = Math.floor(p / 100 * (batchTrack - 1));
    return Array.from(allPaths[idx]);
  });

  var mean = sortedFinals.reduce((a, b) => a + b, 0) / N;
  var variance = sortedFinals.reduce((a, b) => a + (b - mean) ** 2, 0) / N;
  var std  = Math.sqrt(variance);
  var p5   = sortedFinals[Math.floor(0.05 * N)];
  var p25  = sortedFinals[Math.floor(0.25 * N)];
  var p50  = sortedFinals[Math.floor(0.50 * N)];
  var p75  = sortedFinals[Math.floor(0.75 * N)];
  var p95  = sortedFinals[Math.floor(0.95 * N)];
  var probLoss   = sortedFinals.filter(v => v < S0).length / N;
  var probDouble = sortedFinals.filter(v => v >= S0 * 2).length / N;
  var probTriple = sortedFinals.filter(v => v >= S0 * 3).length / N;

  MC_RESULTS = { sortedFinals, mean, std, p5, p25, p50, p75, p95, S0, T, N, percentilePaths, totalSteps, steps };

  var elapsed = (performance.now() - t0).toFixed(0);
  var statusEl = document.getElementById('mc-status');
  if (statusEl) statusEl.textContent = 'Complete';
  var rtEl = document.getElementById('mc-runtime');
  if (rtEl) rtEl.textContent = N.toLocaleString() + ' correlated paths in ' + elapsed + 'ms Â· Î²=' + portBeta;
  var pcEl = document.getElementById('mc-path-count');
  if (pcEl) pcEl.textContent = N.toLocaleString() + ' paths Â· ' + T + 'yr horizon';

  // Stats panel
  var statsEl = document.getElementById('mc-stats');
  if (statsEl) {
    statsEl.innerHTML = [
      ['Expected NAV',  '$' + mean.toFixed(0) + 'M',            mean > S0 ? 'up' : 'dn'],
      ['Median NAV',    '$' + p50.toFixed(0) + 'M',             p50  > S0 ? 'up' : 'dn'],
      ['Std Deviation', '$' + std.toFixed(0) + 'M',             ''],
      ['P5 (worst 5%)', '$' + p5.toFixed(0) + 'M',             'dn'],
      ['P95 (top 5%)',  '$' + p95.toFixed(0) + 'M',            'up'],
      ['Prob of Loss',  (probLoss*100).toFixed(1) + '%',        probLoss > 0.3 ? 'dn' : ''],
      ['Prob 2Ã— MOIC',  (probDouble*100).toFixed(1) + '%',      'up'],
      ['Prob 3Ã— MOIC',  (probTriple*100).toFixed(1) + '%',      'up'],
      ['Expected MOIC', (mean/S0).toFixed(2) + 'Ã—',             ''],
    ].map(([l, v, c]) =>
      '<div class="live-kpi" style="border-bottom:1px solid var(--border);padding:6px 0">' +
      '<span class="live-kpi-lbl">' + l + '</span>' +
      '<span style="font-family:var(--font-mono);font-size:13px;font-weight:700;color:' +
      (c === 'up' ? 'var(--green)' : c === 'dn' ? 'var(--red)' : 'var(--text)') + '">' + v + '</span></div>'
    ).join('');
  }

  // Histogram
  dc('ch-mc-hist');
  var bins = 60;
  var minV = p5 * 0.5, maxV = p95 * 1.5;
  var bw = (maxV - minV) / bins;
  var counts = new Array(bins).fill(0);
  sortedFinals.forEach(v => { var b = Math.min(bins-1, Math.max(0, Math.floor((v-minV)/bw))); counts[b]++; });
  mk('ch-mc-hist', {type:'bar', data:{
    labels: counts.map((_, i) => '$' + Math.round(minV + i*bw) + 'M'),
    datasets:[{data:counts, borderRadius:2, borderSkipped:false,
      backgroundColor: counts.map((_, i) => {
        var v = minV + i*bw;
        return v < p5 ? 'rgba(224,85,85,0.85)' : v < S0 ? 'rgba(212,168,67,0.65)' : v < p95 ? 'rgba(232,98,42,0.7)' : 'rgba(46,204,138,0.8)';
      })}]},
  options:{plugins:{legend:{display:false}}, scales:{x:{ticks:{maxTicksLimit:8,font:{size:11}}}, y:{title:{display:true,text:'Frequency',color:'#7A776F',font:{size:11}}}}}});

  // Percentile fan chart
  dc('ch-mc-paths');
  var timeLabels = Array.from({length: totalSteps}, (_, i) => i % steps === 0 ? 'Yr' + Math.round(i/steps) : '');
  mk('ch-mc-paths', {type:'line', data:{labels: timeLabels, datasets:
    pct.map((p, pi) => ({
      label: ['P5','P25','P50','P75','P95'][pi],
      borderColor: [C.re, C.or, C.go, C.gr, C.tl][pi],
      data: percentilePaths[pi],
      tension:0.3, pointRadius:0, borderWidth: pi===2 ? 2.5 : 1.5,
      borderDash: pi===2 ? [] : [4,3], backgroundColor:'transparent'
    })).concat([{label:'Base NAV', borderColor:'rgba(255,255,255,0.12)', data:Array(totalSteps).fill(S0), borderDash:[6,4], pointRadius:0, borderWidth:1}])},
  options:{scales:{y:{title:{display:true,text:'NAV ($M)',color:'#7A776F',font:{size:11}}}, x:{ticks:{maxTicksLimit:10,font:{size:11}}}}}});

  // MOIC distribution
  dc('ch-mc-moic');
  var moics = sortedFinals.map(v => v/S0);
  var moicMax = Math.min(8, moics[Math.floor(0.98*N)]);
  var mBins = 40, mBw = moicMax/mBins;
  var mCounts = new Array(mBins).fill(0);
  moics.forEach(m => { var b = Math.min(mBins-1, Math.max(0, Math.floor(m/mBw))); mCounts[b]++; });
  mk('ch-mc-moic', {type:'bar', data:{
    labels: mCounts.map((_, i) => (i*mBw).toFixed(1)+'Ã—'),
    datasets:[{data:mCounts, borderRadius:2,
      backgroundColor:mCounts.map((_,i)=>{var m=i*mBw; return m<1?'rgba(224,85,85,0.8)':m<2?'rgba(212,168,67,0.7)':m<3?'rgba(232,98,42,0.7)':'rgba(46,204,138,0.8)';})}]},
  options:{plugins:{legend:{display:false}}, scales:{x:{ticks:{maxTicksLimit:8,font:{size:11}}}, y:{display:false}}}});

  // Probability targets table
  var targets = [[1.0,'Break-even'],[1.5,'1.5Ã— MOIC'],[2.0,'2Ã— MOIC'],[2.5,'2.5Ã— MOIC'],[3.0,'3Ã— MOIC'],[4.0,'4Ã— MOIC']];
  var ptEl = document.getElementById('mc-prob-targets');
  if (ptEl) ptEl.innerHTML = targets.map(([t, lbl]) => {
    var prob = (sortedFinals.filter(v => v >= S0*t).length / N * 100).toFixed(1);
    var col = prob > 60 ? 'var(--green)' : prob > 30 ? 'var(--orange)' : 'var(--red)';
    return '<div style="padding:5px 0;border-bottom:1px solid var(--border)">' +
      '<div style="display:flex;justify-content:space-between;font-family:var(--font-mono);font-size:11px;margin-bottom:3px">' +
      '<span style="color:var(--text-mid)">' + lbl + '</span><span style="color:'+col+';font-weight:700">'+prob+'%</span></div>' +
      '<div style="height:4px;background:var(--s3);border-radius:2px"><div style="height:4px;width:'+prob+'%;max-width:100%;background:'+col+';border-radius:2px;transition:width .4s"></div></div></div>';
  }).join('');
}

// â”€â”€ Inverse Stress Test â”€â”€
// Find the max NAV drop before Fund VI falls to 1.0Ã— MOIC (breakeven = invested $210M)
function runInverseStressTest() {
  var S0       = 294;   // current NAV
  var invested = 210;   // capital invested in Fund VI
  var breakeven = invested; // 1.0Ã— MOIC floor

  // How far can NAV drop before hitting breakeven?
  var maxDrop = (S0 - breakeven) / S0;

  // Given current beta, which companies would survive?
  var portBeta  = parseFloat(document.getElementById('mc-beta').value);
  var crashBeta = parseFloat(document.getElementById('mc-crash-beta').value);
  var cos3 = CO.filter(c => c.funds.includes('VI'));
  var navTotal = cos3.reduce((s,c) => s + c.nav, 0);

  // For each company, compute how much of the $84M buffer they eat through
  var buffer = S0 - breakeven;  // $84M
  var compImpacts = cos3.map(c => {
    var beta = CO_BETAS[c.name] || 1.0;
    var relativeHit = beta * crashBeta / portBeta;
    // In a portfolio-level -maxDrop crash, this company drops by relativeHit Ã— maxDrop
    var compDrop = c.nav * maxDrop * relativeHit;
    return { name: c.name, nav: c.nav, beta: beta, compDrop: compDrop };
  }).sort((a,b) => b.compDrop - a.compDrop);

  // Show result
  var resultEl = document.getElementById('mc-inverse-result');
  var pctEl    = document.getElementById('mc-inverse-pct');
  var detailEl = document.getElementById('mc-inverse-detail');

  if (resultEl) resultEl.style.display = 'block';
  if (pctEl) { pctEl.textContent = '-' + (maxDrop*100).toFixed(1) + '%'; pctEl.className = 'live-kpi-val dn'; }

  var worstCo = compImpacts[0];
  if (detailEl) detailEl.innerHTML =
    'Buffer: $' + buffer.toFixed(0) + 'M Â· ' +
    'Breakeven at $' + breakeven + 'M NAV Â· ' +
    'Biggest risk: <strong style="color:var(--red)">' + worstCo.name + '</strong> (Î²=' + worstCo.beta + ', -$' + worstCo.compDrop.toFixed(0) + 'M impact)';

  // Update stats panel with breakdown
  var statsEl = document.getElementById('mc-stats');
  if (statsEl) {
    var breakdown = compImpacts.map(c => {
      var col = c.compDrop > buffer*0.3 ? 'var(--red)' : c.compDrop > buffer*0.15 ? 'var(--orange)' : 'var(--green)';
      return '<div class="live-kpi" style="border-bottom:1px solid var(--border);padding:5px 0">' +
        '<span class="live-kpi-lbl">' + c.name + ' (Î²=' + c.beta.toFixed(1) + ')</span>' +
        '<span style="font-family:var(--font-mono);font-size:11px;font-weight:700;color:' + col + '">-$' + c.compDrop.toFixed(0) + 'M</span></div>';
    }).join('');
    statsEl.innerHTML =
      '<div style="font-family:var(--font-mono);font-size:11px;color:var(--orange);font-weight:700;padding:6px 0 4px;border-bottom:1px solid var(--border2);margin-bottom:6px">âš  MAX SURVIVABLE DECLINE: -' + (maxDrop*100).toFixed(1) + '% ($' + buffer.toFixed(0) + 'M)</div>' +
      '<div style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim);padding:2px 0 8px">Company loss estimates in full-portfolio crash scenario</div>' + breakdown;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆ UPGRADE B: BURN-LINKED DCF + LIQUIDATION PREFERENCE WATERFALL â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Auto-deteriorate burn / efficiency metrics based on growth rate
// Rule: at 100% growth â†’ burn ~1.5Ã—. At 150%+ â†’ burn multiple 2.5â€“4.0Ã—
// Each 10pp of extra growth above 40% adds ~0.12 to burn multiple
function impliedBurnMultiple(g1pct) {
  if (g1pct <= 40)  return 0.8 + g1pct/100;
  if (g1pct <= 80)  return 1.2 + (g1pct-40)*0.025;
  if (g1pct <= 120) return 2.2 + (g1pct-80)*0.020;
  return Math.min(5.5, 3.0 + (g1pct-120)*0.015);
}

// Burn-adjusted S&M: higher growth â†’ higher CAC spend
function burnAdjustedSM(g1pct, baseSM) {
  var burnMult = impliedBurnMultiple(g1pct);
  // S&M scales with burn but has a floor (can't sell less than base)
  return Math.min(0.85, baseSM * Math.sqrt(burnMult / 1.2));
}

var LP_PREF_MULT = 1;
var LP_PARTICIPATING = true;
var LP_CO_DATA = {
  'Ledger':    { raised:180, gpOwn:6,  navMark:32,  invested:20 },
  'Q-CTRL':    { raised:120, gpOwn:12, navMark:82,  invested:35 },
  'd-Matrix':  { raised:95,  gpOwn:10, navMark:38,  invested:22 },
  'Matillion': { raised:140, gpOwn:8,  navMark:32,  invested:18 },
};
var LP_SEL_CO = 'Ledger';

function setLPPref(v, el) {
  LP_PREF_MULT = v;
  document.querySelectorAll('#lp-pref-chips .chip').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  lpWaterfallUpdate();
}
function setLPPart(v, el) {
  LP_PARTICIPATING = v;
  document.querySelectorAll('#lp-part-chips .chip').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  lpWaterfallUpdate();
}
function lpUpdateLabel(slId, valId, fmt) {
  var v = parseFloat(document.getElementById(slId).value);
  document.getElementById(valId).textContent = fmt(v);
}
function selectLPCo(name, el) {
  LP_SEL_CO = name;
  document.querySelectorAll('#lp-co-chips .chip').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  var d = LP_CO_DATA[name];
  if (!d) return;
  var rEl = document.getElementById('lp-raised'); if(rEl) { rEl.value = d.raised; document.getElementById('lp-raised-v').textContent = '$'+d.raised+'M'; }
  var gEl = document.getElementById('lp-gp-own');  if(gEl) { gEl.value = d.gpOwn;  document.getElementById('lp-gp-own-v').textContent = d.gpOwn+'%'; }
  var xEl = document.getElementById('lp-exit');    if(xEl) { xEl.value = Math.round(d.navMark * 8); document.getElementById('lp-exit-v').textContent = '$'+Math.round(d.navMark*8)+'M'; }
  lpWaterfallUpdate();
}

function lpWaterfallUpdate() {
  var raised   = parseFloat(document.getElementById('lp-raised').value);
  var gpOwn    = parseFloat(document.getElementById('lp-gp-own').value) / 100;
  var exitVal  = parseFloat(document.getElementById('lp-exit').value);
  var prefStack = raised * LP_PREF_MULT;
  var d = LP_CO_DATA[LP_SEL_CO] || {invested:20};
  var gpInvested = d.invested || 20;

  // Waterfall calculation
  var gpProceeds, afterPref;
  if (exitVal <= prefStack) {
    // Below preference â€” common shareholders get nothing
    gpProceeds = 0;
    afterPref = 0;
  } else {
    afterPref = exitVal - prefStack;
    if (LP_PARTICIPATING) {
      // Participating: preferred gets preference PLUS pro-rata share of remainder
      var prefShareOfRemainder = (1 - gpOwn) * 0.7; // investors own most of non-GP equity
      gpProceeds = afterPref * gpOwn;
    } else {
      // Non-participating: convert to common OR take preference (whichever is better for them)
      var preferredAsCommon = exitVal * (1 - gpOwn) * 0.8;
      if (preferredAsCommon > prefStack) {
        // Investors convert â€” GP gets full common share
        gpProceeds = exitVal * gpOwn;
        prefStack = 0; // they converted
      } else {
        gpProceeds = afterPref * gpOwn;
      }
    }
  }

  var gpMoic = gpInvested > 0 ? (gpProceeds / gpInvested).toFixed(2) : 'â€”';
  // Breakeven exit = minimum exit where GP gets back their investment
  var breakeven = gpInvested > 0 ? Math.round(prefStack + gpInvested / gpOwn) : 0;

  // Update cards
  function setLPCard(id, val, cls) {
    var el = document.getElementById(id); if (!el) return;
    el.textContent = val;
    if (cls) el.className = 'live-kpi-val ' + cls;
  }
  setLPCard('lp-pref-stack',   '$' + prefStack.toFixed(0) + 'M',  'dn');
  setLPCard('lp-gp-proceeds',  '$' + gpProceeds.toFixed(0) + 'M', gpProceeds > gpInvested ? 'up' : 'dn');
  setLPCard('lp-gp-moic',      gpMoic + 'Ã—',                      parseFloat(gpMoic) >= 1 ? 'up' : 'dn');
  setLPCard('lp-breakeven',    '$' + breakeven + 'M',              '');

  // Waterfall bar chart
  dc('ch-lp-waterfall');
  var prefInv = Math.min(prefStack, exitVal);
  var gpShare = Math.max(0, gpProceeds);
  var otherEquity = Math.max(0, exitVal - prefInv - gpShare);
  mk('ch-lp-waterfall', {type:'bar', data:{
    labels: ['Exit Value Waterfall'],
    datasets: [
      {label: 'Preference Stack ($' + prefInv.toFixed(0) + 'M)', data:[prefInv], backgroundColor:'rgba(224,85,85,0.8)', borderRadius:4},
      {label: 'Other Equity ($' + otherEquity.toFixed(0) + 'M)',  data:[otherEquity], backgroundColor:'rgba(74,139,212,0.7)', borderRadius:4},
      {label: 'GP Common ($' + gpShare.toFixed(0) + 'M)',        data:[gpShare], backgroundColor: gpShare > 0 ? 'rgba(46,204,138,0.85)' : 'rgba(100,100,100,0.3)', borderRadius:4},
    ]},
  options:{indexAxis:'y', plugins:{legend:{position:'bottom',labels:{color:'#7A776F',font:{size:11}}}},
    scales:{x:{stacked:true, title:{display:true,text:'$M',color:'#7A776F',font:{size:11}}}, y:{stacked:true}}}});
}

// Patch dcfUpdate to add burn linkage
var _origDcfUpdate = dcfUpdate;
dcfUpdate = function() {
  _origDcfUpdate();
  // Add burn linkage annotation to the burn badge
  var g1pct = parseFloat(document.getElementById('dcf-g1').value);
  var burnMult = impliedBurnMultiple(g1pct);
  var badgeEl = document.getElementById('dcf-burn-badge');
  if (!badgeEl) return;
  var col = burnMult > 3 ? 'var(--red)' : burnMult > 2 ? 'var(--orange)' : 'var(--green)';
  badgeEl.innerHTML = 'Implied Burn: <span style="font-weight:700;color:'+col+'">' + burnMult.toFixed(1) + 'Ã—</span> at ' + g1pct + '% growth';

  // Also add a burn efficiency row to the DCF table if it exists
  var tbl = document.getElementById('dcf-table');
  if (tbl && tbl.querySelector('tbody')) {
    var adjSM = (burnAdjustedSM(g1pct, parseFloat(document.getElementById('dcf-sm').value)/100)*100).toFixed(0);
    var burnNote = document.getElementById('dcf-burn-note');
    if (!burnNote) {
      burnNote = document.createElement('div');
      burnNote.id = 'dcf-burn-note';
      burnNote.style.cssText = 'font-family:var(--font-mono);font-size:11px;color:'+col+';padding:6px 12px;background:var(--bg);border-top:1px solid var(--border2)';
      tbl.appendChild(burnNote);
    }
    burnNote.style.color = col;
    burnNote.textContent = 'âš¡ Burn linkage: at ' + g1pct + '% growth, implied burn multiple ' + burnMult.toFixed(1) + 'Ã— â†’ adjusted S&M ~' + adjSM + '% of ARR (vs ' + document.getElementById('dcf-sm').value + '% base)';
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆ UPGRADE C: MARGINAL VAR + HISTORICAL BACKTEST â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var MVAR_SIZE = 10;   // % reduction to test
var MVAR_CONF = 95;
var MVAR_RESULTS = null;

function setMVARSize(v, el) {
  MVAR_SIZE = v;
  document.querySelectorAll('#mvar-size-chips .chip').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  var lbl = document.getElementById('mvar-reduction-label');
  if (lbl) lbl.textContent = v + '% reduction';
}
function setMVARConf(v, el) {
  MVAR_CONF = v;
  document.querySelectorAll('#mvar-conf-chips .chip').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
}

function calcMarginalVaR() {
  var conf    = MVAR_CONF;
  var redPct  = MVAR_SIZE / 100;
  var portVol = 0.22; // annual vol
  var dailyVol = portVol / Math.sqrt(252);
  var z = -normInv(1 - conf/100);
  var totalNAV = 294;

  var cos3 = CO.filter(c => c.funds.includes('VI'));

  // Compute per-company VaR contribution and marginal VaR
  var results = cos3.map(c => {
    var beta = CO_BETAS[c.name] || 1.0;
    var compVol = dailyVol * beta;
    var compVaR1d = c.nav * compVol * z;

    // Marginal VaR: remove MVAR_SIZE% of position
    var reducedNAV = c.nav * (1 - redPct);
    var navDiff = c.nav - reducedNAV;

    // Portfolio VaR change = navDiff * marginal contribution
    // Marginal contribution = beta * corr_to_portfolio * portfolio_vol
    var corrToPort = 0.65; // average company-to-portfolio correlation
    var margContrib = beta * corrToPort * dailyVol;
    var varReduction = navDiff * margContrib * z;
    var varDensity = varReduction / c.nav; // VaR reduction per $1 of NAV

    // Full portfolio VaR with and without position
    var portVaR = totalNAV * dailyVol * z;
    var newNAV = totalNAV - navDiff;
    var newPortVaR = (totalNAV - navDiff) * dailyVol * z * (1 - (beta - 1) * navDiff / totalNAV * 0.3);
    var portVarChange = portVaR - newPortVaR;

    return {
      name: c.name, nav: c.nav, beta: beta,
      compVaR: compVaR1d, varReduction, varDensity, portVarChange,
      portVaR, newPortVaR
    };
  }).sort((a, b) => b.varReduction - a.varReduction);

  MVAR_RESULTS = results;

  // Summary panel
  var summEl = document.getElementById('mvar-summary');
  if (summEl) {
    var portVaR = totalNAV * dailyVol * z;
    summEl.innerHTML =
      '<div style="font-family:var(--font-mono);font-size:11px;color:var(--orange);font-weight:700;padding:4px 0 8px">Portfolio VaR (' + conf + '%): -$' + portVaR.toFixed(1) + 'M/day</div>' +
      results.map(r => {
        var pct = (r.varReduction / portVaR * 100).toFixed(1);
        var col = r.varReduction > portVaR*0.25 ? 'var(--red)' : r.varReduction > portVaR*0.1 ? 'var(--orange)' : 'var(--green)';
        return '<div class="live-kpi" style="border-bottom:1px solid var(--border);padding:5px 0">' +
          '<span class="live-kpi-lbl">' + r.name + ' (Î²=' + r.beta.toFixed(1) + ')</span>' +
          '<span style="font-family:var(--font-mono);font-size:11px;font-weight:700;color:'+col+'">' +
          '-$' + r.varReduction.toFixed(1) + 'M <span style="font-size:11px;opacity:0.7">(' + pct + '% of port VaR)</span></span></div>';
      }).join('');
  }

  var lblEl = document.getElementById('mvar-reduction-label');
  if (lblEl) lblEl.textContent = MVAR_SIZE + '% reduction scenario';

  // Marginal VaR bar chart
  dc('ch-mvar-bar');
  mk('ch-mvar-bar', {type:'bar', data:{
    labels: results.map(r => r.name),
    datasets: [
      {label:'VaR Reduction ($M)', data: results.map(r => +r.varReduction.toFixed(2)),
       backgroundColor: results.map(r => r.varReduction > 5 ? C.re+'99' : r.varReduction > 2 ? C.or+'99' : C.bl+'99'), borderRadius:4},
      {label:'Component VaR ($M)', data: results.map(r => +r.compVaR.toFixed(2)),
       backgroundColor: C.bl+'44', borderRadius:4, type:'line', borderColor:C.bl, pointRadius:4},
    ]},
  options:{plugins:{legend:{labels:{color:'#7A776F',font:{size:11}}}},
    scales:{y:{title:{display:true,text:'$M (1-day)',color:'#7A776F',font:{size:11}}}}}});

  // Risk density chart
  dc('ch-mvar-density');
  var density = results.slice().sort((a,b)=>b.varDensity-a.varDensity);
  mk('ch-mvar-density', {type:'bar', data:{
    labels: density.map(r => r.name),
    datasets:[{label:'VaR per $1M NAV ($k)',
      data: density.map(r => +(r.varDensity * 1000).toFixed(2)),
      backgroundColor: density.map(r => r.varDensity > 0.02 ? C.re+'88' : r.varDensity > 0.01 ? C.or+'88' : C.gr+'88'),
      borderRadius:4}]},
  options:{plugins:{legend:{display:false}},
    scales:{y:{title:{display:true,text:'VaR/$1M NAV',color:'#7A776F',font:{size:11}}}}}});
}

// â”€â”€ Historical Backtest â”€â”€
var BT_SCENARIO = 'covid2020';

// Historical crisis data with per-sector returns
// Based on actual sector performance during each crisis
var BT_SCENARIOS = {
  covid2020: {
    label: 'COVID Crash â€” Feb 19 â€“ Mar 23, 2020',
    duration: '33 days',
    description: 'Fastest bear market in history. Lockdowns crushed consumer/EdTech, then massive rebound.',
    peakLoss: -34,
    recoveryMonths: 5,
    worstDay: -12.3,
    // Sector shocks (%) during the crisis period
    sectorShocks: {
      'AI Hardware':      -48, // Tech hardware obliterated
      'DeepTech/Quantum': -42, // Deep tech, illiquid
      'FinTech/Crypto':   -52, // Crypto crashed hard
      'FinTech':          -38, // Fintech sold off
      'EdTech':           +15, // EdTech surged (Zoom effect)
      'Software':         -28, // SaaS resilient but fell
      'AI/Data Analytics':-35,
    },
    marketReturn: -34,
    vix: 82,
    timeline: [-5,-8,-12,-18,-26,-32,-34,-30,-24,-18,-12,-6,-1,3,6,8,10,8,6,5,4,3,2,1],
  },
  techselloff2022: {
    label: '2022 Tech Selloff â€” Jan 1 â€“ Dec 31, 2022',
    duration: '12 months',
    description: 'Rate shock +425bp destroyed high-multiple tech. Pre-revenue companies lost 60-80% of valuation.',
    peakLoss: -52,
    recoveryMonths: 28,
    worstDay: -5.8,
    sectorShocks: {
      'AI Hardware':      -72, // Pre-revenue AI hardware devastated
      'DeepTech/Quantum': -65, // Long duration assets
      'FinTech/Crypto':   -78, // Crypto winter
      'FinTech':          -55, // BNPL/fintech crushed
      'EdTech':           -62, // Chegg, Duolingo fell massively
      'Software':         -48, // SaaS multiples compressed 50%+
      'AI/Data Analytics':-55,
    },
    marketReturn: -33,
    vix: 36,
    timeline: [-6,-10,-14,-18,-22,-28,-34,-38,-44,-50,-52,-48,-44],
  },
  gfc2008: {
    label: 'GFC â€” Sep 15, 2008 â€“ Mar 9, 2009',
    duration: '6 months',
    description: 'Lehman collapse triggered complete credit freeze. All risk assets correlated to 1.0.',
    peakLoss: -55,
    recoveryMonths: 36,
    worstDay: -18.5,
    sectorShocks: {
      'AI Hardware':      -58,
      'DeepTech/Quantum': -50,
      'FinTech/Crypto':   -65,
      'FinTech':          -62,
      'EdTech':           -35, // less correlated
      'Software':         -42,
      'AI/Data Analytics':-48,
    },
    marketReturn: -45,
    vix: 89,
    timeline: [-8,-14,-22,-30,-38,-44,-50,-55,-52,-48,-44,-40,-36,-30,-25,-20,-15,-10,-5,0,5,8,10,12,15],
  },
  dotcom2000: {
    label: 'Dot-com Bust â€” Mar 2000 â€“ Oct 2002',
    duration: '30 months',
    description: 'Tech-specific collapse. NASDAQ -78%. Profitable companies survived; pre-revenue largely zeroed.',
    peakLoss: -78,
    recoveryMonths: 60,
    worstDay: -6.2,
    sectorShocks: {
      'AI Hardware':      -85, // Hardware vaporized
      'DeepTech/Quantum': -70,
      'FinTech/Crypto':   -60, // Less correlated pre-crypto era
      'FinTech':          -55,
      'EdTech':           -45,
      'Software':         -72, // Enterprise SW devastated
      'AI/Data Analytics':-68,
    },
    marketReturn: -78,
    vix: 45,
    timeline: [-3,-8,-14,-20,-28,-36,-44,-52,-58,-62,-66,-70,-74,-78,-75,-70,-65,-60,-55,-52,-48,-45,-42,-40,-38,-36,-35,-34,-33,-32,-31],
  },
  svb2023: {
    label: 'SVB / Banking Crisis â€” Mar 8â€“17, 2023',
    duration: '10 days',
    description: 'Regional bank stress triggered VC funding freeze. Late-stage valuations hit; flight to profitability.',
    peakLoss: -18,
    recoveryMonths: 3,
    worstDay: -8.2,
    sectorShocks: {
      'AI Hardware':      -22,
      'DeepTech/Quantum': -18,
      'FinTech/Crypto':   -35, // Banks/FinTech most impacted
      'FinTech':          -28,
      'EdTech':           -10,
      'Software':         -14,
      'AI/Data Analytics':-16,
    },
    marketReturn: -15,
    vix: 26,
    timeline: [-2,-4,-8,-14,-18,-16,-14,-12,-10,-8,-6,-4,-2,0,2,4,6,8,10,12],
  }
};

function selectBacktest(key, el) {
  BT_SCENARIO = key;
  document.querySelectorAll('#backtest-scenario-chips .chip').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  runBacktest(key);
}

function runBacktest(key) {
  var scen = BT_SCENARIOS[key];
  if (!scen) return;

  var totalNAV = 294;
  var cos3 = CO.filter(c => c.funds.includes('VI'));

  // Apply sector shocks to each company
  var compResults = cos3.map(c => {
    var shock = scen.sectorShocks[c.sector] || scen.marketReturn * 0.8;
    // Beta-adjust the shock
    var beta = CO_BETAS[c.name] || 1.0;
    var adjShock = shock * beta / 1.2; // 1.2 = avg beta
    var compNAVImpact = c.nav * adjShock / 100;
    var newNav = c.nav + compNAVImpact;
    return { name: c.name, sector: c.sector, origNav: c.nav, shock: adjShock.toFixed(1), impact: compNAVImpact, newNav: Math.max(0, newNav) };
  });

  var totalImpact = compResults.reduce((s, c) => s + c.impact, 0);
  var peakLossUSD = totalNAV * scen.peakLoss / 100;
  var troughNAV = totalNAV + peakLossUSD;

  // Update result cards
  var lblEl = document.getElementById('backtest-scenario-label');
  if (lblEl) { lblEl.textContent = scen.label; lblEl.style.color = 'var(--red)'; }

  function setBTCard(id, val) { var el = document.getElementById(id); if(el) el.textContent = val; }
  setBTCard('bt-peak-loss',   scen.peakLoss + '% (' + duration_label(Math.abs(peakLossUSD)) + ')');
  setBTCard('bt-trough-nav',  '$' + troughNAV.toFixed(0) + 'M');
  setBTCard('bt-recovery',    scen.recoveryMonths + ' months');
  setBTCard('bt-worst-day',   scen.worstDay + '%');

  // Path chart
  dc('ch-bt-path');
  var timeline = scen.timeline;
  var pathNAVs = timeline.map(pct => +(totalNAV * (1 + pct/100)).toFixed(0));
  var labels = timeline.map((_, i) => {
    var unit = scen.duration.includes('month') ? 'Mo ' : scen.duration.includes('year') ? 'Mo ' : 'Day ';
    return unit + (i+1);
  });
  mk('ch-bt-path', {type:'line', data:{
    labels: labels,
    datasets:[
      {label:'Portfolio NAV ($M)', data:pathNAVs, borderColor:C.re, backgroundColor:C.re+'22', fill:true, tension:0.3, pointRadius:3, pointBackgroundColor:C.re},
      {label:'Starting NAV ($294M)', data:Array(timeline.length).fill(totalNAV), borderColor:C.go+'55', borderDash:[5,3], pointRadius:0, borderWidth:1},
      {label:'1.0Ã— MOIC Floor ($210M)', data:Array(timeline.length).fill(210), borderColor:C.or+'55', borderDash:[3,3], pointRadius:0, borderWidth:1},
    ]},
  options:{plugins:{legend:{position:'bottom',labels:{color:'#7A776F',font:{size:11}}}},
    scales:{y:{title:{display:true,text:'NAV ($M)',color:'#7A776F',font:{size:11}}}}}});

  // Per-company table
  var tblEl = document.getElementById('bt-company-table');
  if (tblEl) {
    tblEl.innerHTML = '<table class="tbl"><thead><tr><th>Company</th><th>Sector</th><th class="num">Shock Applied</th><th class="num">NAV Impact ($M)</th><th class="num">NAV at Trough</th></tr></thead><tbody>' +
      compResults.sort((a,b)=>a.impact-b.impact).map(r => {
        var col = r.shock < -30 ? C.re : r.shock < -15 ? '#D4A843' : r.shock > 0 ? C.gr : C.or;
        return '<tr><td class="name-cell">' + r.name + '</td>' +
          '<td style="font-family:var(--font-mono);font-size:11px;color:var(--text-dim)">' + r.sector + '</td>' +
          '<td class="num" style="color:'+col+';font-weight:700">' + (r.shock >= 0 ? '+' : '') + r.shock + '%</td>' +
          '<td class="num" style="color:' + (r.impact < 0 ? C.re : C.gr) + '">' + (r.impact >= 0 ? '+' : '') + r.impact.toFixed(1) + 'M</td>' +
          '<td class="num">$' + r.newNav.toFixed(0) + 'M</td></tr>';
      }).join('') + '</tbody></table>';
  }
}

function duration_label(usd) {
  return '-$' + usd.toFixed(0) + 'M';
}

// Patch varTab to handle new tabs 4 and 5
var _origVarTab = varTab;
varTab = function(n) {
  document.querySelectorAll('#var-tabs .stab').forEach((t,i) => t.classList.toggle('on', i===n));
  ['var0','var1','var2','var3','var4','var5'].forEach((id,i) => {
    var el = document.getElementById(id); if(el) el.classList.toggle('on', i===n);
  });
  if (n===1) ddUpdate();
  if (n===2) renderVARStress();
  if (n===3) renderCorrMatrix();
  if (n===4) calcMarginalVaR();
  if (n===5) { if(BT_SCENARIO) runBacktest(BT_SCENARIO); }
};

// Init new features when pages load
var _origInitVAR = initVAR;
initVAR = function() {
  _origInitVAR();
  // Pre-run marginal VaR for tab 4
  setTimeout(calcMarginalVaR, 300);
};

var _origInitDCF = initDCF;
initDCF = function() {
  _origInitDCF();
  // Init liquidation preference panel
  setTimeout(function() {
    selectLPCo('Ledger', document.querySelector('#lp-co-chips .chip'));
  }, 300);
};





loadState();
initPage('pulse');

</script>
</body>
</html>
